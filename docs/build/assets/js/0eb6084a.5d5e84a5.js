"use strict";(globalThis.webpackChunkkafka_backup_docs=globalThis.webpackChunkkafka_backup_docs||[]).push([[8119],{8453:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>i});var s=r(6540);const a={},o=s.createContext(a);function t(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),s.createElement(o.Provider,{value:n},e.children)}},8516:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>t,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"examples/spring-boot","title":"Spring Boot","description":"Backup and restore Kafka for Spring Boot applications","source":"@site/docs/examples/spring-boot.md","sourceDirName":"examples","slug":"/examples/spring-boot","permalink":"/examples/spring-boot","draft":false,"unlisted":false,"editUrl":"https://github.com/osodevops/kafka-backup-docs/tree/main/docs/docs/examples/spring-boot.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Spring Boot","description":"Backup and restore Kafka for Spring Boot applications","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Kafka Streams","permalink":"/examples/kafka-streams"},"next":{"title":"AWS Lambda","permalink":"/examples/aws-lambda"}}');var a=r(4848),o=r(8453);const t={title:"Spring Boot",description:"Backup and restore Kafka for Spring Boot applications",sidebar_position:2},i="Spring Boot Example",c={},l=[{value:"Spring Kafka Architecture",id:"spring-kafka-architecture",level:2},{value:"Sample Application",id:"sample-application",level:2},{value:"Application Properties",id:"application-properties",level:3},{value:"Consumer Code",id:"consumer-code",level:3},{value:"Producer Code",id:"producer-code",level:3},{value:"Backup Configuration",id:"backup-configuration",level:2},{value:"Complete Backup",id:"complete-backup",level:3},{value:"Backup with Spring Cloud Stream",id:"backup-with-spring-cloud-stream",level:3},{value:"Restore Strategies",id:"restore-strategies",level:2},{value:"Strategy 1: Resume Processing",id:"strategy-1-resume-processing",level:3},{value:"Strategy 2: Reprocess All Messages",id:"strategy-2-reprocess-all-messages",level:3},{value:"Strategy 3: PITR Restore",id:"strategy-3-pitr-restore",level:3},{value:"Handling Dead Letter Topics",id:"handling-dead-letter-topics",level:2},{value:"Backup DLT Topics",id:"backup-dlt-topics",level:3},{value:"Restore DLT for Analysis",id:"restore-dlt-for-analysis",level:3},{value:"Reprocess DLT Messages",id:"reprocess-dlt-messages",level:3},{value:"Consumer Group Management",id:"consumer-group-management",level:2},{value:"Check Consumer Group Status",id:"check-consumer-group-status",level:3},{value:"Application-Side Offset Reset",id:"application-side-offset-reset",level:3},{value:"Manual Offset Management",id:"manual-offset-management",level:3},{value:"Kubernetes Deployment",id:"kubernetes-deployment",level:2},{value:"Backup CronJob",id:"backup-cronjob",level:3},{value:"Restore with Application Shutdown",id:"restore-with-application-shutdown",level:3},{value:"Testing Restore Locally",id:"testing-restore-locally",level:2},{value:"Docker Compose Setup",id:"docker-compose-setup",level:3},{value:"Test Script",id:"test-script",level:3},{value:"Integration Tests",id:"integration-tests",level:2},{value:"Test Backup/Restore Cycle",id:"test-backuprestore-cycle",level:3},{value:"Configuration Reference",id:"configuration-reference",level:2},{value:"Production Configuration",id:"production-configuration",level:3},{value:"Access Backup Metadata",id:"access-backup-metadata",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"spring-boot-example",children:"Spring Boot Example"})}),"\n",(0,a.jsx)(n.p,{children:"This guide shows how to backup and restore Kafka data for Spring Boot applications using Spring Kafka."}),"\n",(0,a.jsx)(n.h2,{id:"spring-kafka-architecture",children:"Spring Kafka Architecture"}),"\n",(0,a.jsx)(n.p,{children:"Typical Spring Boot application with Kafka:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Spring Boot Application                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u2502\n\u2502  \u2502  KafkaTemplate   \u2502    \u2502  @KafkaListener  \u2502                      \u2502\n\u2502  \u2502  (Producer)      \u2502    \u2502  (Consumer)      \u2502                      \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                      \u2502\n\u2502           \u2502                       \u2502                                 \u2502\n\u2502           \u2502                       \u2502                                 \u2502\n\u2502           \u25bc                       \u25bc                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                      \u2502\n\u2502  \u2502   Output Topic   \u2502    \u2502   Input Topic    \u2502                      \u2502\n\u2502  \u2502   (orders-out)   \u2502    \u2502   (orders-in)    \u2502                      \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                      \u2502\n\u2502                                                                     \u2502\n\u2502  Consumer Group: ${spring.kafka.consumer.group-id}                 \u2502\n\u2502                                                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,a.jsx)(n.h2,{id:"sample-application",children:"Sample Application"}),"\n",(0,a.jsx)(n.h3,{id:"application-properties",children:"Application Properties"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="application.yml"',children:"spring:\n  kafka:\n    bootstrap-servers: kafka:9092\n    consumer:\n      group-id: order-service\n      auto-offset-reset: earliest\n      enable-auto-commit: false\n      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer\n      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer\n    producer:\n      key-serializer: org.apache.kafka.common.serialization.StringSerializer\n      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer\n    listener:\n      ack-mode: MANUAL\n"})}),"\n",(0,a.jsx)(n.h3,{id:"consumer-code",children:"Consumer Code"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@Service\npublic class OrderConsumer {\n\n    @KafkaListener(topics = "orders-in", groupId = "order-service")\n    public void processOrder(\n            @Payload Order order,\n            @Header(KafkaHeaders.OFFSET) long offset,\n            Acknowledgment ack) {\n\n        log.info("Processing order {} at offset {}", order.getId(), offset);\n\n        // Process order\n        orderService.process(order);\n\n        // Manual commit\n        ack.acknowledge();\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"producer-code",children:"Producer Code"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@Service\npublic class OrderProducer {\n\n    private final KafkaTemplate<String, Order> kafkaTemplate;\n\n    public void sendOrder(Order order) {\n        kafkaTemplate.send("orders-out", order.getId(), order)\n            .whenComplete((result, ex) -> {\n                if (ex == null) {\n                    log.info("Sent order {} to partition {} offset {}",\n                        order.getId(),\n                        result.getRecordMetadata().partition(),\n                        result.getRecordMetadata().offset());\n                }\n            });\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"backup-configuration",children:"Backup Configuration"}),"\n",(0,a.jsx)(n.h3,{id:"complete-backup",children:"Complete Backup"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="spring-backup.yaml"',children:'mode: backup\nbackup_id: "order-service-${TIMESTAMP}"\n\nsource:\n  bootstrap_servers:\n    - kafka:9092\n  topics:\n    include:\n      - orders-in\n      - orders-out\n      # DLQ topics\n      - orders-in.DLT\n      # Retry topics (if using Spring Retry)\n      - orders-in-retry-0\n      - orders-in-retry-1\n      - orders-in-retry-2\n\nstorage:\n  backend: s3\n  bucket: kafka-backups\n  prefix: spring/order-service\n\nbackup:\n  compression: zstd\n  include_offset_headers: true\n  source_cluster_id: "production"\n'})}),"\n",(0,a.jsx)(n.h3,{id:"backup-with-spring-cloud-stream",children:"Backup with Spring Cloud Stream"}),"\n",(0,a.jsx)(n.p,{children:"If using Spring Cloud Stream:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'source:\n  topics:\n    include:\n      # Input bindings\n      - orders-in\n      # Output bindings\n      - orders-out\n      # Error channel\n      - orders-error\n      # Spring Cloud Stream internal topics\n      - "springCloudBus.*"\n'})}),"\n",(0,a.jsx)(n.h2,{id:"restore-strategies",children:"Restore Strategies"}),"\n",(0,a.jsx)(n.h3,{id:"strategy-1-resume-processing",children:"Strategy 1: Resume Processing"}),"\n",(0,a.jsx)(n.p,{children:"Restore and continue from where the application left off:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="spring-restore-resume.yaml"',children:'mode: restore\nbackup_id: "order-service-20241201"\n\ntarget:\n  bootstrap_servers:\n    - target-kafka:9092\n\nrestore:\n  include_original_offset_header: true\n  consumer_group_strategy: header-based\n  reset_consumer_offsets: true\n  consumer_groups:\n    - order-service\n\nstorage:\n  backend: s3\n  bucket: kafka-backups\n  prefix: spring/order-service\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Execute three-phase restore\nkafka-backup three-phase-restore --config spring-restore-resume.yaml\n"})}),"\n",(0,a.jsx)(n.h3,{id:"strategy-2-reprocess-all-messages",children:"Strategy 2: Reprocess All Messages"}),"\n",(0,a.jsx)(n.p,{children:"Restore and reprocess everything from the beginning:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="spring-restore-reprocess.yaml"',children:'mode: restore\nbackup_id: "order-service-20241201"\n\ntarget:\n  bootstrap_servers:\n    - target-kafka:9092\n\nrestore:\n  consumer_group_strategy: earliest\n  consumer_groups:\n    - order-service\n'})}),"\n",(0,a.jsx)(n.h3,{id:"strategy-3-pitr-restore",children:"Strategy 3: PITR Restore"}),"\n",(0,a.jsx)(n.p,{children:"Restore to a specific point in time:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="spring-restore-pitr.yaml"',children:'mode: restore\nbackup_id: "order-service-20241201"\n\ntarget:\n  bootstrap_servers:\n    - target-kafka:9092\n\nrestore:\n  time_window_end: 1701450000000  # Before the incident\n  include_original_offset_header: true\n\n  consumer_group_strategy: timestamp\n  consumer_group_timestamp: 1701450000000\n  consumer_groups:\n    - order-service\n'})}),"\n",(0,a.jsx)(n.h2,{id:"handling-dead-letter-topics",children:"Handling Dead Letter Topics"}),"\n",(0,a.jsxs)(n.p,{children:["Spring Kafka's ",(0,a.jsx)(n.code,{children:"@RetryableTopic"})," creates DLT topics:"]}),"\n",(0,a.jsx)(n.h3,{id:"backup-dlt-topics",children:"Backup DLT Topics"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"source:\n  topics:\n    include:\n      - orders-in\n      - orders-in.DLT        # Dead Letter Topic\n      - orders-in-retry-0    # Retry topics\n      - orders-in-retry-1\n      - orders-in-retry-2\n"})}),"\n",(0,a.jsx)(n.h3,{id:"restore-dlt-for-analysis",children:"Restore DLT for Analysis"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"restore:\n  topics:\n    - orders-in.DLT\n\n  topic_mapping:\n    orders-in.DLT: investigation-orders-dlt\n"})}),"\n",(0,a.jsx)(n.h3,{id:"reprocess-dlt-messages",children:"Reprocess DLT Messages"}),"\n",(0,a.jsx)(n.p,{children:"After fixing the issue, reprocess DLT messages:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@KafkaListener(topics = "orders-in.DLT", groupId = "dlt-processor")\npublic void reprocessDlt(\n        @Payload Order order,\n        @Header(KafkaHeaders.DLT_ORIGINAL_TOPIC) String originalTopic,\n        @Header(KafkaHeaders.DLT_ORIGINAL_OFFSET) long originalOffset) {\n\n    log.info("Reprocessing DLT message from {} offset {}",\n        originalTopic, originalOffset);\n\n    // Resend to original topic\n    kafkaTemplate.send(originalTopic, order.getId(), order);\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"consumer-group-management",children:"Consumer Group Management"}),"\n",(0,a.jsx)(n.h3,{id:"check-consumer-group-status",children:"Check Consumer Group Status"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Before restore\nkafka-consumer-groups \\\n  --bootstrap-server kafka:9092 \\\n  --group order-service \\\n  --describe\n\n# Output:\n# TOPIC       PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG\n# orders-in   0          1000            1500            500\n# orders-in   1          800             1200            400\n"})}),"\n",(0,a.jsx)(n.h3,{id:"application-side-offset-reset",children:"Application-Side Offset Reset"}),"\n",(0,a.jsx)(n.p,{children:"Configure Spring to handle reset:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="application.yml"',children:"spring:\n  kafka:\n    consumer:\n      auto-offset-reset: earliest  # or latest\n"})}),"\n",(0,a.jsx)(n.h3,{id:"manual-offset-management",children:"Manual Offset Management"}),"\n",(0,a.jsx)(n.p,{children:"For fine-grained control:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"@Component\npublic class OffsetManager implements ConsumerSeekAware {\n\n    @Override\n    public void onPartitionsAssigned(\n            Map<TopicPartition, Long> assignments,\n            ConsumerSeekCallback callback) {\n\n        // Seek to specific offsets from backup mapping\n        assignments.forEach((tp, offset) -> {\n            Long targetOffset = getOffsetFromMapping(tp);\n            if (targetOffset != null) {\n                callback.seek(tp.topic(), tp.partition(), targetOffset);\n            }\n        });\n    }\n}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"kubernetes-deployment",children:"Kubernetes Deployment"}),"\n",(0,a.jsx)(n.h3,{id:"backup-cronjob",children:"Backup CronJob"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaBackup\nmetadata:\n  name: order-service-backup\nspec:\n  schedule: "0 */2 * * *"  # Every 2 hours\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n  topics:\n    - orders-in\n    - orders-out\n    - orders-in.DLT\n  storage:\n    storageType: s3\n    s3:\n      bucket: kafka-backups\n      prefix: spring/order-service\n'})}),"\n",(0,a.jsx)(n.h3,{id:"restore-with-application-shutdown",children:"Restore with Application Shutdown"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#!/bin/bash\n# restore-order-service.sh\n\nBACKUP_ID="$1"\nNAMESPACE="production"\nDEPLOYMENT="order-service"\n\n# Step 1: Scale down application\necho "Scaling down $DEPLOYMENT..."\nkubectl scale deployment $DEPLOYMENT -n $NAMESPACE --replicas=0\nkubectl wait --for=condition=available=false deployment/$DEPLOYMENT -n $NAMESPACE\n\n# Step 2: Run restore\necho "Restoring from backup $BACKUP_ID..."\nkubectl apply -f - <<EOF\napiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaRestore\nmetadata:\n  name: order-service-restore\n  namespace: kafka-backup\nspec:\n  backupId: "$BACKUP_ID"\n  targetCluster:\n    bootstrapServers:\n      - kafka:9092\n  storage:\n    storageType: s3\n    s3:\n      bucket: kafka-backups\n      prefix: spring/order-service\n  offsetReset:\n    strategy: headerBased\n    consumerGroups:\n      - order-service\nEOF\n\n# Wait for restore\nkubectl wait --for=condition=complete kafkarestore/order-service-restore -n kafka-backup\n\n# Step 3: Scale up application\necho "Scaling up $DEPLOYMENT..."\nkubectl scale deployment $DEPLOYMENT -n $NAMESPACE --replicas=3\n'})}),"\n",(0,a.jsx)(n.h2,{id:"testing-restore-locally",children:"Testing Restore Locally"}),"\n",(0,a.jsx)(n.h3,{id:"docker-compose-setup",children:"Docker Compose Setup"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="docker-compose.yml"',children:"version: '3'\nservices:\n  kafka:\n    image: confluentinc/cp-kafka:7.5.0\n    ports:\n      - \"9092:9092\"\n    environment:\n      KAFKA_BROKER_ID: 1\n      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092\n      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1\n\n  order-service:\n    build: .\n    environment:\n      SPRING_KAFKA_BOOTSTRAP_SERVERS: kafka:9092\n    depends_on:\n      - kafka\n\n  kafka-backup:\n    image: osodevops/kafka-backup:latest\n    volumes:\n      - ./backups:/backups\n    depends_on:\n      - kafka\n"})}),"\n",(0,a.jsx)(n.h3,{id:"test-script",children:"Test Script"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"#!/bin/bash\n# test-restore.sh\n\n# Create backup\ndocker-compose exec kafka-backup kafka-backup backup \\\n  --config /config/backup.yaml\n\n# Simulate data loss\ndocker-compose exec kafka kafka-topics --delete \\\n  --bootstrap-server kafka:9092 --topic orders-in\n\n# Restore\ndocker-compose exec kafka-backup kafka-backup restore \\\n  --config /config/restore.yaml\n\n# Verify\ndocker-compose exec kafka kafka-console-consumer \\\n  --bootstrap-server kafka:9092 \\\n  --topic orders-in \\\n  --from-beginning \\\n  --max-messages 10\n"})}),"\n",(0,a.jsx)(n.h2,{id:"integration-tests",children:"Integration Tests"}),"\n",(0,a.jsx)(n.h3,{id:"test-backuprestore-cycle",children:"Test Backup/Restore Cycle"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@SpringBootTest\n@EmbeddedKafka(partitions = 1, topics = {"orders-in", "orders-out"})\nclass BackupRestoreTest {\n\n    @Autowired\n    private EmbeddedKafkaBroker embeddedKafka;\n\n    @Autowired\n    private KafkaTemplate<String, Order> kafkaTemplate;\n\n    @Test\n    void shouldRestoreMessagesCorrectly() {\n        // Send test messages\n        for (int i = 0; i < 100; i++) {\n            kafkaTemplate.send("orders-in", "order-" + i,\n                new Order("order-" + i, 100.0));\n        }\n\n        // Run backup (use test configuration)\n        // ...\n\n        // Clear topic\n        // ...\n\n        // Run restore\n        // ...\n\n        // Verify messages restored\n        Consumer<String, Order> consumer = createConsumer();\n        consumer.subscribe(List.of("orders-in"));\n\n        ConsumerRecords<String, Order> records =\n            consumer.poll(Duration.ofSeconds(10));\n\n        assertThat(records.count()).isEqualTo(100);\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"configuration-reference",children:"Configuration Reference"}),"\n",(0,a.jsx)(n.h3,{id:"production-configuration",children:"Production Configuration"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="application-prod.yml"',children:"spring:\n  kafka:\n    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS}\n    consumer:\n      group-id: order-service\n      auto-offset-reset: none  # Fail if no offset found\n      enable-auto-commit: false\n      isolation-level: read_committed\n    producer:\n      acks: all\n      retries: 3\n      properties:\n        enable.idempotence: true\n    listener:\n      ack-mode: MANUAL\n      concurrency: 3\n\n# Custom backup metadata\nbackup:\n  cluster-id: ${KAFKA_CLUSTER_ID:production}\n  app-id: order-service\n"})}),"\n",(0,a.jsx)(n.h3,{id:"access-backup-metadata",children:"Access Backup Metadata"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@Configuration\npublic class BackupMetadataConfig {\n\n    @Value("${backup.cluster-id}")\n    private String clusterId;\n\n    @Value("${backup.app-id}")\n    private String appId;\n\n    // Use in offset header matching\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use manual commits"})," (",(0,a.jsx)(n.code,{children:"enable-auto-commit: false"}),") for reliable processing"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Backup DLT topics"})," to investigate failures"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Test restore process"})," in staging environment"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Scale down before restore"})," to avoid conflicts"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use idempotent producers"})," to handle duplicates after restore"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Monitor consumer lag"})," after restore"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"./kafka-streams",children:"Kafka Streams Example"})," - Stateful processing"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"../guides/offset-management",children:"Offset Management"})," - Consumer offsets"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"../deployment/kubernetes",children:"Kubernetes Deployment"})," - K8s setup"]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}}}]);