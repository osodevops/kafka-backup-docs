"use strict";(globalThis.webpackChunkkafka_backup_docs=globalThis.webpackChunkkafka_backup_docs||[]).push([[543],{7933:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"enterprise/schema-registry","title":"Schema Registry","description":"Backup and restore Confluent Schema Registry with OSO Kafka Backup Enterprise","source":"@site/docs/enterprise/schema-registry.md","sourceDirName":"enterprise","slug":"/enterprise/schema-registry","permalink":"/enterprise/schema-registry","draft":false,"unlisted":false,"editUrl":"https://github.com/osodevops/kafka-backup-docs/tree/main/docs/docs/enterprise/schema-registry.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"title":"Schema Registry","description":"Backup and restore Confluent Schema Registry with OSO Kafka Backup Enterprise","sidebar_position":5},"sidebar":"docsSidebar","previous":{"title":"Audit Logging","permalink":"/enterprise/audit-logging"},"next":{"title":"Licensing","permalink":"/enterprise/licensing"}}');var i=s(4848),a=s(8453);const t={title:"Schema Registry",description:"Backup and restore Confluent Schema Registry with OSO Kafka Backup Enterprise",sidebar_position:5},c="Schema Registry Integration",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Why Backup Schema Registry?",id:"why-backup-schema-registry",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Basic Schema Registry Backup",id:"basic-schema-registry-backup",level:3},{value:"Complete Configuration",id:"complete-configuration",level:3},{value:"Authentication",id:"authentication",level:2},{value:"Basic Auth",id:"basic-auth",level:3},{value:"mTLS",id:"mtls",level:3},{value:"OAuth/OIDC",id:"oauthoidc",level:3},{value:"Backup Process",id:"backup-process",level:2},{value:"What Gets Backed Up",id:"what-gets-backed-up",level:3},{value:"Backup Storage Structure",id:"backup-storage-structure",level:3},{value:"Schema Manifest",id:"schema-manifest",level:3},{value:"Restore Process",id:"restore-process",level:2},{value:"Restore Order",id:"restore-order",level:3},{value:"Restore Strategies",id:"restore-strategies",level:3},{value:"Preserve (Default)",id:"preserve-default",level:4},{value:"Overwrite",id:"overwrite",level:4},{value:"Skip",id:"skip",level:4},{value:"Schema ID Mapping",id:"schema-id-mapping",level:3},{value:"Subject Selection",id:"subject-selection",level:2},{value:"Backup Specific Subjects",id:"backup-specific-subjects",level:3},{value:"Exclude Subjects",id:"exclude-subjects",level:3},{value:"Map Subjects During Restore",id:"map-subjects-during-restore",level:3},{value:"Schema Types",id:"schema-types",level:2},{value:"Avro",id:"avro",level:3},{value:"JSON Schema",id:"json-schema",level:3},{value:"Protobuf",id:"protobuf",level:3},{value:"Schema References",id:"schema-references",level:3},{value:"Verification",id:"verification",level:2},{value:"Verify Schema Backup",id:"verify-schema-backup",level:3},{value:"Verify Schema Restore",id:"verify-schema-restore",level:3},{value:"Kubernetes Configuration",id:"kubernetes-configuration",level:2},{value:"Secrets for Schema Registry",id:"secrets-for-schema-registry",level:3},{value:"Operator Configuration",id:"operator-configuration",level:3},{value:"Migration Scenarios",id:"migration-scenarios",level:2},{value:"Same Schema IDs Required",id:"same-schema-ids-required",level:3},{value:"ID Rewriting (Recommended)",id:"id-rewriting-recommended",level:3},{value:"Manual ID Mapping",id:"manual-id-mapping",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Schema Registration Failed",id:"schema-registration-failed",level:3},{value:"Schema ID Not Found",id:"schema-id-not-found",level:3},{value:"Reference Not Found",id:"reference-not-found",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Next Steps",id:"next-steps",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"schema-registry-integration",children:"Schema Registry Integration"})}),"\n",(0,i.jsx)(n.p,{children:"OSO Kafka Backup Enterprise supports backing up and restoring Confluent Schema Registry alongside your Kafka data."}),"\n",(0,i.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,i.jsx)(n.p,{children:"Schema Registry integration provides:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Backup all schemas with your Kafka data"}),"\n",(0,i.jsx)(n.li,{children:"Restore schemas before restoring messages"}),"\n",(0,i.jsx)(n.li,{children:"Maintain schema compatibility during migration"}),"\n",(0,i.jsx)(n.li,{children:"Support for Avro, JSON Schema, and Protobuf"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"why-backup-schema-registry",children:"Why Backup Schema Registry?"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Without Schema Backup:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Kafka Cluster  \u2502     \u2502 Schema Registry \u2502\n\u2502                 \u2502     \u2502                 \u2502\n\u2502  Messages \u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500 Schema IDs    \u2502\n\u2502  (serialized)   \u2502     \u2502  (references)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502                       \u2502\n    \u2713 Backed up              \u2717 NOT backed up\n         \u2502                       \u2502\n         \u25bc                       \u25bc\n    Restore fails: "Schema ID 42 not found"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"With Schema Backup:\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Kafka Cluster  \u2502     \u2502 Schema Registry \u2502\n\u2502                 \u2502     \u2502                 \u2502\n\u2502  Messages \u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500 Schema IDs    \u2502\n\u2502  (serialized)   \u2502     \u2502  (references)   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502                       \u2502\n    \u2713 Backed up              \u2713 Backed up\n         \u2502                       \u2502\n         \u25bc                       \u25bc\n    Restore succeeds with correct schemas\n"})}),"\n",(0,i.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"basic-schema-registry-backup",children:"Basic Schema Registry Backup"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"enterprise:\n  schema_registry:\n    enabled: true\n    url: https://schema-registry:8081\n\n    # Authentication (if required)\n    auth:\n      type: basic\n      username: ${SR_USERNAME}\n      password: ${SR_PASSWORD}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"complete-configuration",children:"Complete Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'mode: backup\nbackup_id: "full-backup-with-schemas"\n\nsource:\n  bootstrap_servers:\n    - kafka:9092\n  topics:\n    include:\n      - "*"\n\nstorage:\n  backend: s3\n  bucket: kafka-backups\n  prefix: production\n\nenterprise:\n  schema_registry:\n    enabled: true\n    url: https://schema-registry:8081\n\n    # Authentication\n    auth:\n      type: basic\n      username: ${SR_USERNAME}\n      password: ${SR_PASSWORD}\n\n    # TLS configuration\n    tls:\n      ca_cert: /certs/ca.crt\n      client_cert: /certs/client.crt\n      client_key: /certs/client.key\n\n    # What to backup\n    backup:\n      subjects: "*"  # All subjects, or specific patterns\n      include_soft_deleted: false\n      include_versions: all  # or: latest\n\n    # Restore behavior\n    restore:\n      enabled: true\n      strategy: preserve  # preserve, overwrite, skip\n      id_mapping: true  # Maintain schema ID references\n'})}),"\n",(0,i.jsx)(n.h2,{id:"authentication",children:"Authentication"}),"\n",(0,i.jsx)(n.h3,{id:"basic-auth",children:"Basic Auth"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"enterprise:\n  schema_registry:\n    auth:\n      type: basic\n      username: admin\n      password: ${SR_PASSWORD}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"mtls",children:"mTLS"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"enterprise:\n  schema_registry:\n    url: https://schema-registry:8081\n    auth:\n      type: mtls\n    tls:\n      ca_cert: /certs/ca.crt\n      client_cert: /certs/client.crt\n      client_key: /certs/client.key\n"})}),"\n",(0,i.jsx)(n.h3,{id:"oauthoidc",children:"OAuth/OIDC"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"enterprise:\n  schema_registry:\n    auth:\n      type: oauth\n      token_url: https://auth.company.com/oauth/token\n      client_id: ${SR_CLIENT_ID}\n      client_secret: ${SR_CLIENT_SECRET}\n      scope: schema-registry\n"})}),"\n",(0,i.jsx)(n.h2,{id:"backup-process",children:"Backup Process"}),"\n",(0,i.jsx)(n.h3,{id:"what-gets-backed-up",children:"What Gets Backed Up"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Item"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Subjects"})}),(0,i.jsx)(n.td,{children:"All schema subjects"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Versions"})}),(0,i.jsx)(n.td,{children:"All versions per subject"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Schemas"})}),(0,i.jsx)(n.td,{children:"The actual schema definitions"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Compatibility"})}),(0,i.jsx)(n.td,{children:"Compatibility settings per subject"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"Mode"})}),(0,i.jsx)(n.td,{children:"Import/ReadOnly mode"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"References"})}),(0,i.jsx)(n.td,{children:"Schema references (for complex schemas)"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"backup-storage-structure",children:"Backup Storage Structure"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"backup/\n\u251c\u2500\u2500 manifest.json\n\u251c\u2500\u2500 kafka/\n\u2502   \u2514\u2500\u2500 (kafka data segments)\n\u2514\u2500\u2500 schema-registry/\n    \u251c\u2500\u2500 _schemas.json          # Global settings\n    \u251c\u2500\u2500 subjects/\n    \u2502   \u251c\u2500\u2500 orders-value/\n    \u2502   \u2502   \u251c\u2500\u2500 metadata.json  # Subject settings\n    \u2502   \u2502   \u251c\u2500\u2500 v1.avsc        # Schema version 1\n    \u2502   \u2502   \u251c\u2500\u2500 v2.avsc        # Schema version 2\n    \u2502   \u2502   \u2514\u2500\u2500 ...\n    \u2502   \u251c\u2500\u2500 payments-value/\n    \u2502   \u2502   \u2514\u2500\u2500 ...\n    \u2502   \u2514\u2500\u2500 ...\n    \u2514\u2500\u2500 config/\n        \u2514\u2500\u2500 global.json        # Global compatibility\n"})}),"\n",(0,i.jsx)(n.h3,{id:"schema-manifest",children:"Schema Manifest"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "schema_registry_version": "7.5.0",\n  "backup_timestamp": "2024-12-01T10:00:00Z",\n  "subjects": [\n    {\n      "name": "orders-value",\n      "schema_type": "AVRO",\n      "compatibility": "BACKWARD",\n      "versions": [\n        {\n          "version": 1,\n          "id": 1,\n          "schema_file": "subjects/orders-value/v1.avsc"\n        },\n        {\n          "version": 2,\n          "id": 5,\n          "schema_file": "subjects/orders-value/v2.avsc"\n        }\n      ]\n    }\n  ],\n  "id_mapping": {\n    "1": "subjects/orders-value/v1.avsc",\n    "5": "subjects/orders-value/v2.avsc"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"restore-process",children:"Restore Process"}),"\n",(0,i.jsx)(n.h3,{id:"restore-order",children:"Restore Order"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"1. Restore Schema Registry\n   \u251c\u2500\u2500 Create subjects\n   \u251c\u2500\u2500 Register schemas (with ID mapping)\n   \u2514\u2500\u2500 Set compatibility levels\n\n2. Restore Kafka Data\n   \u251c\u2500\u2500 Messages reference schema IDs\n   \u2514\u2500\u2500 IDs now exist in target registry\n"})}),"\n",(0,i.jsx)(n.h3,{id:"restore-strategies",children:"Restore Strategies"}),"\n",(0,i.jsx)(n.h4,{id:"preserve-default",children:"Preserve (Default)"}),"\n",(0,i.jsx)(n.p,{children:"Keep existing schemas, only add missing:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'enterprise:\n  schema_registry:\n    restore:\n      strategy: preserve\n      # Existing subject "orders-value" with v1, v2\n      # Backup has v1, v2, v3\n      # Result: v1, v2 unchanged, v3 added\n'})}),"\n",(0,i.jsx)(n.h4,{id:"overwrite",children:"Overwrite"}),"\n",(0,i.jsx)(n.p,{children:"Replace existing schemas:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"enterprise:\n  schema_registry:\n    restore:\n      strategy: overwrite\n      # Warning: May break existing consumers\n"})}),"\n",(0,i.jsx)(n.h4,{id:"skip",children:"Skip"}),"\n",(0,i.jsx)(n.p,{children:"Don't restore schemas that already exist:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"enterprise:\n  schema_registry:\n    restore:\n      strategy: skip\n      # Only restore to empty subjects\n"})}),"\n",(0,i.jsx)(n.h3,{id:"schema-id-mapping",children:"Schema ID Mapping"}),"\n",(0,i.jsx)(n.p,{children:"The critical challenge: Schema IDs may differ between registries."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Source Registry:\n  orders-value v1 \u2192 ID: 1\n  orders-value v2 \u2192 ID: 5\n  payments-value v1 \u2192 ID: 2\n\nTarget Registry (empty):\n  orders-value v1 \u2192 ID: 1   (same!)\n  orders-value v2 \u2192 ID: 2   (different!)\n  payments-value v1 \u2192 ID: 3 (different!)\n"})}),"\n",(0,i.jsx)(n.p,{children:"OSO Kafka Backup handles this automatically:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"enterprise:\n  schema_registry:\n    restore:\n      id_mapping: true\n\n      # Option 1: Rewrite message schema IDs (recommended)\n      rewrite_ids: true\n\n      # Option 2: Force original IDs (requires empty registry)\n      force_ids: false\n"})}),"\n",(0,i.jsxs)(n.p,{children:["With ",(0,i.jsx)(n.code,{children:"rewrite_ids: true"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Message in backup:\n  Magic byte + Schema ID 5 + Avro data\n\nMessage after restore:\n  Magic byte + Schema ID 2 + Avro data\n  (ID rewritten to match target registry)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"subject-selection",children:"Subject Selection"}),"\n",(0,i.jsx)(n.h3,{id:"backup-specific-subjects",children:"Backup Specific Subjects"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'enterprise:\n  schema_registry:\n    backup:\n      subjects:\n        - "orders-*"\n        - "payments-*"\n        - "users-value"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"exclude-subjects",children:"Exclude Subjects"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'enterprise:\n  schema_registry:\n    backup:\n      subjects: "*"\n      exclude:\n        - "*-test"\n        - "internal-*"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"map-subjects-during-restore",children:"Map Subjects During Restore"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'enterprise:\n  schema_registry:\n    restore:\n      subject_mapping:\n        "orders-value": "restored-orders-value"\n        "payments-value": "restored-payments-value"\n'})}),"\n",(0,i.jsx)(n.h2,{id:"schema-types",children:"Schema Types"}),"\n",(0,i.jsx)(n.h3,{id:"avro",children:"Avro"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"enterprise:\n  schema_registry:\n    enabled: true\n    # Avro is default, no special config needed\n"})}),"\n",(0,i.jsx)(n.h3,{id:"json-schema",children:"JSON Schema"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"enterprise:\n  schema_registry:\n    schema_types:\n      - AVRO\n      - JSON\n"})}),"\n",(0,i.jsx)(n.h3,{id:"protobuf",children:"Protobuf"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"enterprise:\n  schema_registry:\n    schema_types:\n      - AVRO\n      - PROTOBUF\n\n    protobuf:\n      # Include dependent .proto files\n      include_dependencies: true\n"})}),"\n",(0,i.jsx)(n.h3,{id:"schema-references",children:"Schema References"}),"\n",(0,i.jsx)(n.p,{children:"For schemas that reference other schemas:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "schema": "...",\n  "references": [\n    {\n      "name": "common.Address",\n      "subject": "common-address-value",\n      "version": 1\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"These references are preserved during backup/restore."}),"\n",(0,i.jsx)(n.h2,{id:"verification",children:"Verification"}),"\n",(0,i.jsx)(n.h3,{id:"verify-schema-backup",children:"Verify Schema Backup"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kafka-backup describe \\\n  --path s3://bucket/backups \\\n  --backup-id my-backup \\\n  --format json | jq '.schema_registry'\n"})}),"\n",(0,i.jsx)(n.p,{children:"Output:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "enabled": true,\n  "subjects_count": 25,\n  "schemas_count": 48,\n  "subjects": [\n    {\n      "name": "orders-value",\n      "versions": 3,\n      "latest_id": 15\n    }\n  ]\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"verify-schema-restore",children:"Verify Schema Restore"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# List subjects in target registry\ncurl -u admin:password https://target-sr:8081/subjects\n\n# Compare schema counts\ncurl https://source-sr:8081/subjects | jq length\ncurl https://target-sr:8081/subjects | jq length\n"})}),"\n",(0,i.jsx)(n.h2,{id:"kubernetes-configuration",children:"Kubernetes Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"secrets-for-schema-registry",children:"Secrets for Schema Registry"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: schema-registry-credentials\n  namespace: kafka-backup\ntype: Opaque\nstringData:\n  username: admin\n  password: your-password\n"})}),"\n",(0,i.jsx)(n.h3,{id:"operator-configuration",children:"Operator Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaBackup\nmetadata:\n  name: backup-with-schemas\nspec:\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n\n  enterprise:\n    licenseSecret:\n      name: kafka-backup-license\n\n    schemaRegistry:\n      enabled: true\n      url: https://schema-registry:8081\n      credentialsSecret:\n        name: schema-registry-credentials\n        usernameKey: username\n        passwordKey: password\n"})}),"\n",(0,i.jsx)(n.h2,{id:"migration-scenarios",children:"Migration Scenarios"}),"\n",(0,i.jsx)(n.h3,{id:"same-schema-ids-required",children:"Same Schema IDs Required"}),"\n",(0,i.jsx)(n.p,{children:"For consumers that can't be updated:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"enterprise:\n  schema_registry:\n    restore:\n      # Requires empty target registry\n      force_ids: true\n"})}),"\n",(0,i.jsx)(n.h3,{id:"id-rewriting-recommended",children:"ID Rewriting (Recommended)"}),"\n",(0,i.jsx)(n.p,{children:"For most migrations:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"enterprise:\n  schema_registry:\n    restore:\n      rewrite_ids: true\n      # Messages are modified during restore\n      # Target registry assigns new IDs\n      # Message schema ID references updated\n"})}),"\n",(0,i.jsx)(n.h3,{id:"manual-id-mapping",children:"Manual ID Mapping"}),"\n",(0,i.jsx)(n.p,{children:"For complex scenarios:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'enterprise:\n  schema_registry:\n    restore:\n      id_mapping_file: /config/id-mapping.json\n\n# id-mapping.json:\n# {\n#   "1": 100,\n#   "5": 101,\n#   "2": 102\n# }\n'})}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"schema-registration-failed",children:"Schema Registration Failed"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Error: Schema registration failed for subject orders-value\nCause: Schema is incompatible with an earlier schema\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Solution:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"enterprise:\n  schema_registry:\n    restore:\n      # Option 1: Change compatibility\n      set_compatibility: NONE\n\n      # Option 2: Force schema (dangerous)\n      force_register: true\n"})}),"\n",(0,i.jsx)(n.h3,{id:"schema-id-not-found",children:"Schema ID Not Found"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Error: Schema ID 42 not found in target registry\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Ensure schemas are restored before Kafka data:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"enterprise:\n  schema_registry:\n    restore:\n      enabled: true\n      # Schemas restored first automatically\n"})}),"\n",(0,i.jsx)(n.h3,{id:"reference-not-found",children:"Reference Not Found"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Error: Reference to subject 'common-address-value' not found\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solution:"})," Include referenced subjects:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'enterprise:\n  schema_registry:\n    backup:\n      subjects:\n        - "orders-*"\n        - "common-*"  # Include referenced subjects\n      include_references: true\n'})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Always backup schemas with data"})," - They're tightly coupled"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use ID rewriting for migrations"})," - Most compatible approach"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Test schema restore first"})," - Before restoring data"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Include all referenced schemas"})," - For complex schemas"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Document compatibility settings"})," - Know your requirements"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Verify after restore"})," - Check schema counts and IDs"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"../use-cases/migration",children:"Migration Guide"})," - Full migration process"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./encryption",children:"Encryption"})," - Protect schema content"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"../troubleshooting/common-errors",children:"Troubleshooting"})," - Common issues"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>c});var r=s(6540);const i={},a=r.createContext(i);function t(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);