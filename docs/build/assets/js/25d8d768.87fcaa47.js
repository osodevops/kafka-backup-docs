"use strict";(globalThis.webpackChunkkafka_backup_docs=globalThis.webpackChunkkafka_backup_docs||[]).push([[6193],{2005:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"operator/crds/kafkaoffsetrollback","title":"KafkaOffsetRollback","description":"KafkaOffsetRollback Custom Resource Definition reference","source":"@site/docs/operator/crds/kafkaoffsetrollback.md","sourceDirName":"operator/crds","slug":"/operator/crds/kafkaoffsetrollback","permalink":"/operator/crds/kafkaoffsetrollback","draft":false,"unlisted":false,"editUrl":"https://github.com/osodevops/kafka-backup-docs/tree/main/docs/docs/operator/crds/kafkaoffsetrollback.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"KafkaOffsetRollback","description":"KafkaOffsetRollback Custom Resource Definition reference","sidebar_position":4},"sidebar":"docsSidebar","previous":{"title":"KafkaOffsetReset","permalink":"/operator/crds/kafkaoffsetreset"},"next":{"title":"Scheduled Backups","permalink":"/operator/guides/scheduled-backups"}}');var o=s(4848),t=s(8453);const r={title:"KafkaOffsetRollback",description:"KafkaOffsetRollback Custom Resource Definition reference",sidebar_position:4},i="KafkaOffsetRollback CRD",l={},c=[{value:"Overview",id:"overview",level:2},{value:"Full Specification",id:"full-specification",level:2},{value:"Operations",id:"operations",level:2},{value:"snapshot",id:"snapshot",level:3},{value:"rollback",id:"rollback",level:3},{value:"verify",id:"verify",level:3},{value:"delete",id:"delete",level:3},{value:"Spec Fields",id:"spec-fields",level:2},{value:"operation",id:"operation",level:3},{value:"storage",id:"storage",level:3},{value:"Status",id:"status",level:2},{value:"Snapshot Format",id:"snapshot-format",level:2},{value:"Examples",id:"examples",level:2},{value:"Pre-Migration Snapshot",id:"pre-migration-snapshot",level:3},{value:"Emergency Rollback",id:"emergency-rollback",level:3},{value:"Verification After Rollback",id:"verification-after-rollback",level:3},{value:"Snapshot to ConfigMap",id:"snapshot-to-configmap",level:3},{value:"Operations",id:"operations-1",level:2},{value:"List Snapshots",id:"list-snapshots",level:3},{value:"Check Snapshot Contents",id:"check-snapshot-contents",level:3},{value:"Delete Old Snapshots",id:"delete-old-snapshots",level:3},{value:"Workflow Example",id:"workflow-example",level:2},{value:"Next Steps",id:"next-steps",level:2}];function p(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"kafkaoffsetrollback-crd",children:"KafkaOffsetRollback CRD"})}),"\n",(0,o.jsxs)(n.p,{children:["The ",(0,o.jsx)(n.code,{children:"KafkaOffsetRollback"})," custom resource manages consumer offset snapshots and rollbacks."]}),"\n",(0,o.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:"apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetRollback\nmetadata:\n  name: my-rollback\n  namespace: kafka-backup\nspec:\n  operation: snapshot  # snapshot, rollback, verify, delete\n  # Operation configuration\n"})}),"\n",(0,o.jsx)(n.h2,{id:"full-specification",children:"Full Specification"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetRollback\nmetadata:\n  name: offset-rollback\n  namespace: kafka-backup\nspec:\n  # Kafka cluster\n  kafkaCluster:\n    bootstrapServers:\n      - kafka-0.kafka.svc:9092\n      - kafka-1.kafka.svc:9092\n    securityProtocol: SASL_SSL\n    tlsSecret:\n      name: kafka-tls\n      caKey: ca.crt\n    saslSecret:\n      name: kafka-credentials\n      mechanism: SCRAM-SHA-256\n      usernameKey: username\n      passwordKey: password\n\n  # Consumer groups\n  consumerGroups:\n    - order-processor\n    - payment-handler\n\n  # Operation to perform\n  operation: snapshot  # snapshot, rollback, verify, delete\n\n  # Snapshot ID (required for all operations)\n  snapshotId: "pre-migration-snapshot"\n\n  # Storage for snapshot data\n  storage:\n    storageType: s3  # s3, azure, gcs, pvc, configmap\n    s3:\n      bucket: kafka-offset-snapshots\n      region: us-west-2\n      prefix: snapshots\n    # Or use ConfigMap for small snapshots\n    configMap:\n      name: offset-snapshots\n\n  # Verification options (for verify operation)\n  verify:\n    strict: true  # Fail if offsets don\'t match exactly\n\n  # Resource requirements\n  resources:\n    requests:\n      cpu: 100m\n      memory: 128Mi\n    limits:\n      cpu: 200m\n      memory: 256Mi\n\n  # Job configuration\n  job:\n    backoffLimit: 3\n    activeDeadlineSeconds: 600\n    ttlSecondsAfterFinished: 3600\n'})}),"\n",(0,o.jsx)(n.h2,{id:"operations",children:"Operations"}),"\n",(0,o.jsx)(n.h3,{id:"snapshot",children:"snapshot"}),"\n",(0,o.jsx)(n.p,{children:"Create a snapshot of current consumer group offsets:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetRollback\nmetadata:\n  name: create-snapshot\nspec:\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n  consumerGroups:\n    - order-processor\n    - payment-handler\n  operation: snapshot\n  snapshotId: "pre-migration-20241201"\n  storage:\n    storageType: configMap\n    configMap:\n      name: offset-snapshots\n'})}),"\n",(0,o.jsx)(n.h3,{id:"rollback",children:"rollback"}),"\n",(0,o.jsx)(n.p,{children:"Restore offsets from a snapshot:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetRollback\nmetadata:\n  name: do-rollback\nspec:\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n  consumerGroups:\n    - order-processor\n    - payment-handler\n  operation: rollback\n  snapshotId: "pre-migration-20241201"\n  storage:\n    storageType: configMap\n    configMap:\n      name: offset-snapshots\n'})}),"\n",(0,o.jsx)(n.h3,{id:"verify",children:"verify"}),"\n",(0,o.jsx)(n.p,{children:"Verify current offsets match a snapshot:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetRollback\nmetadata:\n  name: verify-offsets\nspec:\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n  consumerGroups:\n    - order-processor\n  operation: verify\n  snapshotId: "pre-migration-20241201"\n  storage:\n    storageType: configMap\n    configMap:\n      name: offset-snapshots\n  verify:\n    strict: true\n'})}),"\n",(0,o.jsx)(n.h3,{id:"delete",children:"delete"}),"\n",(0,o.jsx)(n.p,{children:"Delete a snapshot:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetRollback\nmetadata:\n  name: delete-snapshot\nspec:\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n  operation: delete\n  snapshotId: "pre-migration-20241201"\n  storage:\n    storageType: configMap\n    configMap:\n      name: offset-snapshots\n'})}),"\n",(0,o.jsx)(n.h2,{id:"spec-fields",children:"Spec Fields"}),"\n",(0,o.jsx)(n.h3,{id:"operation",children:"operation"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Value"}),(0,o.jsx)(n.th,{children:"Description"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"snapshot"})}),(0,o.jsx)(n.td,{children:"Create snapshot of current offsets"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"rollback"})}),(0,o.jsx)(n.td,{children:"Restore offsets from snapshot"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"verify"})}),(0,o.jsx)(n.td,{children:"Compare current offsets to snapshot"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"delete"})}),(0,o.jsx)(n.td,{children:"Delete a snapshot"})]})]})]}),"\n",(0,o.jsx)(n.h3,{id:"storage",children:"storage"}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Type"}),(0,o.jsx)(n.th,{children:"Description"}),(0,o.jsx)(n.th,{children:"Use Case"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"configMap"})}),(0,o.jsx)(n.td,{children:"Store in Kubernetes ConfigMap"}),(0,o.jsx)(n.td,{children:"Small snapshots"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"s3"})}),(0,o.jsx)(n.td,{children:"Store in S3"}),(0,o.jsx)(n.td,{children:"Large/many groups"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"azure"})}),(0,o.jsx)(n.td,{children:"Store in Azure Blob"}),(0,o.jsx)(n.td,{children:"Azure environments"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"gcs"})}),(0,o.jsx)(n.td,{children:"Store in GCS"}),(0,o.jsx)(n.td,{children:"GCP environments"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"pvc"})}),(0,o.jsx)(n.td,{children:"Store in PVC"}),(0,o.jsx)(n.td,{children:"Local storage"})]})]})]}),"\n",(0,o.jsx)(n.h2,{id:"status",children:"Status"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'status:\n  phase: Completed  # Pending, Running, Completed, Failed\n  operation: snapshot\n  snapshotId: "pre-migration-20241201"\n  startTime: "2024-12-01T12:00:00Z"\n  completionTime: "2024-12-01T12:00:05Z"\n  snapshotData:\n    groups: 2\n    totalPartitions: 12\n    timestamp: "2024-12-01T12:00:00Z"\n  # For verify operation\n  verificationResult:\n    matched: true\n    differences: []\n  conditions:\n    - type: Ready\n      status: "True"\n      reason: SnapshotCreated\n      message: "Snapshot pre-migration-20241201 created successfully"\n      lastTransitionTime: "2024-12-01T12:00:05Z"\n'})}),"\n",(0,o.jsx)(n.h2,{id:"snapshot-format",children:"Snapshot Format"}),"\n",(0,o.jsx)(n.p,{children:"Snapshots are stored as JSON:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n  "snapshotId": "pre-migration-20241201",\n  "timestamp": "2024-12-01T12:00:00Z",\n  "cluster": "kafka:9092",\n  "groups": {\n    "order-processor": {\n      "topics": {\n        "orders": {\n          "0": {\n            "offset": 1000,\n            "metadata": "",\n            "timestamp": 1701432000000\n          },\n          "1": {\n            "offset": 2000,\n            "metadata": "",\n            "timestamp": 1701432000000\n          }\n        },\n        "payments": {\n          "0": {\n            "offset": 500,\n            "metadata": "",\n            "timestamp": 1701432000000\n          }\n        }\n      }\n    },\n    "payment-handler": {\n      "topics": {\n        "payments": {\n          "0": {\n            "offset": 500,\n            "metadata": "",\n            "timestamp": 1701432000000\n          }\n        }\n      }\n    }\n  }\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,o.jsx)(n.h3,{id:"pre-migration-snapshot",children:"Pre-Migration Snapshot"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetRollback\nmetadata:\n  name: pre-migration-snapshot\nspec:\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n    securityProtocol: SASL_SSL\n    saslSecret:\n      name: kafka-credentials\n      mechanism: SCRAM-SHA-256\n\n  consumerGroups:\n    - order-processor\n    - payment-handler\n    - notification-service\n    - analytics-consumer\n\n  operation: snapshot\n  snapshotId: "pre-migration-20241201-1200"\n\n  storage:\n    storageType: s3\n    s3:\n      bucket: kafka-snapshots\n      region: us-west-2\n      prefix: offset-snapshots\n'})}),"\n",(0,o.jsx)(n.h3,{id:"emergency-rollback",children:"Emergency Rollback"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetRollback\nmetadata:\n  name: emergency-rollback\nspec:\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n    securityProtocol: SASL_SSL\n    saslSecret:\n      name: kafka-credentials\n      mechanism: SCRAM-SHA-256\n\n  consumerGroups:\n    - order-processor  # Only rollback affected group\n\n  operation: rollback\n  snapshotId: "pre-migration-20241201-1200"\n\n  storage:\n    storageType: s3\n    s3:\n      bucket: kafka-snapshots\n      region: us-west-2\n      prefix: offset-snapshots\n'})}),"\n",(0,o.jsx)(n.h3,{id:"verification-after-rollback",children:"Verification After Rollback"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetRollback\nmetadata:\n  name: verify-rollback\nspec:\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n\n  consumerGroups:\n    - order-processor\n\n  operation: verify\n  snapshotId: "pre-migration-20241201-1200"\n\n  storage:\n    storageType: s3\n    s3:\n      bucket: kafka-snapshots\n      region: us-west-2\n      prefix: offset-snapshots\n\n  verify:\n    strict: true  # Fail if any offset doesn\'t match\n'})}),"\n",(0,o.jsx)(n.h3,{id:"snapshot-to-configmap",children:"Snapshot to ConfigMap"}),"\n",(0,o.jsx)(n.p,{children:"For small consumer groups:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetRollback\nmetadata:\n  name: quick-snapshot\nspec:\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n\n  consumerGroups:\n    - my-small-group\n\n  operation: snapshot\n  snapshotId: "quick-snapshot-001"\n\n  storage:\n    storageType: configMap\n    configMap:\n      name: offset-snapshots\n'})}),"\n",(0,o.jsx)(n.h2,{id:"operations-1",children:"Operations"}),"\n",(0,o.jsx)(n.h3,{id:"list-snapshots",children:"List Snapshots"}),"\n",(0,o.jsx)(n.p,{children:"With S3 storage:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"aws s3 ls s3://kafka-snapshots/offset-snapshots/\n"})}),"\n",(0,o.jsx)(n.p,{children:"With ConfigMap:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"kubectl get configmap offset-snapshots -o yaml\n"})}),"\n",(0,o.jsx)(n.h3,{id:"check-snapshot-contents",children:"Check Snapshot Contents"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"# S3\naws s3 cp s3://kafka-snapshots/offset-snapshots/pre-migration-20241201.json - | jq\n\n# ConfigMap\nkubectl get configmap offset-snapshots -o jsonpath='{.data.pre-migration-20241201\\.json}' | jq\n"})}),"\n",(0,o.jsx)(n.h3,{id:"delete-old-snapshots",children:"Delete Old Snapshots"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetRollback\nmetadata:\n  name: cleanup-old-snapshot\nspec:\n  operation: delete\n  snapshotId: "old-snapshot-20241101"\n  storage:\n    storageType: configMap\n    configMap:\n      name: offset-snapshots\n'})}),"\n",(0,o.jsx)(n.h2,{id:"workflow-example",children:"Workflow Example"}),"\n",(0,o.jsx)(n.p,{children:"Complete workflow for safe offset management:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-yaml",children:'# 1. Create snapshot before change\n---\napiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetRollback\nmetadata:\n  name: step1-snapshot\nspec:\n  kafkaCluster:\n    bootstrapServers: ["kafka:9092"]\n  consumerGroups: ["my-group"]\n  operation: snapshot\n  snapshotId: "before-change"\n  storage:\n    storageType: configMap\n    configMap:\n      name: offset-snapshots\n\n# 2. After change, if needed, rollback\n---\napiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetRollback\nmetadata:\n  name: step2-rollback\nspec:\n  kafkaCluster:\n    bootstrapServers: ["kafka:9092"]\n  consumerGroups: ["my-group"]\n  operation: rollback\n  snapshotId: "before-change"\n  storage:\n    storageType: configMap\n    configMap:\n      name: offset-snapshots\n\n# 3. Verify rollback succeeded\n---\napiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetRollback\nmetadata:\n  name: step3-verify\nspec:\n  kafkaCluster:\n    bootstrapServers: ["kafka:9092"]\n  consumerGroups: ["my-group"]\n  operation: verify\n  snapshotId: "before-change"\n  storage:\n    storageType: configMap\n    configMap:\n      name: offset-snapshots\n'})}),"\n",(0,o.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"./kafkaoffsetreset",children:"KafkaOffsetReset"})," - Reset without snapshot"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"../../guides/offset-management",children:"Offset Management Guide"})," - Best practices"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.a,{href:"../../troubleshooting/offset-discontinuity",children:"Offset Discontinuity"})," - Troubleshooting"]}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(p,{...e})}):p(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>i});var a=s(6540);const o={},t=a.createContext(o);function r(e){const n=a.useContext(t);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),a.createElement(t.Provider,{value:n},e.children)}}}]);