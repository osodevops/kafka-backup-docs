"use strict";(globalThis.webpackChunkkafka_backup_docs=globalThis.webpackChunkkafka_backup_docs||[]).push([[6321],{3038:(e,r,s)=>{s.r(r),s.d(r,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"examples/kafka-streams","title":"Kafka Streams","description":"Backup and restore Kafka Streams applications","source":"@site/docs/examples/kafka-streams.md","sourceDirName":"examples","slug":"/examples/kafka-streams","permalink":"/examples/kafka-streams","draft":false,"unlisted":false,"editUrl":"https://github.com/osodevops/kafka-backup-docs/tree/main/docs/docs/examples/kafka-streams.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Kafka Streams","description":"Backup and restore Kafka Streams applications","sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Support","permalink":"/troubleshooting/support"},"next":{"title":"Spring Boot","permalink":"/examples/spring-boot"}}');var t=s(4848),a=s(8453);const o={title:"Kafka Streams",description:"Backup and restore Kafka Streams applications",sidebar_position:1},i="Kafka Streams Example",c={},l=[{value:"Kafka Streams Architecture",id:"kafka-streams-architecture",level:2},{value:"What to Backup",id:"what-to-backup",level:2},{value:"Backup Configuration",id:"backup-configuration",level:2},{value:"Full Backup (Recommended)",id:"full-backup-recommended",level:3},{value:"Minimal Backup",id:"minimal-backup",level:3},{value:"Restore Strategies",id:"restore-strategies",level:2},{value:"Strategy 1: Full Restore with State",id:"strategy-1-full-restore-with-state",level:3},{value:"Strategy 2: Rebuild State from Input",id:"strategy-2-rebuild-state-from-input",level:3},{value:"Strategy 3: PITR with State Consistency",id:"strategy-3-pitr-with-state-consistency",level:3},{value:"Consumer Offset Management",id:"consumer-offset-management",level:2},{value:"Kafka Streams Consumer Groups",id:"kafka-streams-consumer-groups",level:3},{value:"Reset for Reprocessing",id:"reset-for-reprocessing",level:3},{value:"Resume from Position",id:"resume-from-position",level:3},{value:"Example: Order Processing Application",id:"example-order-processing-application",level:2},{value:"Application Code",id:"application-code",level:3},{value:"Internal Topics Created",id:"internal-topics-created",level:3},{value:"Backup Script",id:"backup-script",level:3},{value:"Restore Script",id:"restore-script",level:3},{value:"State Store Considerations",id:"state-store-considerations",level:2},{value:"Local State Directory",id:"local-state-directory",level:3},{value:"State Restoration Options",id:"state-restoration-options",level:3},{value:"Standby Replicas",id:"standby-replicas",level:3},{value:"Testing the Restore",id:"testing-the-restore",level:2},{value:"Verify Input Topics",id:"verify-input-topics",level:3},{value:"Verify Changelog Topics",id:"verify-changelog-topics",level:3},{value:"Verify Application State",id:"verify-application-state",level:3},{value:"Kubernetes Deployment",id:"kubernetes-deployment",level:2},{value:"Backup CronJob",id:"backup-cronjob",level:3},{value:"Restore Job",id:"restore-job",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"kafka-streams-example",children:"Kafka Streams Example"})}),"\n",(0,t.jsx)(r.p,{children:"This guide shows how to backup and restore data for Kafka Streams applications, including state stores and changelog topics."}),"\n",(0,t.jsx)(r.h2,{id:"kafka-streams-architecture",children:"Kafka Streams Architecture"}),"\n",(0,t.jsx)(r.p,{children:"Kafka Streams applications create internal topics:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Kafka Streams Application                        \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                     \u2502\n\u2502  Input Topics          State Stores          Output Topics          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510        \u2502\n\u2502  \u2502   orders    \u2502 \u2500\u2500\u2500\u25b6 \u2502 order-store \u2502 \u2500\u2500\u2500\u25b6  \u2502  enriched-  \u2502        \u2502\n\u2502  \u2502             \u2502      \u2502 (RocksDB)   \u2502       \u2502   orders    \u2502        \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                              \u2502                                      \u2502\n\u2502                              \u25bc                                      \u2502\n\u2502                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u2502\n\u2502                    \u2502 app-id-order-store- \u2502 (Changelog topic)       \u2502\n\u2502                    \u2502 changelog           \u2502                         \u2502\n\u2502                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2502\n\u2502                                                                     \u2502\n\u2502                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                         \u2502\n\u2502                    \u2502 app-id-KSTREAM-     \u2502 (Repartition topic)     \u2502\n\u2502                    \u2502 REPARTITION-0000    \u2502                         \u2502\n\u2502                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                         \u2502\n\u2502                                                                     \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(r.h2,{id:"what-to-backup",children:"What to Backup"}),"\n",(0,t.jsx)(r.p,{children:"For complete Kafka Streams recovery:"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Topic Type"}),(0,t.jsx)(r.th,{children:"Backup"}),(0,t.jsx)(r.th,{children:"Why"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Input topics"}),(0,t.jsx)(r.td,{children:"Yes"}),(0,t.jsx)(r.td,{children:"Source data"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Output topics"}),(0,t.jsx)(r.td,{children:"Yes"}),(0,t.jsx)(r.td,{children:"Processed results"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Changelog topics"}),(0,t.jsx)(r.td,{children:"Yes"}),(0,t.jsx)(r.td,{children:"State store data"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Repartition topics"}),(0,t.jsx)(r.td,{children:"Optional"}),(0,t.jsx)(r.td,{children:"Can be recreated"})]})]})]}),"\n",(0,t.jsx)(r.h2,{id:"backup-configuration",children:"Backup Configuration"}),"\n",(0,t.jsx)(r.h3,{id:"full-backup-recommended",children:"Full Backup (Recommended)"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yaml",metastring:'title="streams-backup.yaml"',children:'mode: backup\nbackup_id: "streams-backup-${TIMESTAMP}"\n\nsource:\n  bootstrap_servers:\n    - kafka:9092\n  topics:\n    include:\n      # Input topics\n      - orders\n      - inventory\n      - customers\n\n      # Output topics\n      - enriched-orders\n      - order-totals\n      - alerts\n\n      # Internal topics (by application.id)\n      - "order-processor-*"  # Captures changelog and repartition\n\n    exclude:\n      # Skip repartition topics if desired (can be recreated)\n      - "*-repartition-*"\n\nstorage:\n  backend: s3\n  bucket: kafka-backups\n  prefix: streams/order-processor\n\nbackup:\n  compression: zstd\n  compression_level: 3\n  include_offset_headers: true\n  source_cluster_id: "production"\n'})}),"\n",(0,t.jsx)(r.h3,{id:"minimal-backup",children:"Minimal Backup"}),"\n",(0,t.jsx)(r.p,{children:"Backup only input and output topics:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yaml",children:'source:\n  topics:\n    include:\n      - orders\n      - inventory\n      - customers\n      - enriched-orders\n      - order-totals\n\n    # Skip internal topics (state will be rebuilt from input)\n    exclude:\n      - "order-processor-*"\n'})}),"\n",(0,t.jsx)(r.h2,{id:"restore-strategies",children:"Restore Strategies"}),"\n",(0,t.jsx)(r.h3,{id:"strategy-1-full-restore-with-state",children:"Strategy 1: Full Restore with State"}),"\n",(0,t.jsx)(r.p,{children:"Restore everything including state stores:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yaml",metastring:'title="streams-restore-full.yaml"',children:'mode: restore\nbackup_id: "streams-backup-20241201"\n\ntarget:\n  bootstrap_servers:\n    - target-kafka:9092\n\nstorage:\n  backend: s3\n  bucket: kafka-backups\n  prefix: streams/order-processor\n\nrestore:\n  # Restore all topics including changelog\n  topics:\n    - orders\n    - inventory\n    - customers\n    - enriched-orders\n    - order-totals\n    - "order-processor-*"\n\n  include_original_offset_header: true\n'})}),"\n",(0,t.jsx)(r.p,{children:"After restore:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Restart Streams application\n# It will load state from changelog topics\njava -jar order-processor.jar\n"})}),"\n",(0,t.jsx)(r.h3,{id:"strategy-2-rebuild-state-from-input",children:"Strategy 2: Rebuild State from Input"}),"\n",(0,t.jsx)(r.p,{children:"Restore only input topics, let Streams rebuild state:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yaml",metastring:'title="streams-restore-rebuild.yaml"',children:'mode: restore\nbackup_id: "streams-backup-20241201"\n\ntarget:\n  bootstrap_servers:\n    - target-kafka:9092\n\nrestore:\n  topics:\n    - orders\n    - inventory\n    - customers\n\n  # Reset to beginning to reprocess all data\n  consumer_group_strategy: earliest\n'})}),"\n",(0,t.jsx)(r.p,{children:"After restore:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Delete state store directory\nrm -rf /var/kafka-streams/order-processor\n\n# Reset application to reprocess\nkafka-streams-application-reset \\\n  --bootstrap-servers target-kafka:9092 \\\n  --application-id order-processor \\\n  --input-topics orders,inventory,customers\n\n# Restart application\njava -jar order-processor.jar\n"})}),"\n",(0,t.jsx)(r.h3,{id:"strategy-3-pitr-with-state-consistency",children:"Strategy 3: PITR with State Consistency"}),"\n",(0,t.jsx)(r.p,{children:"For point-in-time recovery, ensure state matches:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yaml",metastring:'title="streams-restore-pitr.yaml"',children:"mode: restore\nbackup_id: \"streams-backup-20241201\"\n\nrestore:\n  # Restore to specific point\n  time_window_end: 1701450000000\n\n  topics:\n    # Input topics up to PITR point\n    - orders\n    - inventory\n    - customers\n\n    # DON'T restore changelog - state won't match PITR point\n    # State will be rebuilt from input\n"})}),"\n",(0,t.jsx)(r.h2,{id:"consumer-offset-management",children:"Consumer Offset Management"}),"\n",(0,t.jsx)(r.h3,{id:"kafka-streams-consumer-groups",children:"Kafka Streams Consumer Groups"}),"\n",(0,t.jsxs)(r.p,{children:["Kafka Streams uses consumer groups named ",(0,t.jsx)(r.code,{children:"{application.id}"}),":"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# View Streams consumer group\nkafka-consumer-groups \\\n  --bootstrap-server kafka:9092 \\\n  --group order-processor \\\n  --describe\n"})}),"\n",(0,t.jsx)(r.h3,{id:"reset-for-reprocessing",children:"Reset for Reprocessing"}),"\n",(0,t.jsx)(r.p,{children:"Using Kafka Streams reset tool:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"kafka-streams-application-reset \\\n  --bootstrap-servers target-kafka:9092 \\\n  --application-id order-processor \\\n  --input-topics orders,inventory,customers \\\n  --to-earliest\n"})}),"\n",(0,t.jsx)(r.p,{children:"Using OSO Kafka Backup:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yaml",children:"offset_reset:\n  groups:\n    - order-processor\n  strategy: earliest\n"})}),"\n",(0,t.jsx)(r.h3,{id:"resume-from-position",children:"Resume from Position"}),"\n",(0,t.jsx)(r.p,{children:"If restoring with changelog:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yaml",children:'offset_reset:\n  groups:\n    - order-processor\n  strategy: header-based\n  source_cluster: "production"\n'})}),"\n",(0,t.jsx)(r.h2,{id:"example-order-processing-application",children:"Example: Order Processing Application"}),"\n",(0,t.jsx)(r.h3,{id:"application-code",children:"Application Code"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-java",children:'// Order processing Kafka Streams application\nProperties props = new Properties();\nprops.put(StreamsConfig.APPLICATION_ID_CONFIG, "order-processor");\nprops.put(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, "kafka:9092");\n\nStreamsBuilder builder = new StreamsBuilder();\n\n// State store for order aggregation\nbuilder.addStateStore(\n    Stores.keyValueStoreBuilder(\n        Stores.persistentKeyValueStore("order-totals"),\n        Serdes.String(),\n        Serdes.Double()\n    )\n);\n\n// Process orders\nbuilder.stream("orders", Consumed.with(Serdes.String(), orderSerde))\n    .groupByKey()\n    .aggregate(\n        () -> 0.0,\n        (key, order, total) -> total + order.getAmount(),\n        Materialized.as("order-totals")\n    )\n    .toStream()\n    .to("customer-totals");\n'})}),"\n",(0,t.jsx)(r.h3,{id:"internal-topics-created",children:"Internal Topics Created"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"order-processor-order-totals-changelog\norder-processor-order-totals-repartition\n"})}),"\n",(0,t.jsx)(r.h3,{id:"backup-script",children:"Backup Script"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'#!/bin/bash\n# backup-streams.sh\n\nAPP_ID="order-processor"\nTIMESTAMP=$(date +%Y%m%d-%H%M%S)\n\ncat > /tmp/streams-backup.yaml << EOF\nmode: backup\nbackup_id: "${APP_ID}-${TIMESTAMP}"\n\nsource:\n  bootstrap_servers:\n    - kafka:9092\n  topics:\n    include:\n      - orders\n      - customer-totals\n      - "${APP_ID}-*"\n\nstorage:\n  backend: s3\n  bucket: kafka-backups\n  prefix: streams/${APP_ID}\n\nbackup:\n  compression: zstd\n  include_offset_headers: true\n  source_cluster_id: "production"\nEOF\n\nkafka-backup backup --config /tmp/streams-backup.yaml\n'})}),"\n",(0,t.jsx)(r.h3,{id:"restore-script",children:"Restore Script"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'#!/bin/bash\n# restore-streams.sh\n\nAPP_ID="order-processor"\nBACKUP_ID="$1"\n\n# Step 1: Stop the Streams application\nkubectl scale deployment ${APP_ID} --replicas=0\n\n# Step 2: Restore data\ncat > /tmp/streams-restore.yaml << EOF\nmode: restore\nbackup_id: "${BACKUP_ID}"\n\ntarget:\n  bootstrap_servers:\n    - target-kafka:9092\n\nstorage:\n  backend: s3\n  bucket: kafka-backups\n  prefix: streams/${APP_ID}\n\nrestore:\n  topics:\n    - orders\n    - customer-totals\n    - "${APP_ID}-*"\n  include_original_offset_header: true\nEOF\n\nkafka-backup three-phase-restore --config /tmp/streams-restore.yaml\n\n# Step 3: Restart Streams application\nkubectl scale deployment ${APP_ID} --replicas=3\n'})}),"\n",(0,t.jsx)(r.h2,{id:"state-store-considerations",children:"State Store Considerations"}),"\n",(0,t.jsx)(r.h3,{id:"local-state-directory",children:"Local State Directory"}),"\n",(0,t.jsx)(r.p,{children:"Kafka Streams stores state locally:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"/var/kafka-streams/{application.id}/{task.id}/\n\u251c\u2500\u2500 rocksdb/\n\u2502   \u2514\u2500\u2500 order-totals/\n\u2502       \u251c\u2500\u2500 CURRENT\n\u2502       \u251c\u2500\u2500 MANIFEST-000001\n\u2502       \u251c\u2500\u2500 OPTIONS-000001\n\u2502       \u2514\u2500\u2500 000001.sst\n\u2514\u2500\u2500 .checkpoint\n"})}),"\n",(0,t.jsx)(r.h3,{id:"state-restoration-options",children:"State Restoration Options"}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Option"}),(0,t.jsx)(r.th,{children:"Method"}),(0,t.jsx)(r.th,{children:"Time"}),(0,t.jsx)(r.th,{children:"Consistency"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"From changelog"}),(0,t.jsx)(r.td,{children:"Restore changelog topics"}),(0,t.jsx)(r.td,{children:"Fast"}),(0,t.jsx)(r.td,{children:"Exact state"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Rebuild"}),(0,t.jsx)(r.td,{children:"Reprocess input topics"}),(0,t.jsx)(r.td,{children:"Slow"}),(0,t.jsx)(r.td,{children:"Eventually consistent"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:"Standby replicas"}),(0,t.jsx)(r.td,{children:"Use standby task"}),(0,t.jsx)(r.td,{children:"Instant"}),(0,t.jsx)(r.td,{children:"Exact state"})]})]})]}),"\n",(0,t.jsx)(r.h3,{id:"standby-replicas",children:"Standby Replicas"}),"\n",(0,t.jsx)(r.p,{children:"Configure standby replicas for faster recovery:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-java",children:"props.put(StreamsConfig.NUM_STANDBY_REPLICAS_CONFIG, 1);\n"})}),"\n",(0,t.jsx)(r.h2,{id:"testing-the-restore",children:"Testing the Restore"}),"\n",(0,t.jsx)(r.h3,{id:"verify-input-topics",children:"Verify Input Topics"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Check topic exists with data\nkafka-console-consumer \\\n  --bootstrap-server target-kafka:9092 \\\n  --topic orders \\\n  --from-beginning \\\n  --max-messages 10\n"})}),"\n",(0,t.jsx)(r.h3,{id:"verify-changelog-topics",children:"Verify Changelog Topics"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Check changelog has state\nkafka-console-consumer \\\n  --bootstrap-server target-kafka:9092 \\\n  --topic order-processor-order-totals-changelog \\\n  --from-beginning \\\n  --max-messages 10 \\\n  --property print.key=true\n"})}),"\n",(0,t.jsx)(r.h3,{id:"verify-application-state",children:"Verify Application State"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# Query state store via interactive query\ncurl http://streams-app:8080/state/order-totals/customer-123\n"})}),"\n",(0,t.jsx)(r.h2,{id:"kubernetes-deployment",children:"Kubernetes Deployment"}),"\n",(0,t.jsx)(r.h3,{id:"backup-cronjob",children:"Backup CronJob"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaBackup\nmetadata:\n  name: streams-backup\n  namespace: kafka-backup\nspec:\n  schedule: "0 * * * *"  # Hourly\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n  topics:\n    - orders\n    - customer-totals\n    - "order-processor-*"\n  storage:\n    storageType: s3\n    s3:\n      bucket: kafka-backups\n      region: us-west-2\n      prefix: streams/order-processor\n  compression: zstd\n'})}),"\n",(0,t.jsx)(r.h3,{id:"restore-job",children:"Restore Job"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaRestore\nmetadata:\n  name: streams-restore\n  namespace: kafka-backup\nspec:\n  backupId: "order-processor-20241201-100000"\n  targetCluster:\n    bootstrapServers:\n      - target-kafka:9092\n  storage:\n    storageType: s3\n    s3:\n      bucket: kafka-backups\n      region: us-west-2\n      prefix: streams/order-processor\n  offsetReset:\n    strategy: headerBased\n    consumerGroups:\n      - order-processor\n'})}),"\n",(0,t.jsx)(r.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Include changelog topics"})," for fast state recovery"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Use application.id prefix"})," to capture all internal topics"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Test state consistency"})," after restore"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Consider standby replicas"})," for production deployments"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Document internal topic naming"})," for your applications"]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"./spring-boot",children:"Spring Boot Example"})," - Spring Kafka integration"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"../guides/offset-management",children:"Offset Management"})," - Consumer offset handling"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.a,{href:"../use-cases/disaster-recovery",children:"Disaster Recovery"})," - DR planning"]}),"\n"]})]})}function p(e={}){const{wrapper:r}={...(0,a.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,r,s)=>{s.d(r,{R:()=>o,x:()=>i});var n=s(6540);const t={},a=n.createContext(t);function o(e){const r=n.useContext(a);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),n.createElement(a.Provider,{value:r},e.children)}}}]);