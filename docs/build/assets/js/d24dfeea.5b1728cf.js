"use strict";(globalThis.webpackChunkkafka_backup_docs=globalThis.webpackChunkkafka_backup_docs||[]).push([[3808],{1779:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>c,default:()=>p,frontMatter:()=>t,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"architecture/compression","title":"Compression","description":"How OSO Kafka Backup compresses data for efficient storage","source":"@site/docs/architecture/compression.md","sourceDirName":"architecture","slug":"/architecture/compression","permalink":"/architecture/compression","draft":false,"unlisted":false,"editUrl":"https://github.com/osodevops/kafka-backup-docs/tree/main/docs/docs/architecture/compression.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Compression","description":"How OSO Kafka Backup compresses data for efficient storage","sidebar_position":4},"sidebar":"docsSidebar","previous":{"title":"PITR Implementation","permalink":"/architecture/pitr-implementation"},"next":{"title":"Zero-Copy Optimization","permalink":"/architecture/zero-copy-optimization"}}');var r=n(4848),o=n(8453);const t={title:"Compression",description:"How OSO Kafka Backup compresses data for efficient storage",sidebar_position:4},c="Compression",l={},a=[{value:"Supported Algorithms",id:"supported-algorithms",level:2},{value:"Compression Comparison",id:"compression-comparison",level:2},{value:"Performance Characteristics",id:"performance-characteristics",level:3},{value:"Real-World Example",id:"real-world-example",level:3},{value:"Configuration",id:"configuration",level:2},{value:"Basic Configuration",id:"basic-configuration",level:3},{value:"Zstd Configuration",id:"zstd-configuration",level:3},{value:"LZ4 Configuration",id:"lz4-configuration",level:3},{value:"No Compression",id:"no-compression",level:3},{value:"How Compression Works",id:"how-compression-works",level:2},{value:"Backup Compression Pipeline",id:"backup-compression-pipeline",level:3},{value:"Restore Decompression Pipeline",id:"restore-decompression-pipeline",level:3},{value:"Streaming Compression",id:"streaming-compression",level:2},{value:"Streaming Configuration",id:"streaming-configuration",level:3},{value:"Compression Levels",id:"compression-levels",level:2},{value:"Zstd Levels Explained",id:"zstd-levels-explained",level:3},{value:"Choosing the Right Level",id:"choosing-the-right-level",level:3},{value:"Data Type Optimization",id:"data-type-optimization",level:2},{value:"Topic-Specific Compression",id:"topic-specific-compression",level:3},{value:"Compression and Kafka&#39;s Compression",id:"compression-and-kafkas-compression",level:2},{value:"Double Compression",id:"double-compression",level:3},{value:"Recommendation",id:"recommendation",level:3},{value:"Performance Tuning",id:"performance-tuning",level:2},{value:"CPU vs Storage Trade-off",id:"cpu-vs-storage-trade-off",level:3},{value:"Parallel Compression",id:"parallel-compression",level:3},{value:"Memory Configuration",id:"memory-configuration",level:3},{value:"Monitoring Compression",id:"monitoring-compression",level:2},{value:"Metrics",id:"metrics",level:3},{value:"Backup Statistics",id:"backup-statistics",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"General Recommendations",id:"general-recommendations",level:3},{value:"Storage Cost Optimization",id:"storage-cost-optimization",level:3},{value:"Network Optimization",id:"network-optimization",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Compression Too Slow",id:"compression-too-slow",level:3},{value:"Poor Compression Ratio",id:"poor-compression-ratio",level:3},{value:"High Memory Usage",id:"high-memory-usage",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"compression",children:"Compression"})}),"\n",(0,r.jsx)(s.p,{children:"OSO Kafka Backup supports multiple compression algorithms to reduce storage costs and improve transfer speeds."}),"\n",(0,r.jsx)(s.h2,{id:"supported-algorithms",children:"Supported Algorithms"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Algorithm"}),(0,r.jsx)(s.th,{children:"Description"}),(0,r.jsx)(s.th,{children:"Best For"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"Zstd"})}),(0,r.jsx)(s.td,{children:"Zstandard - high ratio, fast"}),(0,r.jsx)(s.td,{children:"General use (default)"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"LZ4"})}),(0,r.jsx)(s.td,{children:"Very fast, moderate ratio"}),(0,r.jsx)(s.td,{children:"Speed-critical workloads"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.strong,{children:"None"})}),(0,r.jsx)(s.td,{children:"No compression"}),(0,r.jsx)(s.td,{children:"Pre-compressed data"})]})]})]}),"\n",(0,r.jsx)(s.h2,{id:"compression-comparison",children:"Compression Comparison"}),"\n",(0,r.jsx)(s.h3,{id:"performance-characteristics",children:"Performance Characteristics"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Metric"}),(0,r.jsx)(s.th,{children:"Zstd (level 3)"}),(0,r.jsx)(s.th,{children:"Zstd (level 9)"}),(0,r.jsx)(s.th,{children:"LZ4"}),(0,r.jsx)(s.th,{children:"None"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Compression ratio"}),(0,r.jsx)(s.td,{children:"4-6x"}),(0,r.jsx)(s.td,{children:"6-10x"}),(0,r.jsx)(s.td,{children:"2-3x"}),(0,r.jsx)(s.td,{children:"1x"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Compression speed"}),(0,r.jsx)(s.td,{children:"~400 MB/s"}),(0,r.jsx)(s.td,{children:"~100 MB/s"}),(0,r.jsx)(s.td,{children:"~700 MB/s"}),(0,r.jsx)(s.td,{children:"N/A"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Decompression speed"}),(0,r.jsx)(s.td,{children:"~1000 MB/s"}),(0,r.jsx)(s.td,{children:"~900 MB/s"}),(0,r.jsx)(s.td,{children:"~2000 MB/s"}),(0,r.jsx)(s.td,{children:"N/A"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"CPU usage"}),(0,r.jsx)(s.td,{children:"Medium"}),(0,r.jsx)(s.td,{children:"High"}),(0,r.jsx)(s.td,{children:"Low"}),(0,r.jsx)(s.td,{children:"None"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Memory usage"}),(0,r.jsx)(s.td,{children:"Medium"}),(0,r.jsx)(s.td,{children:"High"}),(0,r.jsx)(s.td,{children:"Low"}),(0,r.jsx)(s.td,{children:"None"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"real-world-example",children:"Real-World Example"}),"\n",(0,r.jsx)(s.p,{children:"For 100 GB of JSON Kafka messages:"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Algorithm"}),(0,r.jsx)(s.th,{children:"Compressed Size"}),(0,r.jsx)(s.th,{children:"Backup Time"}),(0,r.jsx)(s.th,{children:"Restore Time"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Zstd-3"}),(0,r.jsx)(s.td,{children:"~20 GB"}),(0,r.jsx)(s.td,{children:"5 min"}),(0,r.jsx)(s.td,{children:"2 min"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Zstd-9"}),(0,r.jsx)(s.td,{children:"~12 GB"}),(0,r.jsx)(s.td,{children:"15 min"}),(0,r.jsx)(s.td,{children:"2 min"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"LZ4"}),(0,r.jsx)(s.td,{children:"~40 GB"}),(0,r.jsx)(s.td,{children:"3 min"}),(0,r.jsx)(s.td,{children:"1 min"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"None"}),(0,r.jsx)(s.td,{children:"100 GB"}),(0,r.jsx)(s.td,{children:"2 min"}),(0,r.jsx)(s.td,{children:"2 min"})]})]})]}),"\n",(0,r.jsx)(s.h2,{id:"configuration",children:"Configuration"}),"\n",(0,r.jsx)(s.h3,{id:"basic-configuration",children:"Basic Configuration"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"backup:\n  compression: zstd           # Algorithm: zstd, lz4, none\n  compression_level: 3        # Level: 1-22 for zstd, 1-12 for lz4\n"})}),"\n",(0,r.jsx)(s.h3,{id:"zstd-configuration",children:"Zstd Configuration"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"backup:\n  compression: zstd\n  compression_level: 3        # Default, good balance\n\n  # Level guidelines:\n  # 1-3:   Fast compression, good ratio\n  # 4-6:   Balanced (recommended)\n  # 7-12:  Slower, better ratio\n  # 13-22: Very slow, best ratio (archival)\n"})}),"\n",(0,r.jsx)(s.h3,{id:"lz4-configuration",children:"LZ4 Configuration"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"backup:\n  compression: lz4\n  compression_level: 1        # LZ4 levels have less impact\n"})}),"\n",(0,r.jsx)(s.h3,{id:"no-compression",children:"No Compression"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"backup:\n  compression: none\n  # Use when:\n  # - Data is already compressed (images, video)\n  # - Speed is critical and storage is cheap\n  # - Debugging/inspection needed\n"})}),"\n",(0,r.jsx)(s.h2,{id:"how-compression-works",children:"How Compression Works"}),"\n",(0,r.jsx)(s.h3,{id:"backup-compression-pipeline",children:"Backup Compression Pipeline"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"Kafka Records \u2192 Batch \u2192 Compress \u2192 Write to Storage\n     \u2193            \u2193         \u2193            \u2193\n  Raw data    Group      Apply      Segment\n  (1 MB)    records    algorithm     file\n            (10 MB)    (2 MB)      (.zst)\n"})}),"\n",(0,r.jsx)(s.p,{children:"Detailed flow:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                      Compression Pipeline                            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                      \u2502\n\u2502  1. Batch Records                                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502  Record 1 \u2502 Record 2 \u2502 Record 3 \u2502 ... \u2502 Record N            \u2502    \u2502\n\u2502  \u2502  (100 B)  \u2502 (200 B)  \u2502 (150 B)  \u2502     \u2502 (180 B)             \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                               \u2502                                      \u2502\n\u2502                               \u25bc                                      \u2502\n\u2502  2. Serialize Batch                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502  Header \u2502 Record 1 \u2502 Record 2 \u2502 ... \u2502 Record N \u2502 Checksum   \u2502    \u2502\n\u2502  \u2502  (32 B) \u2502          \u2502          \u2502     \u2502          \u2502 (4 B)      \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                               \u2502                                      \u2502\n\u2502                               \u25bc                                      \u2502\n\u2502  3. Compress                                                         \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502  Zstd Frame                                                  \u2502    \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502    \u2502\n\u2502  \u2502  \u2502 Magic \u2502 Frame Header \u2502 Compressed Blocks \u2502 Checksum   \u2502  \u2502    \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                               \u2502                                      \u2502\n\u2502                               \u25bc                                      \u2502\n\u2502  4. Write Segment                                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502  segment-0001.dat.zst                                        \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                                                                      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(s.h3,{id:"restore-decompression-pipeline",children:"Restore Decompression Pipeline"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"Storage \u2192 Read \u2192 Decompress \u2192 Parse \u2192 Write to Kafka\n   \u2193        \u2193        \u2193          \u2193          \u2193\nSegment   Stream  Apply       Extract   Produce\n file      read  algorithm   records    records\n(.zst)   (2 MB)  (10 MB)    (array)   (1 at a time)\n"})}),"\n",(0,r.jsx)(s.h2,{id:"streaming-compression",children:"Streaming Compression"}),"\n",(0,r.jsx)(s.p,{children:"OSO Kafka Backup uses streaming compression to minimize memory usage:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"Traditional (Buffer All):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Read all records \u2192 Buffer 10 GB \u2192 Compress \u2192 Write          \u2502\n\u2502  Memory usage: 10 GB+                                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n\nStreaming (OSO Kafka Backup):\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Read batch \u2192 Compress batch \u2192 Write batch \u2192 (repeat)        \u2502\n\u2502  Memory usage: ~100 MB (configurable)                        \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,r.jsx)(s.h3,{id:"streaming-configuration",children:"Streaming Configuration"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"backup:\n  compression: zstd\n  compression_level: 3\n\n  # Batch size controls memory vs efficiency\n  batch_size: 10000             # Records per batch\n  max_batch_bytes: 104857600    # 100 MB max batch\n"})}),"\n",(0,r.jsx)(s.h2,{id:"compression-levels",children:"Compression Levels"}),"\n",(0,r.jsx)(s.h3,{id:"zstd-levels-explained",children:"Zstd Levels Explained"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"Level 1-3:  Fast mode\n            \u251c\u2500\u2500 Speed: Very fast\n            \u251c\u2500\u2500 Ratio: 3-4x\n            \u2514\u2500\u2500 Use case: Real-time backup, bandwidth constrained\n\nLevel 4-6:  Default mode\n            \u251c\u2500\u2500 Speed: Fast\n            \u251c\u2500\u2500 Ratio: 4-6x\n            \u2514\u2500\u2500 Use case: Daily backups, general use\n\nLevel 7-12: High compression\n            \u251c\u2500\u2500 Speed: Moderate\n            \u251c\u2500\u2500 Ratio: 5-8x\n            \u2514\u2500\u2500 Use case: Weekly backups, archival\n\nLevel 13-22: Ultra compression\n            \u251c\u2500\u2500 Speed: Slow\n            \u251c\u2500\u2500 Ratio: 6-10x\n            \u2514\u2500\u2500 Use case: Long-term archival, cold storage\n"})}),"\n",(0,r.jsx)(s.h3,{id:"choosing-the-right-level",children:"Choosing the Right Level"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"# Speed priority (CI/CD, real-time)\nbackup:\n  compression: zstd\n  compression_level: 1\n\n# Balanced (daily backups)\nbackup:\n  compression: zstd\n  compression_level: 3\n\n# Storage priority (archival)\nbackup:\n  compression: zstd\n  compression_level: 9\n\n# Maximum compression (cold storage, rare access)\nbackup:\n  compression: zstd\n  compression_level: 19\n"})}),"\n",(0,r.jsx)(s.h2,{id:"data-type-optimization",children:"Data Type Optimization"}),"\n",(0,r.jsx)(s.p,{children:"Different data types compress differently:"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Data Type"}),(0,r.jsx)(s.th,{children:"Typical Ratio"}),(0,r.jsx)(s.th,{children:"Recommendation"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"JSON"}),(0,r.jsx)(s.td,{children:"6-10x"}),(0,r.jsx)(s.td,{children:"Zstd level 3-6"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Avro"}),(0,r.jsx)(s.td,{children:"4-6x"}),(0,r.jsx)(s.td,{children:"Zstd level 3"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Protobuf"}),(0,r.jsx)(s.td,{children:"3-5x"}),(0,r.jsx)(s.td,{children:"Zstd level 3"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Plain text"}),(0,r.jsx)(s.td,{children:"5-8x"}),(0,r.jsx)(s.td,{children:"Zstd level 3-6"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Binary (random)"}),(0,r.jsx)(s.td,{children:"1-1.5x"}),(0,r.jsx)(s.td,{children:"None or LZ4"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:"Pre-compressed"}),(0,r.jsx)(s.td,{children:"0.9-1.1x"}),(0,r.jsx)(s.td,{children:"None"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"topic-specific-compression",children:"Topic-Specific Compression"}),"\n",(0,r.jsx)(s.p,{children:"Different topics may benefit from different settings:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"# Global default\nbackup:\n  compression: zstd\n  compression_level: 3\n\n# Topic-specific overrides (if supported)\n# Note: Currently applies globally\n"})}),"\n",(0,r.jsx)(s.h2,{id:"compression-and-kafkas-compression",children:"Compression and Kafka's Compression"}),"\n",(0,r.jsx)(s.h3,{id:"double-compression",children:"Double Compression"}),"\n",(0,r.jsx)(s.p,{children:"Kafka itself supports compression (gzip, snappy, lz4, zstd). OSO Kafka Backup compresses at the batch level:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"Kafka Message (may be compressed)\n        \u2193\nOSO Backup reads (decompressed by Kafka client)\n        \u2193\nOSO Backup compresses batch\n        \u2193\nStorage\n\nResult: Backup compression works on decompressed data\n"})}),"\n",(0,r.jsx)(s.h3,{id:"recommendation",children:"Recommendation"}),"\n",(0,r.jsx)(s.p,{children:"If Kafka topics use compression:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"# Kafka topic has gzip compression\n# OSO Backup still compresses (on decompressed data)\nbackup:\n  compression: zstd\n  compression_level: 3\n\n# This is efficient because:\n# 1. Kafka client decompresses automatically\n# 2. Zstd often achieves better ratio than gzip\n# 3. Zstd decompression is faster for restore\n"})}),"\n",(0,r.jsx)(s.h2,{id:"performance-tuning",children:"Performance Tuning"}),"\n",(0,r.jsx)(s.h3,{id:"cpu-vs-storage-trade-off",children:"CPU vs Storage Trade-off"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"High CPU, Low Storage:\n  compression_level: 9-12\n  Result: Slower backup, smaller files, fast restore\n\nBalanced:\n  compression_level: 3-6\n  Result: Fast backup, good compression, fast restore\n\nLow CPU, Higher Storage:\n  compression_level: 1-2\n  Result: Very fast backup, larger files, fast restore\n"})}),"\n",(0,r.jsx)(s.h3,{id:"parallel-compression",children:"Parallel Compression"}),"\n",(0,r.jsx)(s.p,{children:"Zstd supports multi-threaded compression (used automatically):"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{children:"CPU Cores: 8\nPartitions: 16\n\nThread allocation:\n  - 8 parallel partition consumers\n  - Each with dedicated compression context\n  - Effective throughput: 8x single-thread\n"})}),"\n",(0,r.jsx)(s.h3,{id:"memory-configuration",children:"Memory Configuration"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"backup:\n  compression: zstd\n  compression_level: 3\n\n  # Higher level = more memory\n  # Level 3: ~100 MB per compression context\n  # Level 9: ~500 MB per compression context\n  # Level 19: ~1 GB per compression context\n"})}),"\n",(0,r.jsx)(s.h2,{id:"monitoring-compression",children:"Monitoring Compression"}),"\n",(0,r.jsx)(s.h3,{id:"metrics",children:"Metrics"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-promql",children:"# Compression ratio\nkafka_backup_compression_ratio\n\n# Compression throughput (MB/s)\nrate(kafka_backup_bytes_compressed_total[5m]) / 1048576\n\n# Time spent compressing\nkafka_backup_compression_duration_seconds\n"})}),"\n",(0,r.jsx)(s.h3,{id:"backup-statistics",children:"Backup Statistics"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"kafka-backup describe \\\n  --path s3://bucket/backups \\\n  --backup-id my-backup \\\n  --format json | jq '.compression'\n"})}),"\n",(0,r.jsx)(s.p,{children:"Output:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{\n  "algorithm": "zstd",\n  "level": 3,\n  "original_size_bytes": 10737418240,\n  "compressed_size_bytes": 2147483648,\n  "ratio": 5.0,\n  "compression_time_secs": 120\n}\n'})}),"\n",(0,r.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsx)(s.h3,{id:"general-recommendations",children:"General Recommendations"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Start with Zstd level 3"})," - good default for most cases"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Use LZ4 for speed-critical"})," - when backup window is tight"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Use higher levels for archival"})," - level 9+ for cold storage"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Disable for pre-compressed data"})," - images, video, encrypted"]}),"\n"]}),"\n",(0,r.jsx)(s.h3,{id:"storage-cost-optimization",children:"Storage Cost Optimization"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"# Tier 1: Hot backups (hourly, 7-day retention)\nbackup:\n  compression: zstd\n  compression_level: 3\n  # Fast backup, reasonable size\n\n# Tier 2: Warm backups (daily, 30-day retention)\nbackup:\n  compression: zstd\n  compression_level: 6\n  # Balanced for daily use\n\n# Tier 3: Cold backups (weekly, 1-year retention)\nbackup:\n  compression: zstd\n  compression_level: 12\n  # Maximum compression for long-term storage\n"})}),"\n",(0,r.jsx)(s.h3,{id:"network-optimization",children:"Network Optimization"}),"\n",(0,r.jsx)(s.p,{children:"For bandwidth-constrained environments:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"backup:\n  compression: zstd\n  compression_level: 9  # Higher compression = less transfer\n\n# Trade-off:\n# - Slower backup (more CPU time)\n# - Less network transfer\n# - Smaller storage\n"})}),"\n",(0,r.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(s.h3,{id:"compression-too-slow",children:"Compression Too Slow"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"# Reduce compression level\nbackup:\n  compression: zstd\n  compression_level: 1  # Fastest\n\n# Or switch to LZ4\nbackup:\n  compression: lz4\n"})}),"\n",(0,r.jsx)(s.h3,{id:"poor-compression-ratio",children:"Poor Compression Ratio"}),"\n",(0,r.jsx)(s.p,{children:"Check data type:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"# Sample topic data\nkafka-console-consumer \\\n  --bootstrap-server kafka:9092 \\\n  --topic my-topic \\\n  --max-messages 100 > sample.txt\n\n# Check compressibility\nzstd -3 sample.txt\nls -la sample.txt*\n"})}),"\n",(0,r.jsx)(s.h3,{id:"high-memory-usage",children:"High Memory Usage"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"# Reduce batch size\nbackup:\n  compression: zstd\n  compression_level: 3\n  batch_size: 1000          # Smaller batches\n  max_batch_bytes: 10485760  # 10 MB max\n"})}),"\n",(0,r.jsx)(s.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"./zero-copy-optimization",children:"Zero-Copy Optimization"})," - Additional performance techniques"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"../guides/performance-tuning",children:"Performance Tuning Guide"})," - Optimization strategies"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"../reference/storage-format",children:"Storage Format"})," - How compressed data is stored"]}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>t,x:()=>c});var i=n(6540);const r={},o=i.createContext(r);function t(e){const s=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),i.createElement(o.Provider,{value:s},e.children)}}}]);