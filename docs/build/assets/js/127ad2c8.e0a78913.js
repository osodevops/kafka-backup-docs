"use strict";(globalThis.webpackChunkkafka_backup_docs=globalThis.webpackChunkkafka_backup_docs||[]).push([[5113],{948:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"deployment/cloud-setup/aws-s3","title":"AWS S3 Setup","description":"Configure AWS S3 as storage backend for OSO Kafka Backup","source":"@site/docs/deployment/cloud-setup/aws-s3.md","sourceDirName":"deployment/cloud-setup","slug":"/deployment/cloud-setup/aws-s3","permalink":"/deployment/cloud-setup/aws-s3","draft":false,"unlisted":false,"editUrl":"https://github.com/osodevops/kafka-backup-docs/tree/main/docs/docs/deployment/cloud-setup/aws-s3.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"AWS S3 Setup","description":"Configure AWS S3 as storage backend for OSO Kafka Backup","sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Kubernetes Deployment","permalink":"/deployment/kubernetes"},"next":{"title":"Azure Blob Storage Setup","permalink":"/deployment/cloud-setup/azure-blob"}}');var a=s(4848),c=s(8453);const t={title:"AWS S3 Setup",description:"Configure AWS S3 as storage backend for OSO Kafka Backup",sidebar_position:1},r="AWS S3 Setup",l={},o=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Create S3 Bucket",id:"create-s3-bucket",level:2},{value:"Using AWS CLI",id:"using-aws-cli",level:3},{value:"Using Terraform",id:"using-terraform",level:3},{value:"IAM Policy",id:"iam-policy",level:2},{value:"Minimum Required Permissions",id:"minimum-required-permissions",level:3},{value:"Create IAM User",id:"create-iam-user",level:3},{value:"IAM Role (for EC2/EKS)",id:"iam-role-for-ec2eks",level:3},{value:"IRSA for EKS",id:"irsa-for-eks",level:2},{value:"Configuration",id:"configuration",level:2},{value:"With Access Keys",id:"with-access-keys",level:3},{value:"With IAM Role (EC2/EKS)",id:"with-iam-role-ec2eks",level:3},{value:"With Custom Endpoint (MinIO/Ceph)",id:"with-custom-endpoint-minioceph",level:3},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Storage Classes",id:"storage-classes",level:2},{value:"Lifecycle Policy",id:"lifecycle-policy",level:3},{value:"Cross-Region Replication",id:"cross-region-replication",level:2},{value:"Testing",id:"testing",level:2},{value:"Verify Credentials",id:"verify-credentials",level:3},{value:"Test from Application",id:"test-from-application",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Access Denied",id:"access-denied",level:3},{value:"Slow Uploads",id:"slow-uploads",level:3},{value:"Cost Optimization",id:"cost-optimization",level:3},{value:"Security Best Practices",id:"security-best-practices",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"aws-s3-setup",children:"AWS S3 Setup"})}),"\n",(0,a.jsx)(n.p,{children:"Configure Amazon S3 or S3-compatible storage for Kafka backups."}),"\n",(0,a.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"AWS account with S3 access"}),"\n",(0,a.jsx)(n.li,{children:"AWS CLI configured (optional, for testing)"}),"\n",(0,a.jsx)(n.li,{children:"IAM permissions to create buckets and policies"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"create-s3-bucket",children:"Create S3 Bucket"}),"\n",(0,a.jsx)(n.h3,{id:"using-aws-cli",children:"Using AWS CLI"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Create bucket\naws s3 mb s3://my-kafka-backups --region us-west-2\n\n# Enable versioning (recommended)\naws s3api put-bucket-versioning \\\n  --bucket my-kafka-backups \\\n  --versioning-configuration Status=Enabled\n\n# Enable server-side encryption\naws s3api put-bucket-encryption \\\n  --bucket my-kafka-backups \\\n  --server-side-encryption-configuration \'{\n    "Rules": [\n      {\n        "ApplyServerSideEncryptionByDefault": {\n          "SSEAlgorithm": "AES256"\n        }\n      }\n    ]\n  }\'\n'})}),"\n",(0,a.jsx)(n.h3,{id:"using-terraform",children:"Using Terraform"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-hcl",metastring:'title="s3.tf"',children:'resource "aws_s3_bucket" "kafka_backups" {\n  bucket = "my-kafka-backups"\n}\n\nresource "aws_s3_bucket_versioning" "kafka_backups" {\n  bucket = aws_s3_bucket.kafka_backups.id\n  versioning_configuration {\n    status = "Enabled"\n  }\n}\n\nresource "aws_s3_bucket_server_side_encryption_configuration" "kafka_backups" {\n  bucket = aws_s3_bucket.kafka_backups.id\n\n  rule {\n    apply_server_side_encryption_by_default {\n      sse_algorithm = "AES256"\n    }\n  }\n}\n\nresource "aws_s3_bucket_lifecycle_configuration" "kafka_backups" {\n  bucket = aws_s3_bucket.kafka_backups.id\n\n  rule {\n    id     = "transition-to-ia"\n    status = "Enabled"\n\n    transition {\n      days          = 30\n      storage_class = "STANDARD_IA"\n    }\n\n    transition {\n      days          = 90\n      storage_class = "GLACIER"\n    }\n\n    expiration {\n      days = 365\n    }\n  }\n}\n'})}),"\n",(0,a.jsx)(n.h2,{id:"iam-policy",children:"IAM Policy"}),"\n",(0,a.jsx)(n.h3,{id:"minimum-required-permissions",children:"Minimum Required Permissions"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",metastring:'title="kafka-backup-policy.json"',children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Sid": "ListBucket",\n      "Effect": "Allow",\n      "Action": [\n        "s3:ListBucket",\n        "s3:GetBucketLocation"\n      ],\n      "Resource": "arn:aws:s3:::my-kafka-backups"\n    },\n    {\n      "Sid": "ObjectOperations",\n      "Effect": "Allow",\n      "Action": [\n        "s3:GetObject",\n        "s3:PutObject",\n        "s3:DeleteObject"\n      ],\n      "Resource": "arn:aws:s3:::my-kafka-backups/*"\n    }\n  ]\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"create-iam-user",children:"Create IAM User"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Create user\naws iam create-user --user-name kafka-backup\n\n# Attach policy\naws iam put-user-policy \\\n  --user-name kafka-backup \\\n  --policy-name kafka-backup-s3 \\\n  --policy-document file://kafka-backup-policy.json\n\n# Create access keys\naws iam create-access-key --user-name kafka-backup\n"})}),"\n",(0,a.jsx)(n.h3,{id:"iam-role-for-ec2eks",children:"IAM Role (for EC2/EKS)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-json",metastring:'title="trust-policy.json"',children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Principal": {\n        "Service": "ec2.amazonaws.com"\n      },\n      "Action": "sts:AssumeRole"\n    }\n  ]\n}\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Create role\naws iam create-role \\\n  --role-name kafka-backup-role \\\n  --assume-role-policy-document file://trust-policy.json\n\n# Attach policy\naws iam put-role-policy \\\n  --role-name kafka-backup-role \\\n  --policy-name kafka-backup-s3 \\\n  --policy-document file://kafka-backup-policy.json\n"})}),"\n",(0,a.jsx)(n.h2,{id:"irsa-for-eks",children:"IRSA for EKS"}),"\n",(0,a.jsx)(n.p,{children:"For Kubernetes on EKS, use IAM Roles for Service Accounts:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Create OIDC provider (if not exists)\neksctl utils associate-iam-oidc-provider \\\n  --cluster my-cluster \\\n  --approve\n\n# Create service account with IAM role\neksctl create iamserviceaccount \\\n  --name kafka-backup \\\n  --namespace kafka-backup \\\n  --cluster my-cluster \\\n  --attach-policy-arn arn:aws:iam::123456789:policy/kafka-backup-s3 \\\n  --approve\n"})}),"\n",(0,a.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,a.jsx)(n.h3,{id:"with-access-keys",children:"With Access Keys"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="backup.yaml"',children:"storage:\n  backend: s3\n  bucket: my-kafka-backups\n  region: us-west-2\n  prefix: production/daily\n  access_key: ${AWS_ACCESS_KEY_ID}\n  secret_key: ${AWS_SECRET_ACCESS_KEY}\n"})}),"\n",(0,a.jsx)(n.h3,{id:"with-iam-role-ec2eks",children:"With IAM Role (EC2/EKS)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="backup.yaml"',children:"storage:\n  backend: s3\n  bucket: my-kafka-backups\n  region: us-west-2\n  prefix: production/daily\n  # No credentials needed - uses instance profile or IRSA\n"})}),"\n",(0,a.jsx)(n.h3,{id:"with-custom-endpoint-minioceph",children:"With Custom Endpoint (MinIO/Ceph)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="backup.yaml"',children:"storage:\n  backend: s3\n  bucket: kafka-backups\n  region: us-east-1\n  endpoint: https://minio.example.com:9000\n  access_key: ${MINIO_ACCESS_KEY}\n  secret_key: ${MINIO_SECRET_KEY}\n"})}),"\n",(0,a.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Variable"}),(0,a.jsx)(n.th,{children:"Description"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"AWS_ACCESS_KEY_ID"})}),(0,a.jsx)(n.td,{children:"AWS access key"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"AWS_SECRET_ACCESS_KEY"})}),(0,a.jsx)(n.td,{children:"AWS secret key"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"AWS_REGION"})}),(0,a.jsx)(n.td,{children:"AWS region"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"AWS_DEFAULT_REGION"})}),(0,a.jsx)(n.td,{children:"Alternative region variable"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"AWS_PROFILE"})}),(0,a.jsx)(n.td,{children:"AWS CLI profile name"})]})]})]}),"\n",(0,a.jsx)(n.h2,{id:"storage-classes",children:"Storage Classes"}),"\n",(0,a.jsx)(n.p,{children:"Optimize costs with lifecycle policies:"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"Storage Class"}),(0,a.jsx)(n.th,{children:"Use Case"}),(0,a.jsx)(n.th,{children:"Cost"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"STANDARD"})}),(0,a.jsx)(n.td,{children:"Recent backups (< 30 days)"}),(0,a.jsx)(n.td,{children:"$$$"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"STANDARD_IA"})}),(0,a.jsx)(n.td,{children:"Infrequent access (30-90 days)"}),(0,a.jsx)(n.td,{children:"$$"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"GLACIER_IR"})}),(0,a.jsx)(n.td,{children:"Archive with fast retrieval"}),(0,a.jsx)(n.td,{children:"$"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"GLACIER"})}),(0,a.jsx)(n.td,{children:"Long-term archive"}),(0,a.jsx)(n.td,{children:"$"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:(0,a.jsx)(n.code,{children:"DEEP_ARCHIVE"})}),(0,a.jsx)(n.td,{children:"Compliance archives"}),(0,a.jsx)(n.td,{children:"$"})]})]})]}),"\n",(0,a.jsx)(n.h3,{id:"lifecycle-policy",children:"Lifecycle Policy"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'aws s3api put-bucket-lifecycle-configuration \\\n  --bucket my-kafka-backups \\\n  --lifecycle-configuration \'{\n    "Rules": [\n      {\n        "ID": "archive-old-backups",\n        "Status": "Enabled",\n        "Filter": {\n          "Prefix": "production/"\n        },\n        "Transitions": [\n          {\n            "Days": 30,\n            "StorageClass": "STANDARD_IA"\n          },\n          {\n            "Days": 90,\n            "StorageClass": "GLACIER"\n          }\n        ],\n        "Expiration": {\n          "Days": 365\n        }\n      }\n    ]\n  }\'\n'})}),"\n",(0,a.jsx)(n.h2,{id:"cross-region-replication",children:"Cross-Region Replication"}),"\n",(0,a.jsx)(n.p,{children:"For disaster recovery:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Enable versioning on destination bucket\naws s3api put-bucket-versioning \\\n  --bucket my-kafka-backups-dr \\\n  --versioning-configuration Status=Enabled\n\n# Create replication configuration\naws s3api put-bucket-replication \\\n  --bucket my-kafka-backups \\\n  --replication-configuration \'{\n    "Role": "arn:aws:iam::123456789:role/s3-replication-role",\n    "Rules": [\n      {\n        "Status": "Enabled",\n        "Priority": 1,\n        "DeleteMarkerReplication": { "Status": "Enabled" },\n        "Filter": {},\n        "Destination": {\n          "Bucket": "arn:aws:s3:::my-kafka-backups-dr"\n        }\n      }\n    ]\n  }\'\n'})}),"\n",(0,a.jsx)(n.h2,{id:"testing",children:"Testing"}),"\n",(0,a.jsx)(n.h3,{id:"verify-credentials",children:"Verify Credentials"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Test AWS credentials\naws sts get-caller-identity\n\n# Test bucket access\naws s3 ls s3://my-kafka-backups/\n\n# Test write access\necho "test" | aws s3 cp - s3://my-kafka-backups/test.txt\naws s3 rm s3://my-kafka-backups/test.txt\n'})}),"\n",(0,a.jsx)(n.h3,{id:"test-from-application",children:"Test from Application"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Run a test backup\nkafka-backup backup --config backup.yaml\n\n# List backups\nkafka-backup list --path s3://my-kafka-backups/production/daily\n"})}),"\n",(0,a.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,a.jsx)(n.h3,{id:"access-denied",children:"Access Denied"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Check bucket policy\naws s3api get-bucket-policy --bucket my-kafka-backups\n\n# Check IAM permissions\naws iam simulate-principal-policy \\\n  --policy-source-arn arn:aws:iam::123456789:user/kafka-backup \\\n  --action-names s3:PutObject s3:GetObject \\\n  --resource-arns arn:aws:s3:::my-kafka-backups/*\n"})}),"\n",(0,a.jsx)(n.h3,{id:"slow-uploads",children:"Slow Uploads"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Use multipart uploads for large segments"}),"\n",(0,a.jsx)(n.li,{children:"Check network bandwidth"}),"\n",(0,a.jsx)(n.li,{children:"Consider using S3 Transfer Acceleration"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"cost-optimization",children:"Cost Optimization"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Enable Intelligent-Tiering for automatic class transitions"}),"\n",(0,a.jsx)(n.li,{children:"Use lifecycle policies aggressively"}),"\n",(0,a.jsx)(n.li,{children:"Monitor with S3 Storage Lens"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"security-best-practices",children:"Security Best Practices"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Enable versioning"})," - Protect against accidental deletes"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Enable encryption"})," - Use SSE-S3 or SSE-KMS"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Use IAM roles"})," - Avoid static credentials"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Enable access logging"})," - Audit bucket access"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Block public access"})," - Ensure bucket is private"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Enable MFA delete"})," - For critical backups"]}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'# Block all public access\naws s3api put-public-access-block \\\n  --bucket my-kafka-backups \\\n  --public-access-block-configuration \\\n  "BlockPublicAcls=true,IgnorePublicAcls=true,BlockPublicPolicy=true,RestrictPublicBuckets=true"\n'})}),"\n",(0,a.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"../../guides/backup-to-s3",children:"Backup to S3 Guide"})," - Step-by-step backup tutorial"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"../../reference/config-yaml",children:"Configuration Reference"})," - All storage options"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"../../guides/performance-tuning",children:"Performance Tuning"})," - Optimize throughput"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>r});var i=s(6540);const a={},c=i.createContext(a);function t(e){const n=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),i.createElement(c.Provider,{value:n},e.children)}}}]);