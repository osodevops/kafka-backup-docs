"use strict";(globalThis.webpackChunkkafka_backup_docs=globalThis.webpackChunkkafka_backup_docs||[]).push([[5624],{7831:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>l,default:()=>u,frontMatter:()=>i,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"operator/guides/scheduled-backups","title":"Scheduled Backups","description":"Configure automated backup schedules with the Kubernetes Operator","source":"@site/docs/operator/guides/scheduled-backups.md","sourceDirName":"operator/guides","slug":"/operator/guides/scheduled-backups","permalink":"/operator/guides/scheduled-backups","draft":false,"unlisted":false,"editUrl":"https://github.com/osodevops/kafka-backup-docs/tree/main/docs/docs/operator/guides/scheduled-backups.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Scheduled Backups","description":"Configure automated backup schedules with the Kubernetes Operator","sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"KafkaOffsetRollback","permalink":"/operator/crds/kafkaoffsetrollback"},"next":{"title":"GitOps","permalink":"/operator/guides/gitops"}}');var r=s(4848),c=s(8453);const i={title:"Scheduled Backups",description:"Configure automated backup schedules with the Kubernetes Operator",sidebar_position:1},l="Scheduled Backups",t={},o=[{value:"Cron Schedule Format",id:"cron-schedule-format",level:2},{value:"Common Schedules",id:"common-schedules",level:2},{value:"Examples",id:"examples",level:2},{value:"Hourly Backup",id:"hourly-backup",level:3},{value:"Daily Backup (Off-Peak Hours)",id:"daily-backup-off-peak-hours",level:3},{value:"Weekly Archival Backup",id:"weekly-archival-backup",level:3},{value:"Multi-Tier Backup Strategy",id:"multi-tier-backup-strategy",level:2},{value:"One-Time Backup",id:"one-time-backup",level:2},{value:"Trigger Manual Backup on Schedule",id:"trigger-manual-backup-on-schedule",level:2},{value:"Backup Window Management",id:"backup-window-management",level:2},{value:"Avoid Peak Hours",id:"avoid-peak-hours",level:3},{value:"Weekend-Only Archival",id:"weekend-only-archival",level:3},{value:"Business Hours Exclusion",id:"business-hours-exclusion",level:3},{value:"Timezone Considerations",id:"timezone-considerations",level:2},{value:"Retention Configuration",id:"retention-configuration",level:2},{value:"By Count",id:"by-count",level:3},{value:"S3 Lifecycle (Supplementary)",id:"s3-lifecycle-supplementary",level:3},{value:"Monitoring Schedules",id:"monitoring-schedules",level:2},{value:"Check Next Run Time",id:"check-next-run-time",level:3},{value:"View Schedule History",id:"view-schedule-history",level:3},{value:"Alert on Missed Backups",id:"alert-on-missed-backups",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"scheduled-backups",children:"Scheduled Backups"})}),"\n",(0,r.jsx)(n.p,{children:"Configure automated backup schedules using the KafkaBackup CRD's scheduling capabilities."}),"\n",(0,r.jsx)(n.h2,{id:"cron-schedule-format",children:"Cron Schedule Format"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"schedule"})," field uses standard cron format:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 minute (0 - 59)\n\u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 hour (0 - 23)\n\u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 day of month (1 - 31)\n\u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 month (1 - 12)\n\u2502 \u2502 \u2502 \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 day of week (0 - 6) (Sunday to Saturday)\n\u2502 \u2502 \u2502 \u2502 \u2502\n\u2502 \u2502 \u2502 \u2502 \u2502\n* * * * *\n"})}),"\n",(0,r.jsx)(n.h2,{id:"common-schedules",children:"Common Schedules"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Schedule"}),(0,r.jsx)(n.th,{children:"Cron Expression"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Every hour"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"0 * * * *"})}),(0,r.jsx)(n.td,{children:"At minute 0 of every hour"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Every 15 minutes"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"*/15 * * * *"})}),(0,r.jsx)(n.td,{children:"Every 15 minutes"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Every 6 hours"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"0 */6 * * *"})}),(0,r.jsx)(n.td,{children:"At minute 0 past every 6th hour"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Daily at midnight"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"0 0 * * *"})}),(0,r.jsx)(n.td,{children:"Every day at 00:00"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Daily at 2 AM"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"0 2 * * *"})}),(0,r.jsx)(n.td,{children:"Every day at 02:00"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Weekly (Sunday)"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"0 0 * * 0"})}),(0,r.jsx)(n.td,{children:"Every Sunday at 00:00"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Monthly"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"0 0 1 * *"})}),(0,r.jsx)(n.td,{children:"First day of month at 00:00"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,r.jsx)(n.h3,{id:"hourly-backup",children:"Hourly Backup"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaBackup\nmetadata:\n  name: hourly-backup\n  namespace: kafka-backup\nspec:\n  schedule: "0 * * * *"  # Every hour at minute 0\n\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n\n  topics:\n    - orders\n    - payments\n\n  storage:\n    storageType: s3\n    s3:\n      bucket: kafka-backups\n      region: us-west-2\n      prefix: hourly\n\n  compression: zstd\n  compressionLevel: 3\n\n  retention:\n    backups: 168  # Keep 7 days of hourly backups\n'})}),"\n",(0,r.jsx)(n.h3,{id:"daily-backup-off-peak-hours",children:"Daily Backup (Off-Peak Hours)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaBackup\nmetadata:\n  name: daily-backup\n  namespace: kafka-backup\nspec:\n  schedule: "0 2 * * *"  # Daily at 2 AM\n\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n    securityProtocol: SASL_SSL\n    saslSecret:\n      name: kafka-credentials\n      mechanism: SCRAM-SHA-256\n\n  topics:\n    - "*"  # All topics\n  excludeTopics:\n    - "__*"\n    - "_*"\n\n  storage:\n    storageType: s3\n    s3:\n      bucket: kafka-backups\n      region: us-west-2\n      prefix: daily\n\n  compression: zstd\n  compressionLevel: 6  # Higher compression for archival\n\n  retention:\n    backups: 90  # Keep 90 days of daily backups\n'})}),"\n",(0,r.jsx)(n.h3,{id:"weekly-archival-backup",children:"Weekly Archival Backup"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaBackup\nmetadata:\n  name: weekly-archive\n  namespace: kafka-backup\nspec:\n  schedule: "0 3 * * 0"  # Weekly on Sunday at 3 AM\n\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n\n  topics:\n    - "*"\n\n  storage:\n    storageType: s3\n    s3:\n      bucket: kafka-archives\n      region: us-west-2\n      prefix: weekly\n\n  compression: zstd\n  compressionLevel: 9  # Maximum compression\n\n  retention:\n    backups: 52  # Keep 1 year of weekly backups\n'})}),"\n",(0,r.jsx)(n.h2,{id:"multi-tier-backup-strategy",children:"Multi-Tier Backup Strategy"}),"\n",(0,r.jsx)(n.p,{children:"Implement comprehensive backup coverage:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# Tier 1: Frequent backups for low RPO\n---\napiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaBackup\nmetadata:\n  name: tier1-frequent\nspec:\n  schedule: "*/15 * * * *"  # Every 15 minutes\n\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n\n  topics:\n    - orders  # Critical topics only\n    - payments\n\n  storage:\n    storageType: s3\n    s3:\n      bucket: kafka-backups\n      prefix: tier1-frequent\n\n  compression: lz4  # Fast compression\n  retention:\n    backups: 96  # 24 hours of 15-minute backups\n\n---\n# Tier 2: Hourly backups for all topics\napiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaBackup\nmetadata:\n  name: tier2-hourly\nspec:\n  schedule: "0 * * * *"  # Hourly\n\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n\n  topics:\n    - "*"\n  excludeTopics:\n    - "__*"\n\n  storage:\n    storageType: s3\n    s3:\n      bucket: kafka-backups\n      prefix: tier2-hourly\n\n  compression: zstd\n  compressionLevel: 3\n  retention:\n    backups: 168  # 7 days\n\n---\n# Tier 3: Daily archival\napiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaBackup\nmetadata:\n  name: tier3-daily\nspec:\n  schedule: "0 2 * * *"  # Daily at 2 AM\n\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n\n  topics:\n    - "*"\n\n  storage:\n    storageType: s3\n    s3:\n      bucket: kafka-archives\n      prefix: tier3-daily\n\n  compression: zstd\n  compressionLevel: 9\n  retention:\n    backups: 365  # 1 year\n'})}),"\n",(0,r.jsx)(n.h2,{id:"one-time-backup",children:"One-Time Backup"}),"\n",(0,r.jsx)(n.p,{children:"For manual/on-demand backups, omit the schedule:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaBackup\nmetadata:\n  name: manual-backup-20241201\nspec:\n  # No schedule - runs once immediately\n\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n\n  topics:\n    - orders\n    - payments\n\n  storage:\n    storageType: s3\n    s3:\n      bucket: kafka-backups\n      prefix: manual\n"})}),"\n",(0,r.jsx)(n.h2,{id:"trigger-manual-backup-on-schedule",children:"Trigger Manual Backup on Schedule"}),"\n",(0,r.jsx)(n.p,{children:"Force immediate execution of a scheduled backup:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Add annotation to trigger backup\nkubectl annotate kafkabackup hourly-backup \\\n  kafka.oso.sh/trigger-backup=$(date +%s) \\\n  --overwrite\n"})}),"\n",(0,r.jsx)(n.h2,{id:"backup-window-management",children:"Backup Window Management"}),"\n",(0,r.jsx)(n.h3,{id:"avoid-peak-hours",children:"Avoid Peak Hours"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'spec:\n  schedule: "0 2-5 * * *"  # Between 2 AM and 5 AM only\n'})}),"\n",(0,r.jsx)(n.h3,{id:"weekend-only-archival",children:"Weekend-Only Archival"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'spec:\n  schedule: "0 3 * * 0,6"  # Saturday and Sunday at 3 AM\n'})}),"\n",(0,r.jsx)(n.h3,{id:"business-hours-exclusion",children:"Business Hours Exclusion"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# Backup every hour except 9 AM to 5 PM\nspec:\n  schedule: "0 0-8,18-23 * * *"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"timezone-considerations",children:"Timezone Considerations"}),"\n",(0,r.jsx)(n.p,{children:"Kubernetes CronJobs use UTC by default. Adjust your schedule accordingly:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# For 2 AM EST (UTC-5), schedule at 7 AM UTC\nspec:\n  schedule: "0 7 * * *"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["Or use the ",(0,r.jsx)(n.code,{children:"CRON_TZ"})," prefix (if supported):"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'spec:\n  schedule: "CRON_TZ=America/New_York 0 2 * * *"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"retention-configuration",children:"Retention Configuration"}),"\n",(0,r.jsx)(n.h3,{id:"by-count",children:"By Count"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"retention:\n  backups: 168  # Keep last 168 backups\n"})}),"\n",(0,r.jsx)(n.h3,{id:"s3-lifecycle-supplementary",children:"S3 Lifecycle (Supplementary)"}),"\n",(0,r.jsx)(n.p,{children:"Configure S3 lifecycle for additional storage tiering:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-json",children:'{\n  "Rules": [\n    {\n      "ID": "BackupLifecycle",\n      "Status": "Enabled",\n      "Filter": {"Prefix": "hourly/"},\n      "Transitions": [\n        {"Days": 30, "StorageClass": "STANDARD_IA"},\n        {"Days": 90, "StorageClass": "GLACIER"}\n      ],\n      "Expiration": {"Days": 365}\n    }\n  ]\n}\n'})}),"\n",(0,r.jsx)(n.h2,{id:"monitoring-schedules",children:"Monitoring Schedules"}),"\n",(0,r.jsx)(n.h3,{id:"check-next-run-time",children:"Check Next Run Time"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get kafkabackup hourly-backup \\\n  -o jsonpath='{.status.nextScheduledTime}'\n"})}),"\n",(0,r.jsx)(n.h3,{id:"view-schedule-history",children:"View Schedule History"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get kafkabackup hourly-backup \\\n  -o jsonpath='{.status.backupHistory}' | jq\n"})}),"\n",(0,r.jsx)(n.h3,{id:"alert-on-missed-backups",children:"Alert on Missed Backups"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'# PrometheusRule\napiVersion: monitoring.coreos.com/v1\nkind: PrometheusRule\nmetadata:\n  name: backup-schedule-alerts\nspec:\n  groups:\n    - name: kafka-backup-schedule\n      rules:\n        - alert: BackupScheduleMissed\n          expr: |\n            (time() - kafka_backup_last_successful_backup_timestamp) >\n            (kafka_backup_schedule_interval_seconds * 2)\n          for: 5m\n          labels:\n            severity: warning\n          annotations:\n            summary: "Backup schedule missed"\n            description: "{{ $labels.backup_name }} hasn\'t run on schedule"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Stagger schedules"})," - Don't run all backups at the same time"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use retention"})," - Prevent storage from growing unbounded"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Match frequency to RPO"})," - More frequent = lower data loss"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use compression levels wisely"})," - Higher for archival, lower for frequent"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Monitor schedule adherence"})," - Alert on missed backups"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Test restores"})," - Regularly verify backups are usable"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"./gitops",children:"GitOps Integration"})," - Version control your backup configs"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"./secrets",children:"Secrets Guide"})," - Configure credentials"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"../crds/kafkabackup",children:"KafkaBackup CRD"})," - Full specification"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>i,x:()=>l});var a=s(6540);const r={},c=a.createContext(r);function i(e){const n=a.useContext(c);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(c.Provider,{value:n},e.children)}}}]);