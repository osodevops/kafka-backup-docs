"use strict";(globalThis.webpackChunkkafka_backup_docs=globalThis.webpackChunkkafka_backup_docs||[]).push([[4088],{1798:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>t,metadata:()=>i,toc:()=>o});const i=JSON.parse('{"id":"guides/backup-to-s3","title":"Backup to S3","description":"Step-by-step guide to backing up Kafka topics to Amazon S3","source":"@site/docs/guides/backup-to-s3.md","sourceDirName":"guides","slug":"/guides/backup-to-s3","permalink":"/guides/backup-to-s3","draft":false,"unlisted":false,"editUrl":"https://github.com/osodevops/kafka-backup-docs/tree/main/docs/docs/guides/backup-to-s3.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"title":"Backup to S3","description":"Step-by-step guide to backing up Kafka topics to Amazon S3","sidebar_position":1},"sidebar":"docsSidebar","previous":{"title":"Google Cloud Storage Setup","permalink":"/deployment/cloud-setup/gcs"},"next":{"title":"Point-in-Time Recovery","permalink":"/guides/restore-pitr"}}');var a=s(4848),c=s(8453);const t={title:"Backup to S3",description:"Step-by-step guide to backing up Kafka topics to Amazon S3",sidebar_position:1},r="Backup to S3",l={},o=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Step 1: Configure AWS Credentials",id:"step-1-configure-aws-credentials",level:2},{value:"Option A: Environment Variables",id:"option-a-environment-variables",level:3},{value:"Option B: AWS Credentials File",id:"option-b-aws-credentials-file",level:3},{value:"Option C: IAM Role (EC2/EKS)",id:"option-c-iam-role-ec2eks",level:3},{value:"Step 2: Create Backup Configuration",id:"step-2-create-backup-configuration",level:2},{value:"Step 3: Run the Backup",id:"step-3-run-the-backup",level:2},{value:"Expected Output",id:"expected-output",level:3},{value:"Step 4: Verify the Backup",id:"step-4-verify-the-backup",level:2},{value:"List Backups",id:"list-backups",level:3},{value:"Describe Backup",id:"describe-backup",level:3},{value:"Validate Integrity",id:"validate-integrity",level:3},{value:"Step 5: Verify in S3",id:"step-5-verify-in-s3",level:2},{value:"Incremental Backups",id:"incremental-backups",level:2},{value:"Scheduled Backups",id:"scheduled-backups",level:2},{value:"Cron",id:"cron",level:3},{value:"Kubernetes CronJob",id:"kubernetes-cronjob",level:3},{value:"S3 Best Practices",id:"s3-best-practices",level:2},{value:"Use Lifecycle Policies",id:"use-lifecycle-policies",level:3},{value:"Enable Versioning",id:"enable-versioning",level:3},{value:"Use Server-Side Encryption",id:"use-server-side-encryption",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Access Denied",id:"access-denied",level:3},{value:"Slow Uploads",id:"slow-uploads",level:3},{value:"Connection Timeout",id:"connection-timeout",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,c.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"backup-to-s3",children:"Backup to S3"})}),"\n",(0,a.jsx)(n.p,{children:"This guide walks through setting up and running Kafka backups to Amazon S3."}),"\n",(0,a.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"OSO Kafka Backup installed"}),"\n",(0,a.jsx)(n.li,{children:"Kafka cluster accessible"}),"\n",(0,a.jsxs)(n.li,{children:["AWS S3 bucket created (",(0,a.jsx)(n.a,{href:"../deployment/cloud-setup/aws-s3",children:"AWS S3 Setup"}),")"]}),"\n",(0,a.jsx)(n.li,{children:"AWS credentials configured"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"step-1-configure-aws-credentials",children:"Step 1: Configure AWS Credentials"}),"\n",(0,a.jsx)(n.h3,{id:"option-a-environment-variables",children:"Option A: Environment Variables"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'export AWS_ACCESS_KEY_ID="AKIA..."\nexport AWS_SECRET_ACCESS_KEY="..."\nexport AWS_REGION="us-west-2"\n'})}),"\n",(0,a.jsx)(n.h3,{id:"option-b-aws-credentials-file",children:"Option B: AWS Credentials File"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# ~/.aws/credentials\n[default]\naws_access_key_id = AKIA...\naws_secret_access_key = ...\n\n# ~/.aws/config\n[default]\nregion = us-west-2\n"})}),"\n",(0,a.jsx)(n.h3,{id:"option-c-iam-role-ec2eks",children:"Option C: IAM Role (EC2/EKS)"}),"\n",(0,a.jsx)(n.p,{children:"No configuration needed when running on EC2 with instance profile or EKS with IRSA."}),"\n",(0,a.jsx)(n.h2,{id:"step-2-create-backup-configuration",children:"Step 2: Create Backup Configuration"}),"\n",(0,a.jsxs)(n.p,{children:["Create ",(0,a.jsx)(n.code,{children:"s3-backup.yaml"}),":"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",metastring:'title="s3-backup.yaml"',children:'mode: backup\nbackup_id: "production-daily"\n\nsource:\n  bootstrap_servers:\n    - kafka-0.kafka.svc:9092\n    - kafka-1.kafka.svc:9092\n    - kafka-2.kafka.svc:9092\n  topics:\n    include:\n      - orders\n      - payments\n      - "events-*"\n    exclude:\n      - "__consumer_offsets"\n      - "_schemas"\n\nstorage:\n  backend: s3\n  bucket: my-kafka-backups\n  region: us-west-2\n  prefix: production/daily\n\nbackup:\n  compression: zstd\n  compression_level: 3\n  checkpoint_interval_secs: 30\n  include_offset_headers: true\n  source_cluster_id: "prod-us-west-2"\n'})}),"\n",(0,a.jsx)(n.h2,{id:"step-3-run-the-backup",children:"Step 3: Run the Backup"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kafka-backup backup --config s3-backup.yaml\n"})}),"\n",(0,a.jsx)(n.p,{children:"With verbose logging:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kafka-backup -v backup --config s3-backup.yaml\n"})}),"\n",(0,a.jsx)(n.h3,{id:"expected-output",children:"Expected Output"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"[INFO] Starting backup: production-daily\n[INFO] Connecting to Kafka cluster...\n[INFO] Connected to cluster: prod-us-west-2\n[INFO] Storage: s3://my-kafka-backups/production/daily\n[INFO] Topics to backup:\n  - orders (6 partitions)\n  - payments (3 partitions)\n  - events-clickstream (12 partitions)\n\n[INFO] Backing up topic: orders\n  Partition 0: 150,234 records\n  Partition 1: 148,892 records\n  ...\n\n[INFO] Backup completed successfully\n[INFO] Summary:\n  Topics: 3\n  Records: 1,234,567\n  Compressed Size: 128 MB\n  Duration: 4m 23s\n  S3 Objects: 45\n"})}),"\n",(0,a.jsx)(n.h2,{id:"step-4-verify-the-backup",children:"Step 4: Verify the Backup"}),"\n",(0,a.jsx)(n.h3,{id:"list-backups",children:"List Backups"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kafka-backup list --path s3://my-kafka-backups/production/daily\n"})}),"\n",(0,a.jsx)(n.h3,{id:"describe-backup",children:"Describe Backup"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kafka-backup describe \\\n  --path s3://my-kafka-backups/production/daily \\\n  --backup-id production-daily\n"})}),"\n",(0,a.jsx)(n.h3,{id:"validate-integrity",children:"Validate Integrity"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Quick validation\nkafka-backup validate \\\n  --path s3://my-kafka-backups/production/daily \\\n  --backup-id production-daily\n\n# Deep validation\nkafka-backup validate \\\n  --path s3://my-kafka-backups/production/daily \\\n  --backup-id production-daily \\\n  --deep\n"})}),"\n",(0,a.jsx)(n.h2,{id:"step-5-verify-in-s3",children:"Step 5: Verify in S3"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# List backup objects\naws s3 ls s3://my-kafka-backups/production/daily/production-daily/ --recursive\n\n# Check manifest\naws s3 cp s3://my-kafka-backups/production/daily/production-daily/manifest.json - | jq .\n"})}),"\n",(0,a.jsx)(n.h2,{id:"incremental-backups",children:"Incremental Backups"}),"\n",(0,a.jsx)(n.p,{children:"For subsequent backups, use a different backup_id or timestamp:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'backup_id: "production-daily-$(date +%Y%m%d)"\n'})}),"\n",(0,a.jsx)(n.p,{children:"Or use continuous backup mode:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"backup:\n  continuous: true  # Stream changes continuously\n  start_offset: latest  # Start from current position\n"})}),"\n",(0,a.jsx)(n.h2,{id:"scheduled-backups",children:"Scheduled Backups"}),"\n",(0,a.jsx)(n.h3,{id:"cron",children:"Cron"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Daily at 2 AM\n0 2 * * * /usr/local/bin/kafka-backup backup --config /etc/kafka-backup/s3-backup.yaml >> /var/log/kafka-backup/backup.log 2>&1\n"})}),"\n",(0,a.jsx)(n.h3,{id:"kubernetes-cronjob",children:"Kubernetes CronJob"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'apiVersion: batch/v1\nkind: CronJob\nmetadata:\n  name: kafka-backup-s3\nspec:\n  schedule: "0 2 * * *"\n  jobTemplate:\n    spec:\n      template:\n        spec:\n          containers:\n            - name: kafka-backup\n              image: ghcr.io/osodevops/kafka-backup:latest\n              args: ["backup", "--config", "/config/s3-backup.yaml"]\n              env:\n                - name: AWS_REGION\n                  value: us-west-2\n              # Use IRSA or mount credentials\n'})}),"\n",(0,a.jsx)(n.h2,{id:"s3-best-practices",children:"S3 Best Practices"}),"\n",(0,a.jsx)(n.h3,{id:"use-lifecycle-policies",children:"Use Lifecycle Policies"}),"\n",(0,a.jsx)(n.p,{children:"Automatically transition old backups to cheaper storage:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"aws s3api put-bucket-lifecycle-configuration \\\n  --bucket my-kafka-backups \\\n  --lifecycle-configuration file://lifecycle.json\n"})}),"\n",(0,a.jsx)(n.h3,{id:"enable-versioning",children:"Enable Versioning"}),"\n",(0,a.jsx)(n.p,{children:"Protect against accidental overwrites:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"aws s3api put-bucket-versioning \\\n  --bucket my-kafka-backups \\\n  --versioning-configuration Status=Enabled\n"})}),"\n",(0,a.jsx)(n.h3,{id:"use-server-side-encryption",children:"Use Server-Side Encryption"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'aws s3api put-bucket-encryption \\\n  --bucket my-kafka-backups \\\n  --server-side-encryption-configuration \'{\n    "Rules": [{"ApplyServerSideEncryptionByDefault": {"SSEAlgorithm": "AES256"}}]\n  }\'\n'})}),"\n",(0,a.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,a.jsx)(n.h3,{id:"access-denied",children:"Access Denied"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# Test credentials\naws sts get-caller-identity\n\n# Test bucket access\naws s3 ls s3://my-kafka-backups/\n"})}),"\n",(0,a.jsx)(n.h3,{id:"slow-uploads",children:"Slow Uploads"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Check network bandwidth to S3"}),"\n",(0,a.jsx)(n.li,{children:"Use a bucket in the same region as your Kafka cluster"}),"\n",(0,a.jsx)(n.li,{children:"Consider using S3 Transfer Acceleration"}),"\n",(0,a.jsx)(n.li,{children:"Increase segment size for fewer uploads"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"connection-timeout",children:"Connection Timeout"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"Check security groups and network ACLs"}),"\n",(0,a.jsx)(n.li,{children:"Verify VPC endpoint configuration (if using)"}),"\n",(0,a.jsx)(n.li,{children:"Check for proxy settings"}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"./restore-pitr",children:"Point-in-Time Recovery"})," - Restore from S3 backup"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"./performance-tuning",children:"Performance Tuning"})," - Optimize backup speed"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.a,{href:"../operator",children:"Kubernetes Operator"})," - Automate S3 backups"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>r});var i=s(6540);const a={},c=i.createContext(a);function t(e){const n=i.useContext(c);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),i.createElement(c.Provider,{value:n},e.children)}}}]);