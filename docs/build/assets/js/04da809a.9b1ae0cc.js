"use strict";(globalThis.webpackChunkkafka_backup_docs=globalThis.webpackChunkkafka_backup_docs||[]).push([[1968],{4137:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>i,default:()=>u,frontMatter:()=>c,metadata:()=>s,toc:()=>l});const s=JSON.parse('{"id":"deployment/kubernetes","title":"Kubernetes Deployment","description":"Deploy OSO Kafka Backup on Kubernetes manually or with the Operator","source":"@site/docs/deployment/kubernetes.md","sourceDirName":"deployment","slug":"/deployment/kubernetes","permalink":"/deployment/kubernetes","draft":false,"unlisted":false,"editUrl":"https://github.com/osodevops/kafka-backup-docs/tree/main/docs/docs/deployment/kubernetes.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Kubernetes Deployment","description":"Deploy OSO Kafka Backup on Kubernetes manually or with the Operator","sidebar_position":4},"sidebar":"docsSidebar","previous":{"title":"Docker Deployment","permalink":"/deployment/docker"},"next":{"title":"AWS S3 Setup","permalink":"/deployment/cloud-setup/aws-s3"}}');var t=a(4848),r=a(8453);const c={title:"Kubernetes Deployment",description:"Deploy OSO Kafka Backup on Kubernetes manually or with the Operator",sidebar_position:4},i="Kubernetes Deployment",o={},l=[{value:"Deployment Options",id:"deployment-options",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"CronJob Deployment",id:"cronjob-deployment",level:2},{value:"Create Namespace",id:"create-namespace",level:3},{value:"Create ConfigMap",id:"create-configmap",level:3},{value:"Create PVC for Storage",id:"create-pvc-for-storage",level:3},{value:"Create CronJob",id:"create-cronjob",level:3},{value:"Verify CronJob",id:"verify-cronjob",level:3},{value:"S3 Storage Configuration",id:"s3-storage-configuration",level:2},{value:"Create Secret for AWS Credentials",id:"create-secret-for-aws-credentials",level:3},{value:"Update ConfigMap for S3",id:"update-configmap-for-s3",level:3},{value:"Update CronJob for S3",id:"update-cronjob-for-s3",level:3},{value:"Kafka Authentication",id:"kafka-authentication",level:2},{value:"SASL/SCRAM Authentication",id:"saslscram-authentication",level:3},{value:"TLS Certificates",id:"tls-certificates",level:3},{value:"One-Time Job",id:"one-time-job",level:2},{value:"Restore Job",id:"restore-job",level:2},{value:"Monitoring",id:"monitoring",level:2},{value:"Pod Disruption Budget",id:"pod-disruption-budget",level:3},{value:"ServiceMonitor (Prometheus)",id:"servicemonitor-prometheus",level:3},{value:"Resource Recommendations",id:"resource-recommendations",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Check Job Status",id:"check-job-status",level:3},{value:"View Logs",id:"view-logs",level:3},{value:"Debug Pod",id:"debug-pod",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"kubernetes-deployment",children:"Kubernetes Deployment"})}),"\n",(0,t.jsxs)(n.p,{children:["Deploy OSO Kafka Backup on Kubernetes clusters. This guide covers manual deployment; for automated management, see the ",(0,t.jsx)(n.a,{href:"../operator",children:"Kubernetes Operator"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"deployment-options",children:"Deployment Options"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Method"}),(0,t.jsx)(n.th,{children:"Use Case"}),(0,t.jsx)(n.th,{children:"Management"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"CronJob"})}),(0,t.jsx)(n.td,{children:"Scheduled backups"}),(0,t.jsx)(n.td,{children:"Manual"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Job"})}),(0,t.jsx)(n.td,{children:"One-time backup/restore"}),(0,t.jsx)(n.td,{children:"Manual"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Operator"})}),(0,t.jsx)(n.td,{children:"Production automation"}),(0,t.jsx)(n.td,{children:"GitOps/CRDs"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Kubernetes 1.21+"}),"\n",(0,t.jsx)(n.li,{children:"kubectl configured"}),"\n",(0,t.jsx)(n.li,{children:"Kafka cluster accessible from K8s"}),"\n",(0,t.jsx)(n.li,{children:"Storage (PVC or cloud credentials)"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"cronjob-deployment",children:"CronJob Deployment"}),"\n",(0,t.jsx)(n.h3,{id:"create-namespace",children:"Create Namespace"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl create namespace kafka-backup\n"})}),"\n",(0,t.jsx)(n.h3,{id:"create-configmap",children:"Create ConfigMap"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="configmap.yaml"',children:'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: kafka-backup-config\n  namespace: kafka-backup\ndata:\n  backup.yaml: |\n    mode: backup\n    backup_id: "k8s-daily-backup"\n\n    source:\n      bootstrap_servers:\n        - kafka-0.kafka.kafka.svc:9092\n        - kafka-1.kafka.kafka.svc:9092\n        - kafka-2.kafka.kafka.svc:9092\n      topics:\n        include:\n          - "*"\n        exclude:\n          - "__consumer_offsets"\n          - "_schemas"\n\n    storage:\n      backend: filesystem\n      path: "/data/backups"\n\n    backup:\n      compression: zstd\n      compression_level: 3\n      checkpoint_interval_secs: 30\n      include_offset_headers: true\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f configmap.yaml\n"})}),"\n",(0,t.jsx)(n.h3,{id:"create-pvc-for-storage",children:"Create PVC for Storage"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="pvc.yaml"',children:"apiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: kafka-backup-storage\n  namespace: kafka-backup\nspec:\n  accessModes:\n    - ReadWriteOnce\n  resources:\n    requests:\n      storage: 100Gi\n  storageClassName: standard  # Adjust for your cluster\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f pvc.yaml\n"})}),"\n",(0,t.jsx)(n.h3,{id:"create-cronjob",children:"Create CronJob"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="cronjob.yaml"',children:'apiVersion: batch/v1\nkind: CronJob\nmetadata:\n  name: kafka-backup\n  namespace: kafka-backup\nspec:\n  schedule: "0 2 * * *"  # Daily at 2 AM\n  concurrencyPolicy: Forbid\n  successfulJobsHistoryLimit: 3\n  failedJobsHistoryLimit: 3\n  jobTemplate:\n    spec:\n      backoffLimit: 2\n      template:\n        spec:\n          restartPolicy: OnFailure\n          securityContext:\n            runAsNonRoot: true\n            runAsUser: 1000\n            fsGroup: 1000\n          containers:\n            - name: kafka-backup\n              image: ghcr.io/osodevops/kafka-backup:latest\n              args:\n                - backup\n                - --config\n                - /config/backup.yaml\n              resources:\n                requests:\n                  cpu: 500m\n                  memory: 512Mi\n                limits:\n                  cpu: 2000m\n                  memory: 2Gi\n              volumeMounts:\n                - name: config\n                  mountPath: /config\n                  readOnly: true\n                - name: data\n                  mountPath: /data/backups\n              securityContext:\n                allowPrivilegeEscalation: false\n                readOnlyRootFilesystem: true\n                capabilities:\n                  drop:\n                    - ALL\n          volumes:\n            - name: config\n              configMap:\n                name: kafka-backup-config\n            - name: data\n              persistentVolumeClaim:\n                claimName: kafka-backup-storage\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f cronjob.yaml\n"})}),"\n",(0,t.jsx)(n.h3,{id:"verify-cronjob",children:"Verify CronJob"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Check CronJob\nkubectl get cronjob -n kafka-backup\n\n# List Jobs\nkubectl get jobs -n kafka-backup\n\n# Check recent Pod logs\nkubectl logs -n kafka-backup -l job-name=kafka-backup-<timestamp>\n"})}),"\n",(0,t.jsx)(n.h2,{id:"s3-storage-configuration",children:"S3 Storage Configuration"}),"\n",(0,t.jsx)(n.h3,{id:"create-secret-for-aws-credentials",children:"Create Secret for AWS Credentials"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="aws-secret.yaml"',children:'apiVersion: v1\nkind: Secret\nmetadata:\n  name: aws-credentials\n  namespace: kafka-backup\ntype: Opaque\nstringData:\n  AWS_ACCESS_KEY_ID: "AKIA..."\n  AWS_SECRET_ACCESS_KEY: "..."\n'})}),"\n",(0,t.jsx)(n.p,{children:"Or using IAM Roles for Service Accounts (IRSA):"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="serviceaccount.yaml"',children:"apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kafka-backup\n  namespace: kafka-backup\n  annotations:\n    eks.amazonaws.com/role-arn: arn:aws:iam::123456789:role/kafka-backup-role\n"})}),"\n",(0,t.jsx)(n.h3,{id:"update-configmap-for-s3",children:"Update ConfigMap for S3"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'data:\n  backup.yaml: |\n    mode: backup\n    backup_id: "k8s-daily-backup"\n\n    source:\n      bootstrap_servers:\n        - kafka-0.kafka.kafka.svc:9092\n      topics:\n        include:\n          - "*"\n\n    storage:\n      backend: s3\n      bucket: my-kafka-backups\n      region: us-west-2\n      prefix: production/daily\n\n    backup:\n      compression: zstd\n'})}),"\n",(0,t.jsx)(n.h3,{id:"update-cronjob-for-s3",children:"Update CronJob for S3"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"spec:\n  jobTemplate:\n    spec:\n      template:\n        spec:\n          serviceAccountName: kafka-backup  # For IRSA\n          containers:\n            - name: kafka-backup\n              envFrom:\n                - secretRef:\n                    name: aws-credentials  # Or use IRSA\n"})}),"\n",(0,t.jsx)(n.h2,{id:"kafka-authentication",children:"Kafka Authentication"}),"\n",(0,t.jsx)(n.h3,{id:"saslscram-authentication",children:"SASL/SCRAM Authentication"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="kafka-secret.yaml"',children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: kafka-credentials\n  namespace: kafka-backup\ntype: Opaque\nstringData:\n  username: backup-user\n  password: your-password\n"})}),"\n",(0,t.jsx)(n.p,{children:"Update ConfigMap:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"data:\n  backup.yaml: |\n    source:\n      bootstrap_servers:\n        - kafka:9092\n      security:\n        security_protocol: SASL_SSL\n        sasl_mechanism: SCRAM-SHA-256\n        sasl_username: ${KAFKA_USERNAME}\n        sasl_password: ${KAFKA_PASSWORD}\n"})}),"\n",(0,t.jsx)(n.p,{children:"Update CronJob:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"containers:\n  - name: kafka-backup\n    env:\n      - name: KAFKA_USERNAME\n        valueFrom:\n          secretKeyRef:\n            name: kafka-credentials\n            key: username\n      - name: KAFKA_PASSWORD\n        valueFrom:\n          secretKeyRef:\n            name: kafka-credentials\n            key: password\n"})}),"\n",(0,t.jsx)(n.h3,{id:"tls-certificates",children:"TLS Certificates"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="tls-secret.yaml"',children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: kafka-tls\n  namespace: kafka-backup\ntype: Opaque\ndata:\n  ca.crt: <base64-encoded-ca>\n  client.crt: <base64-encoded-cert>\n  client.key: <base64-encoded-key>\n"})}),"\n",(0,t.jsx)(n.p,{children:"Mount in CronJob:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"volumeMounts:\n  - name: tls\n    mountPath: /certs\n    readOnly: true\nvolumes:\n  - name: tls\n    secret:\n      secretName: kafka-tls\n"})}),"\n",(0,t.jsx)(n.h2,{id:"one-time-job",children:"One-Time Job"}),"\n",(0,t.jsx)(n.p,{children:"For one-time backup or restore:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="backup-job.yaml"',children:"apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: kafka-backup-manual\n  namespace: kafka-backup\nspec:\n  ttlSecondsAfterFinished: 86400  # Clean up after 24h\n  template:\n    spec:\n      restartPolicy: Never\n      containers:\n        - name: kafka-backup\n          image: ghcr.io/osodevops/kafka-backup:latest\n          args:\n            - backup\n            - --config\n            - /config/backup.yaml\n          volumeMounts:\n            - name: config\n              mountPath: /config\n            - name: data\n              mountPath: /data/backups\n      volumes:\n        - name: config\n          configMap:\n            name: kafka-backup-config\n        - name: data\n          persistentVolumeClaim:\n            claimName: kafka-backup-storage\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f backup-job.yaml\n\n# Watch job progress\nkubectl logs -n kafka-backup -f job/kafka-backup-manual\n"})}),"\n",(0,t.jsx)(n.h2,{id:"restore-job",children:"Restore Job"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="restore-job.yaml"',children:"apiVersion: batch/v1\nkind: Job\nmetadata:\n  name: kafka-restore\n  namespace: kafka-backup\nspec:\n  template:\n    spec:\n      restartPolicy: Never\n      containers:\n        - name: kafka-backup\n          image: ghcr.io/osodevops/kafka-backup:latest\n          args:\n            - restore\n            - --config\n            - /config/restore.yaml\n          volumeMounts:\n            - name: config\n              configMap:\n                name: kafka-restore-config\n                items:\n                  - key: restore.yaml\n                    path: restore.yaml\n            - name: data\n              mountPath: /data/backups\n      volumes:\n        - name: config\n          configMap:\n            name: kafka-restore-config\n        - name: data\n          persistentVolumeClaim:\n            claimName: kafka-backup-storage\n"})}),"\n",(0,t.jsx)(n.h2,{id:"monitoring",children:"Monitoring"}),"\n",(0,t.jsx)(n.h3,{id:"pod-disruption-budget",children:"Pod Disruption Budget"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="pdb.yaml"',children:"apiVersion: policy/v1\nkind: PodDisruptionBudget\nmetadata:\n  name: kafka-backup-pdb\n  namespace: kafka-backup\nspec:\n  minAvailable: 0\n  selector:\n    matchLabels:\n      app: kafka-backup\n"})}),"\n",(0,t.jsx)(n.h3,{id:"servicemonitor-prometheus",children:"ServiceMonitor (Prometheus)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="servicemonitor.yaml"',children:"apiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: kafka-backup\n  namespace: kafka-backup\nspec:\n  selector:\n    matchLabels:\n      app: kafka-backup\n  endpoints:\n    - port: metrics\n      interval: 30s\n"})}),"\n",(0,t.jsx)(n.h2,{id:"resource-recommendations",children:"Resource Recommendations"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Cluster Size"}),(0,t.jsx)(n.th,{children:"CPU Request"}),(0,t.jsx)(n.th,{children:"Memory Request"}),(0,t.jsx)(n.th,{children:"CPU Limit"}),(0,t.jsx)(n.th,{children:"Memory Limit"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Small"}),(0,t.jsx)(n.td,{children:"250m"}),(0,t.jsx)(n.td,{children:"256Mi"}),(0,t.jsx)(n.td,{children:"1000m"}),(0,t.jsx)(n.td,{children:"1Gi"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Medium"}),(0,t.jsx)(n.td,{children:"500m"}),(0,t.jsx)(n.td,{children:"512Mi"}),(0,t.jsx)(n.td,{children:"2000m"}),(0,t.jsx)(n.td,{children:"2Gi"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Large"}),(0,t.jsx)(n.td,{children:"1000m"}),(0,t.jsx)(n.td,{children:"1Gi"}),(0,t.jsx)(n.td,{children:"4000m"}),(0,t.jsx)(n.td,{children:"4Gi"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"check-job-status",children:"Check Job Status"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl get jobs -n kafka-backup\nkubectl describe job kafka-backup-manual -n kafka-backup\n"})}),"\n",(0,t.jsx)(n.h3,{id:"view-logs",children:"View Logs"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl logs -n kafka-backup -l job-name=kafka-backup-<id> --tail=100\n"})}),"\n",(0,t.jsx)(n.h3,{id:"debug-pod",children:"Debug Pod"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"kubectl run -n kafka-backup debug --rm -it \\\n  --image=ghcr.io/osodevops/kafka-backup:latest \\\n  --restart=Never -- /bin/sh\n"})}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"../operator",children:"Kubernetes Operator"})," - Automated CRD-based management"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"../guides/security-setup",children:"Security Setup"})," - TLS and SASL configuration"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"./cloud-setup/aws-s3",children:"AWS S3 Setup"})," - S3 storage configuration"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>c,x:()=>i});var s=a(6540);const t={},r=s.createContext(t);function c(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);