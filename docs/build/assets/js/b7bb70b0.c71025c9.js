"use strict";(globalThis.webpackChunkkafka_backup_docs=globalThis.webpackChunkkafka_backup_docs||[]).push([[5117],{3721:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>c,contentTitle:()=>i,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"guides/offset-management","title":"Offset Management","description":"Manage consumer group offsets during backup and restore operations","source":"@site/docs/guides/offset-management.md","sourceDirName":"guides","slug":"/guides/offset-management","permalink":"/guides/offset-management","draft":false,"unlisted":false,"editUrl":"https://github.com/osodevops/kafka-backup-docs/tree/main/docs/docs/guides/offset-management.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Offset Management","description":"Manage consumer group offsets during backup and restore operations","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Point-in-Time Recovery","permalink":"/guides/restore-pitr"},"next":{"title":"Performance Tuning","permalink":"/guides/performance-tuning"}}');var t=n(4848),a=n(8453);const o={title:"Offset Management",description:"Manage consumer group offsets during backup and restore operations",sidebar_position:3},i="Offset Management",c={},l=[{value:"Understanding Offsets",id:"understanding-offsets",level:2},{value:"What Are Offsets?",id:"what-are-offsets",level:3},{value:"Consumer Group Offsets",id:"consumer-group-offsets",level:3},{value:"The Restore Challenge",id:"the-restore-challenge",level:3},{value:"Offset Strategies",id:"offset-strategies",level:2},{value:"Strategy 1: Skip (Manual Later)",id:"strategy-1-skip-manual-later",level:3},{value:"Strategy 2: Header-Based",id:"strategy-2-header-based",level:3},{value:"Strategy 3: Automatic Reset",id:"strategy-3-automatic-reset",level:3},{value:"Viewing Offset Mapping",id:"viewing-offset-mapping",level:2},{value:"Manual Offset Reset",id:"manual-offset-reset",level:2},{value:"Using Kafka Tools",id:"using-kafka-tools",level:3},{value:"Using kafka-backup CLI",id:"using-kafka-backup-cli",level:3},{value:"Generate Reset Plan",id:"generate-reset-plan",level:4},{value:"Execute Reset",id:"execute-reset",level:4},{value:"Generate Shell Script",id:"generate-shell-script",level:4},{value:"Bulk Offset Reset",id:"bulk-offset-reset",level:2},{value:"Offset Snapshots and Rollback",id:"offset-snapshots-and-rollback",level:2},{value:"Create Snapshot Before Changes",id:"create-snapshot-before-changes",level:3},{value:"List Snapshots",id:"list-snapshots",level:3},{value:"View Snapshot Details",id:"view-snapshot-details",level:3},{value:"Rollback to Snapshot",id:"rollback-to-snapshot",level:3},{value:"Verify Offsets Match Snapshot",id:"verify-offsets-match-snapshot",level:3},{value:"Three-Phase Restore",id:"three-phase-restore",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Before Restore",id:"before-restore",level:3},{value:"During Restore",id:"during-restore",level:3},{value:"After Restore",id:"after-restore",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Consumer Group Not Found",id:"consumer-group-not-found",level:3},{value:"Offsets Out of Range",id:"offsets-out-of-range",level:3},{value:"Consumer Still Running",id:"consumer-still-running",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"offset-management",children:"Offset Management"})}),"\n",(0,t.jsx)(s.p,{children:"Managing consumer group offsets is critical when restoring Kafka data. This guide covers offset concepts and management strategies."}),"\n",(0,t.jsx)(s.h2,{id:"understanding-offsets",children:"Understanding Offsets"}),"\n",(0,t.jsx)(s.h3,{id:"what-are-offsets",children:"What Are Offsets?"}),"\n",(0,t.jsx)(s.p,{children:"Kafka offsets are sequential IDs assigned to each message in a partition:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Partition 0:\n\u250c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2510\n\u2502 0  \u2502 1  \u2502 2  \u2502 3  \u2502 4  \u2502 5  \u2502 6  \u2502  \u2190 Offsets\n\u2514\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2518\n  \u2191                        \u2191\n  Earliest                 Latest (High Watermark)\n"})}),"\n",(0,t.jsx)(s.h3,{id:"consumer-group-offsets",children:"Consumer Group Offsets"}),"\n",(0,t.jsx)(s.p,{children:"Consumer groups track their position (committed offset) in each partition:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Consumer Group: order-processor\n  orders-0: committed offset 5 (next to read: 6)\n  orders-1: committed offset 3 (next to read: 4)\n  orders-2: committed offset 7 (next to read: 8)\n"})}),"\n",(0,t.jsx)(s.h3,{id:"the-restore-challenge",children:"The Restore Challenge"}),"\n",(0,t.jsx)(s.p,{children:"When data is restored, original offsets don't match the new offsets:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Original Cluster:       Restored Cluster:\n\u250c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2510\n\u2502 0  \u2502 1  \u2502 2  \u2502 3  \u2502   \u2502 0  \u2502 1  \u2502 2  \u2502 3  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2518\nConsumer at offset 2     Consumer still thinks offset 2\n                         but data changed!\n"})}),"\n",(0,t.jsx)(s.h2,{id:"offset-strategies",children:"Offset Strategies"}),"\n",(0,t.jsx)(s.h3,{id:"strategy-1-skip-manual-later",children:"Strategy 1: Skip (Manual Later)"}),"\n",(0,t.jsx)(s.p,{children:"Don't modify offsets during restore. Handle manually afterward."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"restore:\n  consumer_group_strategy: skip\n"})}),"\n",(0,t.jsx)(s.p,{children:"Best for:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Development/testing environments"}),"\n",(0,t.jsx)(s.li,{children:"When consumers will reprocess all data anyway"}),"\n",(0,t.jsx)(s.li,{children:"Manual offset management workflows"}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"strategy-2-header-based",children:"Strategy 2: Header-Based"}),"\n",(0,t.jsx)(s.p,{children:"Store original offset in message headers. Consumers read headers to track position."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"restore:\n  consumer_group_strategy: header-based\n  include_original_offset_header: true\n"})}),"\n",(0,t.jsx)(s.p,{children:"Each restored message includes:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:'Headers:\n  x-kafka-backup-offset: "12345"\n  x-kafka-backup-timestamp: "1701234567890"\n  x-kafka-backup-partition: "0"\n'})}),"\n",(0,t.jsx)(s.h3,{id:"strategy-3-automatic-reset",children:"Strategy 3: Automatic Reset"}),"\n",(0,t.jsx)(s.p,{children:"Reset consumer offsets as part of the restore process."}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",children:"restore:\n  consumer_group_strategy: header-based\n  reset_consumer_offsets: true\n  consumer_groups:\n    - order-processor\n    - payment-service\n    - analytics-consumer\n"})}),"\n",(0,t.jsx)(s.h2,{id:"viewing-offset-mapping",children:"Viewing Offset Mapping"}),"\n",(0,t.jsx)(s.p,{children:"After backup, view the offset mapping:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kafka-backup show-offset-mapping \\\n  --path /data/backups \\\n  --backup-id production-backup-001\n"})}),"\n",(0,t.jsx)(s.p,{children:"Output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Offset Mapping: production-backup-001\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nTopic: orders\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPartition  First Offset  Last Offset  Record Count\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n0          0             150233       150234\n1          0             148891       148892\n2          0             152456       152457\n\nTopic: payments\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nPartition  First Offset  Last Offset  Record Count\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n0          0             78234        78235\n1          0             76543        76544\n"})}),"\n",(0,t.jsx)(s.p,{children:"Export as CSV for analysis:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kafka-backup show-offset-mapping \\\n  --path /data/backups \\\n  --backup-id production-backup-001 \\\n  --format csv > offset-mapping.csv\n"})}),"\n",(0,t.jsx)(s.h2,{id:"manual-offset-reset",children:"Manual Offset Reset"}),"\n",(0,t.jsx)(s.h3,{id:"using-kafka-tools",children:"Using Kafka Tools"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# Reset to earliest\nkafka-consumer-groups \\\n  --bootstrap-server kafka:9092 \\\n  --group order-processor \\\n  --topic orders \\\n  --reset-offsets \\\n  --to-earliest \\\n  --execute\n\n# Reset to specific offset\nkafka-consumer-groups \\\n  --bootstrap-server kafka:9092 \\\n  --group order-processor \\\n  --topic orders:0 \\\n  --reset-offsets \\\n  --to-offset 150233 \\\n  --execute\n\n# Reset to timestamp\nkafka-consumer-groups \\\n  --bootstrap-server kafka:9092 \\\n  --group order-processor \\\n  --topic orders \\\n  --reset-offsets \\\n  --to-datetime 2024-12-01T10:00:00.000 \\\n  --execute\n"})}),"\n",(0,t.jsx)(s.h3,{id:"using-kafka-backup-cli",children:"Using kafka-backup CLI"}),"\n",(0,t.jsx)(s.h4,{id:"generate-reset-plan",children:"Generate Reset Plan"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kafka-backup offset-reset plan \\\n  --path /data/backups \\\n  --backup-id production-backup-001 \\\n  --groups order-processor,payment-service \\\n  --bootstrap-servers kafka:9092\n"})}),"\n",(0,t.jsx)(s.p,{children:"Output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Offset Reset Plan\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\n\nConsumer Group: order-processor\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nTopic      Partition  Current  Target   Action\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\norders     0          -        150233   SET\norders     1          -        148891   SET\norders     2          -        152456   SET\n\nConsumer Group: payment-service\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\npayments   0          -        78234    SET\npayments   1          -        76543    SET\n\nTotal partitions to reset: 5\n"})}),"\n",(0,t.jsx)(s.h4,{id:"execute-reset",children:"Execute Reset"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kafka-backup offset-reset execute \\\n  --path /data/backups \\\n  --backup-id production-backup-001 \\\n  --groups order-processor \\\n  --bootstrap-servers kafka:9092\n"})}),"\n",(0,t.jsx)(s.h4,{id:"generate-shell-script",children:"Generate Shell Script"}),"\n",(0,t.jsx)(s.p,{children:"For review before execution:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kafka-backup offset-reset script \\\n  --path /data/backups \\\n  --backup-id production-backup-001 \\\n  --groups order-processor \\\n  --bootstrap-servers kafka:9092 \\\n  --output reset-offsets.sh\n"})}),"\n",(0,t.jsx)(s.p,{children:"Generated script:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"#!/bin/bash\n# Offset reset script for backup: production-backup-001\n# Generated: 2024-12-03T10:00:00Z\n\n# Stop consumers before running this script!\n\nkafka-consumer-groups --bootstrap-server kafka:9092 \\\n  --group order-processor \\\n  --topic orders:0 \\\n  --reset-offsets --to-offset 150233 --execute\n\nkafka-consumer-groups --bootstrap-server kafka:9092 \\\n  --group order-processor \\\n  --topic orders:1 \\\n  --reset-offsets --to-offset 148891 --execute\n\n# ... more commands\n"})}),"\n",(0,t.jsx)(s.h2,{id:"bulk-offset-reset",children:"Bulk Offset Reset"}),"\n",(0,t.jsx)(s.p,{children:"For large numbers of partitions, use bulk reset:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kafka-backup offset-reset-bulk \\\n  --path /data/backups \\\n  --backup-id production-backup-001 \\\n  --groups order-processor,payment-service,analytics \\\n  --bootstrap-servers kafka:9092 \\\n  --max-concurrent 100\n"})}),"\n",(0,t.jsx)(s.p,{children:"Benefits:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"~50x faster than sequential reset"}),"\n",(0,t.jsx)(s.li,{children:"Per-partition retry with backoff"}),"\n",(0,t.jsx)(s.li,{children:"Detailed progress reporting"}),"\n",(0,t.jsx)(s.li,{children:"Performance metrics (p50/p99 latency)"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"offset-snapshots-and-rollback",children:"Offset Snapshots and Rollback"}),"\n",(0,t.jsx)(s.h3,{id:"create-snapshot-before-changes",children:"Create Snapshot Before Changes"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:'kafka-backup offset-rollback snapshot \\\n  --path /data/offset-snapshots \\\n  --groups order-processor,payment-service \\\n  --bootstrap-servers kafka:9092 \\\n  --description "Before restore operation"\n'})}),"\n",(0,t.jsx)(s.h3,{id:"list-snapshots",children:"List Snapshots"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kafka-backup offset-rollback list \\\n  --path /data/offset-snapshots\n"})}),"\n",(0,t.jsx)(s.p,{children:"Output:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Offset Snapshots\n\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\nID                          Created               Groups  Description\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\nsnapshot-20241203-100000    2024-12-03T10:00:00Z  2       Before restore\nsnapshot-20241203-090000    2024-12-03T09:00:00Z  2       Before migration\n"})}),"\n",(0,t.jsx)(s.h3,{id:"view-snapshot-details",children:"View Snapshot Details"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kafka-backup offset-rollback show \\\n  --path /data/offset-snapshots \\\n  --snapshot-id snapshot-20241203-100000\n"})}),"\n",(0,t.jsx)(s.h3,{id:"rollback-to-snapshot",children:"Rollback to Snapshot"}),"\n",(0,t.jsx)(s.p,{children:"If something goes wrong:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kafka-backup offset-rollback rollback \\\n  --path /data/offset-snapshots \\\n  --snapshot-id snapshot-20241203-100000 \\\n  --bootstrap-servers kafka:9092\n"})}),"\n",(0,t.jsx)(s.h3,{id:"verify-offsets-match-snapshot",children:"Verify Offsets Match Snapshot"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kafka-backup offset-rollback verify \\\n  --path /data/offset-snapshots \\\n  --snapshot-id snapshot-20241203-100000 \\\n  --bootstrap-servers kafka:9092\n"})}),"\n",(0,t.jsx)(s.h2,{id:"three-phase-restore",children:"Three-Phase Restore"}),"\n",(0,t.jsx)(s.p,{children:"For complete automated recovery:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-yaml",metastring:'title="three-phase-restore.yaml"',children:'mode: restore\nbackup_id: "production-backup-001"\n\ntarget:\n  bootstrap_servers:\n    - kafka-dr:9092\n\nstorage:\n  backend: s3\n  bucket: my-kafka-backups\n  region: us-west-2\n\nrestore:\n  consumer_group_strategy: header-based\n  reset_consumer_offsets: true\n  consumer_groups:\n    - order-processor\n    - payment-service\n    - analytics-consumer\n'})}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"kafka-backup three-phase-restore --config three-phase-restore.yaml\n"})}),"\n",(0,t.jsx)(s.p,{children:"Phases:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Phase 1"}),": Collect offset headers from backup"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Phase 2"}),": Restore data to target cluster"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Phase 3"}),": Reset consumer group offsets"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsx)(s.h3,{id:"before-restore",children:"Before Restore"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Stop consumers"})," - Prevent offset commits during restore"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Snapshot current offsets"})," - Enable rollback if needed"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Document consumer groups"})," - Know which groups need reset"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"during-restore",children:"During Restore"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Use header-based strategy"})," - Preserve original offset information"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Enable dry-run first"})," - Validate configuration"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Monitor progress"})," - Watch for errors"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"after-restore",children:"After Restore"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Verify offset mapping"})," - Check offsets are set correctly"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Start consumers gradually"})," - Monitor for reprocessing issues"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Keep snapshots"})," - Retain for potential rollback"]}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(s.h3,{id:"consumer-group-not-found",children:"Consumer Group Not Found"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Error: Consumer group 'my-group' not found\n"})}),"\n",(0,t.jsx)(s.p,{children:"The group may not exist if:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Consumers never started"}),"\n",(0,t.jsx)(s.li,{children:"Group was deleted"}),"\n",(0,t.jsx)(s.li,{children:"Using incorrect group name"}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:["Solution: Create the group by starting a consumer, or use ",(0,t.jsx)(s.code,{children:"--reset-offsets --to-earliest --dry-run"})," first."]}),"\n",(0,t.jsx)(s.h3,{id:"offsets-out-of-range",children:"Offsets Out of Range"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Error: Offset 150000 is out of range for partition 0 (current: 0-100)\n"})}),"\n",(0,t.jsx)(s.p,{children:"Target offset doesn't exist in restored topic. This can happen with PITR restores."}),"\n",(0,t.jsxs)(s.p,{children:["Solution: Reset to ",(0,t.jsx)(s.code,{children:"--to-earliest"})," or ",(0,t.jsx)(s.code,{children:"--to-latest"})," instead of specific offset."]}),"\n",(0,t.jsx)(s.h3,{id:"consumer-still-running",children:"Consumer Still Running"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"Error: Consumer group has active members\n"})}),"\n",(0,t.jsx)(s.p,{children:"Stop all consumers before resetting offsets:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# Check active members\nkafka-consumer-groups \\\n  --bootstrap-server kafka:9092 \\\n  --group order-processor \\\n  --describe --members\n"})}),"\n",(0,t.jsx)(s.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"../reference/cli-reference#three-phase-restore",children:"Three-Phase Restore"})," - Automated restore"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"./performance-tuning",children:"Performance Tuning"})," - Optimize operations"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.a,{href:"../use-cases/disaster-recovery",children:"Disaster Recovery"})," - DR planning"]}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>o,x:()=>i});var r=n(6540);const t={},a=r.createContext(t);function o(e){const s=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function i(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(a.Provider,{value:s},e.children)}}}]);