"use strict";(globalThis.webpackChunkkafka_backup_docs=globalThis.webpackChunkkafka_backup_docs||[]).push([[456],{2539:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>c,default:()=>o,frontMatter:()=>d,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"reference/storage-format","title":"Storage Format","description":"OSO Kafka Backup storage layout and file format reference","source":"@site/docs/reference/storage-format.md","sourceDirName":"reference","slug":"/reference/storage-format","permalink":"/reference/storage-format","draft":false,"unlisted":false,"editUrl":"https://github.com/osodevops/kafka-backup-docs/tree/main/docs/docs/reference/storage-format.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Storage Format","description":"OSO Kafka Backup storage layout and file format reference","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Configuration Reference","permalink":"/reference/config-yaml"},"next":{"title":"Error Codes","permalink":"/reference/error-codes"}}');var t=n(4848),i=n(8453);const d={title:"Storage Format",description:"OSO Kafka Backup storage layout and file format reference",sidebar_position:3},c="Storage Format",l={},a=[{value:"Directory Structure",id:"directory-structure",level:2},{value:"Manifest File",id:"manifest-file",level:2},{value:"Manifest Fields",id:"manifest-fields",level:3},{value:"Segment Files",id:"segment-files",level:2},{value:"Segment File Format",id:"segment-file-format",level:3},{value:"Segment Header",id:"segment-header",level:3},{value:"Record Batch",id:"record-batch",level:3},{value:"Batch Header",id:"batch-header",level:4},{value:"Record Format",id:"record-format",level:3},{value:"Offset Header",id:"offset-header",level:4},{value:"Checkpoint File",id:"checkpoint-file",level:2},{value:"Checkpoint Fields",id:"checkpoint-fields",level:3},{value:"S3 Object Layout",id:"s3-object-layout",level:2},{value:"S3 Storage Classes",id:"s3-storage-classes",level:3},{value:"Compression",id:"compression",level:2},{value:"Zstandard (zstd)",id:"zstandard-zstd",level:3},{value:"LZ4",id:"lz4",level:3},{value:"No Compression",id:"no-compression",level:3},{value:"Integrity Verification",id:"integrity-verification",level:2},{value:"Checksums",id:"checksums",level:3},{value:"Validation",id:"validation",level:3},{value:"Compatibility",id:"compatibility",level:2},{value:"Forward Compatibility",id:"forward-compatibility",level:3},{value:"Backward Compatibility",id:"backward-compatibility",level:3},{value:"Version Matrix",id:"version-matrix",level:3}];function h(e){const s={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"storage-format",children:"Storage Format"})}),"\n",(0,t.jsx)(s.p,{children:"This document describes the storage layout and file formats used by OSO Kafka Backup."}),"\n",(0,t.jsx)(s.h2,{id:"directory-structure",children:"Directory Structure"}),"\n",(0,t.jsx)(s.p,{children:"Backups are organized in a hierarchical directory structure:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"<storage-root>/\n\u251c\u2500\u2500 <backup-id>/\n\u2502   \u251c\u2500\u2500 manifest.json           # Backup metadata\n\u2502   \u251c\u2500\u2500 topics/\n\u2502   \u2502   \u251c\u2500\u2500 <topic-name>/\n\u2502   \u2502   \u2502   \u251c\u2500\u2500 <partition>/\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 segment-00000000.kbs    # Segment files\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 segment-00000001.kbs\n\u2502   \u2502   \u2502   \u2502   \u251c\u2500\u2500 segment-00000002.kbs\n\u2502   \u2502   \u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2502   \u2514\u2500\u2500 ...\n\u2502   \u2514\u2500\u2500 checkpoints/\n\u2502       \u2514\u2500\u2500 checkpoint.json     # Progress checkpoint\n\u2514\u2500\u2500 <another-backup-id>/\n    \u2514\u2500\u2500 ...\n"})}),"\n",(0,t.jsx)(s.h2,{id:"manifest-file",children:"Manifest File"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"manifest.json"})," file contains backup metadata:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n  "version": "1.0",\n  "backup_id": "production-backup-001",\n  "created_at": "2024-12-03T10:00:00Z",\n  "completed_at": "2024-12-03T10:15:32Z",\n  "source_cluster": {\n    "cluster_id": "prod-cluster-east",\n    "bootstrap_servers": ["broker-1:9092", "broker-2:9092"]\n  },\n  "compression": {\n    "algorithm": "zstd",\n    "level": 3\n  },\n  "statistics": {\n    "topics": 5,\n    "partitions": 24,\n    "segments": 156,\n    "records": 2456789,\n    "uncompressed_bytes": 1288490188,\n    "compressed_bytes": 262832640\n  },\n  "time_range": {\n    "earliest_timestamp": 1701388800000,\n    "latest_timestamp": 1701475199000\n  },\n  "topics": [\n    {\n      "name": "orders",\n      "partitions": [\n        {\n          "partition": 0,\n          "first_offset": 0,\n          "last_offset": 150233,\n          "records": 150234,\n          "segments": 12\n        },\n        {\n          "partition": 1,\n          "first_offset": 0,\n          "last_offset": 148891,\n          "records": 148892,\n          "segments": 11\n        }\n      ]\n    }\n  ]\n}\n'})}),"\n",(0,t.jsx)(s.h3,{id:"manifest-fields",children:"Manifest Fields"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Field"}),(0,t.jsx)(s.th,{children:"Type"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"version"})}),(0,t.jsx)(s.td,{children:"string"}),(0,t.jsx)(s.td,{children:"Manifest format version"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"backup_id"})}),(0,t.jsx)(s.td,{children:"string"}),(0,t.jsx)(s.td,{children:"Unique backup identifier"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"created_at"})}),(0,t.jsx)(s.td,{children:"string"}),(0,t.jsx)(s.td,{children:"ISO 8601 timestamp when backup started"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"completed_at"})}),(0,t.jsx)(s.td,{children:"string"}),(0,t.jsx)(s.td,{children:"ISO 8601 timestamp when backup completed"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"source_cluster.cluster_id"})}),(0,t.jsx)(s.td,{children:"string"}),(0,t.jsx)(s.td,{children:"Source cluster identifier"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"source_cluster.bootstrap_servers"})}),(0,t.jsx)(s.td,{children:"array"}),(0,t.jsx)(s.td,{children:"Source broker addresses"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"compression.algorithm"})}),(0,t.jsx)(s.td,{children:"string"}),(0,t.jsx)(s.td,{children:"Compression algorithm used"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"compression.level"})}),(0,t.jsx)(s.td,{children:"int"}),(0,t.jsx)(s.td,{children:"Compression level"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"statistics.topics"})}),(0,t.jsx)(s.td,{children:"int"}),(0,t.jsx)(s.td,{children:"Number of topics backed up"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"statistics.partitions"})}),(0,t.jsx)(s.td,{children:"int"}),(0,t.jsx)(s.td,{children:"Number of partitions"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"statistics.segments"})}),(0,t.jsx)(s.td,{children:"int"}),(0,t.jsx)(s.td,{children:"Number of segment files"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"statistics.records"})}),(0,t.jsx)(s.td,{children:"int"}),(0,t.jsx)(s.td,{children:"Total records"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"statistics.uncompressed_bytes"})}),(0,t.jsx)(s.td,{children:"int"}),(0,t.jsx)(s.td,{children:"Original data size"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"statistics.compressed_bytes"})}),(0,t.jsx)(s.td,{children:"int"}),(0,t.jsx)(s.td,{children:"Compressed data size"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"time_range.earliest_timestamp"})}),(0,t.jsx)(s.td,{children:"int"}),(0,t.jsx)(s.td,{children:"Earliest message timestamp (Unix ms)"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"time_range.latest_timestamp"})}),(0,t.jsx)(s.td,{children:"int"}),(0,t.jsx)(s.td,{children:"Latest message timestamp (Unix ms)"})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"segment-files",children:"Segment Files"}),"\n",(0,t.jsxs)(s.p,{children:["Segment files (",(0,t.jsx)(s.code,{children:".kbs"})," - Kafka Backup Segment) contain the actual message data."]}),"\n",(0,t.jsx)(s.h3,{id:"segment-file-format",children:"Segment File Format"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502           Segment Header (32 bytes)      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502              Record Batch 1              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502              Record Batch 2              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                   ...                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502              Record Batch N              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502           Segment Footer (16 bytes)      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(s.h3,{id:"segment-header",children:"Segment Header"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Offset"}),(0,t.jsx)(s.th,{children:"Size"}),(0,t.jsx)(s.th,{children:"Field"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"0"}),(0,t.jsx)(s.td,{children:"4"}),(0,t.jsx)(s.td,{children:"Magic"}),(0,t.jsxs)(s.td,{children:["Magic bytes: ",(0,t.jsx)(s.code,{children:"KBS1"})]})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"4"}),(0,t.jsx)(s.td,{children:"1"}),(0,t.jsx)(s.td,{children:"Version"}),(0,t.jsx)(s.td,{children:"Format version"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"5"}),(0,t.jsx)(s.td,{children:"1"}),(0,t.jsx)(s.td,{children:"Compression"}),(0,t.jsx)(s.td,{children:"Compression algorithm (0=none, 1=lz4, 2=zstd)"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"6"}),(0,t.jsx)(s.td,{children:"2"}),(0,t.jsx)(s.td,{children:"Flags"}),(0,t.jsx)(s.td,{children:"Reserved flags"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"8"}),(0,t.jsx)(s.td,{children:"8"}),(0,t.jsx)(s.td,{children:"First Offset"}),(0,t.jsx)(s.td,{children:"First record offset in segment"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"16"}),(0,t.jsx)(s.td,{children:"8"}),(0,t.jsx)(s.td,{children:"Record Count"}),(0,t.jsx)(s.td,{children:"Number of records in segment"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"24"}),(0,t.jsx)(s.td,{children:"8"}),(0,t.jsx)(s.td,{children:"Checksum"}),(0,t.jsx)(s.td,{children:"CRC64 checksum of segment data"})]})]})]}),"\n",(0,t.jsx)(s.h3,{id:"record-batch",children:"Record Batch"}),"\n",(0,t.jsx)(s.p,{children:"Each record batch contains:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         Batch Header (24 bytes)          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502           Compressed Records             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(s.h4,{id:"batch-header",children:"Batch Header"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Offset"}),(0,t.jsx)(s.th,{children:"Size"}),(0,t.jsx)(s.th,{children:"Field"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"0"}),(0,t.jsx)(s.td,{children:"8"}),(0,t.jsx)(s.td,{children:"Base Offset"}),(0,t.jsx)(s.td,{children:"First offset in batch"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"8"}),(0,t.jsx)(s.td,{children:"4"}),(0,t.jsx)(s.td,{children:"Record Count"}),(0,t.jsx)(s.td,{children:"Number of records"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"12"}),(0,t.jsx)(s.td,{children:"4"}),(0,t.jsx)(s.td,{children:"Compressed Size"}),(0,t.jsx)(s.td,{children:"Size of compressed data"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"16"}),(0,t.jsx)(s.td,{children:"4"}),(0,t.jsx)(s.td,{children:"Uncompressed Size"}),(0,t.jsx)(s.td,{children:"Original data size"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"20"}),(0,t.jsx)(s.td,{children:"4"}),(0,t.jsx)(s.td,{children:"CRC32"}),(0,t.jsx)(s.td,{children:"Checksum of compressed data"})]})]})]}),"\n",(0,t.jsx)(s.h3,{id:"record-format",children:"Record Format"}),"\n",(0,t.jsx)(s.p,{children:"Records are stored in a compact binary format compatible with Kafka's record format:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 Offset Delta (varint)                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Timestamp Delta (varint)                 \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Key Length (varint)                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Key Data (bytes)                         \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Value Length (varint)                    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Value Data (bytes)                       \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Headers Count (varint)                   \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 Headers (key-value pairs)                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(s.h4,{id:"offset-header",children:"Offset Header"}),"\n",(0,t.jsxs)(s.p,{children:["When ",(0,t.jsx)(s.code,{children:"include_offset_headers: true"})," is set, each record includes a header:"]}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Header Key"}),(0,t.jsx)(s.th,{children:"Value"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"x-kafka-backup-offset"})}),(0,t.jsx)(s.td,{children:"string"}),(0,t.jsx)(s.td,{children:"Original Kafka offset"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"x-kafka-backup-timestamp"})}),(0,t.jsx)(s.td,{children:"string"}),(0,t.jsx)(s.td,{children:"Original timestamp (Unix ms)"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"x-kafka-backup-partition"})}),(0,t.jsx)(s.td,{children:"string"}),(0,t.jsx)(s.td,{children:"Original partition number"})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"checkpoint-file",children:"Checkpoint File"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"checkpoint.json"})," file tracks backup progress for resumable operations:"]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n  "backup_id": "production-backup-001",\n  "timestamp": "2024-12-03T10:05:00Z",\n  "topics": {\n    "orders": {\n      "0": {\n        "offset": 75234,\n        "timestamp": 1701432000000,\n        "segment": "segment-00000005.kbs",\n        "segment_offset": 12456\n      },\n      "1": {\n        "offset": 74123,\n        "timestamp": 1701432000000,\n        "segment": "segment-00000005.kbs",\n        "segment_offset": 11234\n      }\n    }\n  }\n}\n'})}),"\n",(0,t.jsx)(s.h3,{id:"checkpoint-fields",children:"Checkpoint Fields"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Field"}),(0,t.jsx)(s.th,{children:"Description"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"backup_id"})}),(0,t.jsx)(s.td,{children:"Backup being checkpointed"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"timestamp"})}),(0,t.jsx)(s.td,{children:"When checkpoint was created"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"topics.<topic>.<partition>.offset"})}),(0,t.jsx)(s.td,{children:"Last backed up offset"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"topics.<topic>.<partition>.timestamp"})}),(0,t.jsx)(s.td,{children:"Last message timestamp"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"topics.<topic>.<partition>.segment"})}),(0,t.jsx)(s.td,{children:"Current segment file"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"topics.<topic>.<partition>.segment_offset"})}),(0,t.jsx)(s.td,{children:"Position in segment"})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"s3-object-layout",children:"S3 Object Layout"}),"\n",(0,t.jsx)(s.p,{children:"When using S3 storage, the structure maps to object keys:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{children:"s3://bucket/prefix/\n\u251c\u2500\u2500 backup-001/\n\u2502   \u251c\u2500\u2500 manifest.json\n\u2502   \u251c\u2500\u2500 topics/orders/0/segment-00000000.kbs\n\u2502   \u251c\u2500\u2500 topics/orders/0/segment-00000001.kbs\n\u2502   \u251c\u2500\u2500 topics/orders/1/segment-00000000.kbs\n\u2502   \u2514\u2500\u2500 ...\n\u2514\u2500\u2500 backup-002/\n    \u2514\u2500\u2500 ...\n"})}),"\n",(0,t.jsx)(s.h3,{id:"s3-storage-classes",children:"S3 Storage Classes"}),"\n",(0,t.jsx)(s.p,{children:"Backups can be stored in different S3 storage classes for cost optimization:"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Storage Class"}),(0,t.jsx)(s.th,{children:"Use Case"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"STANDARD"})}),(0,t.jsx)(s.td,{children:"Frequently accessed backups"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"STANDARD_IA"})}),(0,t.jsx)(s.td,{children:"Infrequent access (30+ days)"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"GLACIER_IR"})}),(0,t.jsx)(s.td,{children:"Archive with instant retrieval"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:(0,t.jsx)(s.code,{children:"GLACIER"})}),(0,t.jsx)(s.td,{children:"Long-term archive"})]})]})]}),"\n",(0,t.jsx)(s.h2,{id:"compression",children:"Compression"}),"\n",(0,t.jsx)(s.h3,{id:"zstandard-zstd",children:"Zstandard (zstd)"}),"\n",(0,t.jsx)(s.p,{children:"Default compression algorithm. Provides excellent compression ratio with fast decompression."}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Level"}),(0,t.jsx)(s.th,{children:"Ratio"}),(0,t.jsx)(s.th,{children:"Speed"}),(0,t.jsx)(s.th,{children:"Use Case"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"1-3"}),(0,t.jsx)(s.td,{children:"Good"}),(0,t.jsx)(s.td,{children:"Very Fast"}),(0,t.jsx)(s.td,{children:"Default, balanced"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"4-9"}),(0,t.jsx)(s.td,{children:"Better"}),(0,t.jsx)(s.td,{children:"Fast"}),(0,t.jsx)(s.td,{children:"Higher compression"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"10-19"}),(0,t.jsx)(s.td,{children:"Best"}),(0,t.jsx)(s.td,{children:"Moderate"}),(0,t.jsx)(s.td,{children:"Maximum compression"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"20-22"}),(0,t.jsx)(s.td,{children:"Optimal"}),(0,t.jsx)(s.td,{children:"Slow"}),(0,t.jsx)(s.td,{children:"Archive"})]})]})]}),"\n",(0,t.jsx)(s.h3,{id:"lz4",children:"LZ4"}),"\n",(0,t.jsx)(s.p,{children:"Extremely fast compression with moderate ratio."}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Mode"}),(0,t.jsx)(s.th,{children:"Ratio"}),(0,t.jsx)(s.th,{children:"Speed"}),(0,t.jsx)(s.th,{children:"Use Case"})]})}),(0,t.jsx)(s.tbody,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"Default"}),(0,t.jsx)(s.td,{children:"Moderate"}),(0,t.jsx)(s.td,{children:"Fastest"}),(0,t.jsx)(s.td,{children:"High-throughput backups"})]})})]}),"\n",(0,t.jsx)(s.h3,{id:"no-compression",children:"No Compression"}),"\n",(0,t.jsxs)(s.p,{children:["Use ",(0,t.jsx)(s.code,{children:"compression: none"})," when:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Data is already compressed"}),"\n",(0,t.jsx)(s.li,{children:"Maximum restore speed is critical"}),"\n",(0,t.jsx)(s.li,{children:"Storage cost is not a concern"}),"\n"]}),"\n",(0,t.jsx)(s.h2,{id:"integrity-verification",children:"Integrity Verification"}),"\n",(0,t.jsx)(s.h3,{id:"checksums",children:"Checksums"}),"\n",(0,t.jsx)(s.p,{children:"Every segment includes:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Segment checksum"}),": CRC64 of entire segment"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Batch checksum"}),": CRC32 of each record batch"]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Record checksum"}),": Optional per-record verification"]}),"\n"]}),"\n",(0,t.jsx)(s.h3,{id:"validation",children:"Validation"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-bash",children:"# Quick validation (check metadata and structure)\nkafka-backup validate --path /data --backup-id backup-001\n\n# Deep validation (read and verify all data)\nkafka-backup validate --path /data --backup-id backup-001 --deep\n"})}),"\n",(0,t.jsx)(s.h2,{id:"compatibility",children:"Compatibility"}),"\n",(0,t.jsx)(s.h3,{id:"forward-compatibility",children:"Forward Compatibility"}),"\n",(0,t.jsx)(s.p,{children:"New versions can read backups created by older versions."}),"\n",(0,t.jsx)(s.h3,{id:"backward-compatibility",children:"Backward Compatibility"}),"\n",(0,t.jsx)(s.p,{children:"Older versions may not read backups created by newer versions if the manifest version is higher."}),"\n",(0,t.jsx)(s.h3,{id:"version-matrix",children:"Version Matrix"}),"\n",(0,t.jsxs)(s.table,{children:[(0,t.jsx)(s.thead,{children:(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.th,{children:"Backup Version"}),(0,t.jsx)(s.th,{children:"Reader Version"}),(0,t.jsx)(s.th,{children:"Compatible"})]})}),(0,t.jsxs)(s.tbody,{children:[(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"1.0"}),(0,t.jsx)(s.td,{children:"1.0+"}),(0,t.jsx)(s.td,{children:"Yes"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"1.1"}),(0,t.jsx)(s.td,{children:"1.0"}),(0,t.jsx)(s.td,{children:"Limited*"})]}),(0,t.jsxs)(s.tr,{children:[(0,t.jsx)(s.td,{children:"1.1"}),(0,t.jsx)(s.td,{children:"1.1+"}),(0,t.jsx)(s.td,{children:"Yes"})]})]})]}),"\n",(0,t.jsx)(s.p,{children:"*Limited: Core data readable, new features unavailable"})]})}function o(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>d,x:()=>c});var r=n(6540);const t={},i=r.createContext(t);function d(e){const s=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);