"use strict";(globalThis.webpackChunkkafka_backup_docs=globalThis.webpackChunkkafka_backup_docs||[]).push([[7862],{8453:(e,n,a)=>{a.d(n,{R:()=>r,x:()=>o});var t=a(6540);const i={},s=t.createContext(i);function r(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(s.Provider,{value:n},e.children)}},9333:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>c});const t=JSON.parse('{"id":"operator/guides/gitops","title":"GitOps","description":"Manage Kafka backups using GitOps workflows","source":"@site/docs/operator/guides/gitops.md","sourceDirName":"operator/guides","slug":"/operator/guides/gitops","permalink":"/operator/guides/gitops","draft":false,"unlisted":false,"editUrl":"https://github.com/osodevops/kafka-backup-docs/tree/main/docs/docs/operator/guides/gitops.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"GitOps","description":"Manage Kafka backups using GitOps workflows","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Scheduled Backups","permalink":"/operator/guides/scheduled-backups"},"next":{"title":"Secrets","permalink":"/operator/guides/secrets"}}');var i=a(4848),s=a(8453);const r={title:"GitOps",description:"Manage Kafka backups using GitOps workflows",sidebar_position:2},o="GitOps Integration",l={},c=[{value:"GitOps Benefits",id:"gitops-benefits",level:2},{value:"Repository Structure",id:"repository-structure",level:2},{value:"Recommended Layout",id:"recommended-layout",level:3},{value:"Base Configuration",id:"base-configuration",level:3},{value:"Environment Overlays",id:"environment-overlays",level:3},{value:"ArgoCD Integration",id:"argocd-integration",level:2},{value:"Application Definition",id:"application-definition",level:3},{value:"ApplicationSet for Multiple Environments",id:"applicationset-for-multiple-environments",level:3},{value:"Flux Integration",id:"flux-integration",level:2},{value:"GitRepository",id:"gitrepository",level:3},{value:"Kustomization",id:"kustomization",level:3},{value:"Secret Management",id:"secret-management",level:2},{value:"Sealed Secrets",id:"sealed-secrets",level:3},{value:"External Secrets Operator",id:"external-secrets-operator",level:3},{value:"SOPS Encryption",id:"sops-encryption",level:3},{value:"Environment Configuration",id:"environment-configuration",level:2},{value:"Development",id:"development",level:3},{value:"Production",id:"production",level:3},{value:"PR Workflow",id:"pr-workflow",level:2},{value:"Pull Request Template",id:"pull-request-template",level:3},{value:"GitHub Actions Validation",id:"github-actions-validation",level:3},{value:"Change Management",id:"change-management",level:2},{value:"Promoting Changes",id:"promoting-changes",level:3},{value:"Rollback",id:"rollback",level:3},{value:"Monitoring GitOps",id:"monitoring-gitops",level:2},{value:"ArgoCD Metrics",id:"argocd-metrics",level:3},{value:"Flux Notifications",id:"flux-notifications",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"gitops-integration",children:"GitOps Integration"})}),"\n",(0,i.jsx)(n.p,{children:"Manage your Kafka backup configurations using GitOps principles with tools like ArgoCD, Flux, or similar."}),"\n",(0,i.jsx)(n.h2,{id:"gitops-benefits",children:"GitOps Benefits"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Version controlled"})," - Track all changes to backup configurations"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Auditable"})," - Know who changed what and when"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Reproducible"})," - Same configuration across environments"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Declarative"})," - Desired state in Git"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Automated"})," - Changes automatically applied"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"repository-structure",children:"Repository Structure"}),"\n",(0,i.jsx)(n.h3,{id:"recommended-layout",children:"Recommended Layout"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"kafka-backup-gitops/\n\u251c\u2500\u2500 base/\n\u2502   \u251c\u2500\u2500 kustomization.yaml\n\u2502   \u251c\u2500\u2500 namespace.yaml\n\u2502   \u2514\u2500\u2500 operator/\n\u2502       \u2514\u2500\u2500 kustomization.yaml\n\u251c\u2500\u2500 overlays/\n\u2502   \u251c\u2500\u2500 dev/\n\u2502   \u2502   \u251c\u2500\u2500 kustomization.yaml\n\u2502   \u2502   \u251c\u2500\u2500 kafka-backup.yaml\n\u2502   \u2502   \u2514\u2500\u2500 secrets.yaml\n\u2502   \u251c\u2500\u2500 staging/\n\u2502   \u2502   \u251c\u2500\u2500 kustomization.yaml\n\u2502   \u2502   \u251c\u2500\u2500 kafka-backup.yaml\n\u2502   \u2502   \u2514\u2500\u2500 secrets.yaml\n\u2502   \u2514\u2500\u2500 production/\n\u2502       \u251c\u2500\u2500 kustomization.yaml\n\u2502       \u251c\u2500\u2500 kafka-backup.yaml\n\u2502       \u2514\u2500\u2500 secrets.yaml\n\u2514\u2500\u2500 README.md\n"})}),"\n",(0,i.jsx)(n.h3,{id:"base-configuration",children:"Base Configuration"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="base/kustomization.yaml"',children:"apiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\n\nresources:\n  - namespace.yaml\n  - operator/\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="base/namespace.yaml"',children:"apiVersion: v1\nkind: Namespace\nmetadata:\n  name: kafka-backup\n"})}),"\n",(0,i.jsx)(n.h3,{id:"environment-overlays",children:"Environment Overlays"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="overlays/production/kustomization.yaml"',children:"apiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\n\nnamespace: kafka-backup\n\nresources:\n  - ../../base\n  - kafka-backup.yaml\n\nsecretGenerator:\n  - name: kafka-credentials\n    files:\n      - username=secrets/kafka-username.txt\n      - password=secrets/kafka-password.txt\n\nconfigMapGenerator:\n  - name: backup-config\n    literals:\n      - ENVIRONMENT=production\n"})}),"\n",(0,i.jsx)(n.h2,{id:"argocd-integration",children:"ArgoCD Integration"}),"\n",(0,i.jsx)(n.h3,{id:"application-definition",children:"Application Definition"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="argocd/kafka-backup-app.yaml"',children:"apiVersion: argoproj.io/v1alpha1\nkind: Application\nmetadata:\n  name: kafka-backup-production\n  namespace: argocd\nspec:\n  project: default\n\n  source:\n    repoURL: https://github.com/myorg/kafka-backup-gitops.git\n    targetRevision: main\n    path: overlays/production\n\n  destination:\n    server: https://kubernetes.default.svc\n    namespace: kafka-backup\n\n  syncPolicy:\n    automated:\n      prune: true\n      selfHeal: true\n    syncOptions:\n      - CreateNamespace=true\n"})}),"\n",(0,i.jsx)(n.h3,{id:"applicationset-for-multiple-environments",children:"ApplicationSet for Multiple Environments"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="argocd/kafka-backup-appset.yaml"',children:"apiVersion: argoproj.io/v1alpha1\nkind: ApplicationSet\nmetadata:\n  name: kafka-backup\n  namespace: argocd\nspec:\n  generators:\n    - list:\n        elements:\n          - environment: dev\n            cluster: dev-cluster\n          - environment: staging\n            cluster: staging-cluster\n          - environment: production\n            cluster: production-cluster\n\n  template:\n    metadata:\n      name: 'kafka-backup-{{environment}}'\n    spec:\n      project: default\n      source:\n        repoURL: https://github.com/myorg/kafka-backup-gitops.git\n        targetRevision: main\n        path: 'overlays/{{environment}}'\n      destination:\n        server: '{{cluster}}'\n        namespace: kafka-backup\n      syncPolicy:\n        automated:\n          prune: true\n          selfHeal: true\n"})}),"\n",(0,i.jsx)(n.h2,{id:"flux-integration",children:"Flux Integration"}),"\n",(0,i.jsx)(n.h3,{id:"gitrepository",children:"GitRepository"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="flux/git-repo.yaml"',children:"apiVersion: source.toolkit.fluxcd.io/v1\nkind: GitRepository\nmetadata:\n  name: kafka-backup\n  namespace: flux-system\nspec:\n  interval: 1m\n  url: https://github.com/myorg/kafka-backup-gitops.git\n  ref:\n    branch: main\n  secretRef:\n    name: github-credentials\n"})}),"\n",(0,i.jsx)(n.h3,{id:"kustomization",children:"Kustomization"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="flux/kustomization.yaml"',children:"apiVersion: kustomize.toolkit.fluxcd.io/v1\nkind: Kustomization\nmetadata:\n  name: kafka-backup-production\n  namespace: flux-system\nspec:\n  interval: 10m\n  path: ./overlays/production\n  prune: true\n  sourceRef:\n    kind: GitRepository\n    name: kafka-backup\n  healthChecks:\n    - apiVersion: kafka.oso.sh/v1alpha1\n      kind: KafkaBackup\n      name: production-backup\n      namespace: kafka-backup\n"})}),"\n",(0,i.jsx)(n.h2,{id:"secret-management",children:"Secret Management"}),"\n",(0,i.jsx)(n.h3,{id:"sealed-secrets",children:"Sealed Secrets"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="overlays/production/sealed-secrets.yaml"',children:"apiVersion: bitnami.com/v1alpha1\nkind: SealedSecret\nmetadata:\n  name: kafka-credentials\n  namespace: kafka-backup\nspec:\n  encryptedData:\n    username: AgBy8hCi...  # Encrypted\n    password: AgDk4kLm...  # Encrypted\n  template:\n    metadata:\n      name: kafka-credentials\n"})}),"\n",(0,i.jsx)(n.p,{children:"Create sealed secret:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"kubeseal --format yaml < secret.yaml > sealed-secret.yaml\n"})}),"\n",(0,i.jsx)(n.h3,{id:"external-secrets-operator",children:"External Secrets Operator"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="overlays/production/external-secret.yaml"',children:"apiVersion: external-secrets.io/v1beta1\nkind: ExternalSecret\nmetadata:\n  name: kafka-credentials\n  namespace: kafka-backup\nspec:\n  refreshInterval: 1h\n  secretStoreRef:\n    name: vault-backend\n    kind: ClusterSecretStore\n  target:\n    name: kafka-credentials\n  data:\n    - secretKey: username\n      remoteRef:\n        key: kafka/production\n        property: username\n    - secretKey: password\n      remoteRef:\n        key: kafka/production\n        property: password\n"})}),"\n",(0,i.jsx)(n.h3,{id:"sops-encryption",children:"SOPS Encryption"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="overlays/production/secrets.enc.yaml"',children:"apiVersion: v1\nkind: Secret\nmetadata:\n  name: kafka-credentials\ntype: Opaque\nstringData:\n  username: ENC[AES256_GCM,data:...,type:str]\n  password: ENC[AES256_GCM,data:...,type:str]\nsops:\n  kms:\n    - arn: arn:aws:kms:us-west-2:123456789:key/abc123\n  version: 3.7.3\n"})}),"\n",(0,i.jsx)(n.p,{children:"Configure Flux for SOPS:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: kustomize.toolkit.fluxcd.io/v1\nkind: Kustomization\nmetadata:\n  name: kafka-backup-production\nspec:\n  decryption:\n    provider: sops\n    secretRef:\n      name: sops-gpg\n"})}),"\n",(0,i.jsx)(n.h2,{id:"environment-configuration",children:"Environment Configuration"}),"\n",(0,i.jsx)(n.h3,{id:"development",children:"Development"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="overlays/dev/kafka-backup.yaml"',children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaBackup\nmetadata:\n  name: dev-backup\nspec:\n  schedule: "0 */4 * * *"  # Every 4 hours\n\n  kafkaCluster:\n    bootstrapServers:\n      - kafka.dev.svc:9092\n\n  topics:\n    - "*"\n\n  storage:\n    storageType: s3\n    s3:\n      bucket: kafka-backups-dev\n      region: us-west-2\n      prefix: dev\n\n  compression: lz4  # Fast\n  retention:\n    backups: 24  # 4 days\n'})}),"\n",(0,i.jsx)(n.h3,{id:"production",children:"Production"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title="overlays/production/kafka-backup.yaml"',children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaBackup\nmetadata:\n  name: production-backup\nspec:\n  schedule: "0 * * * *"  # Hourly\n\n  kafkaCluster:\n    bootstrapServers:\n      - kafka-0.kafka.svc:9092\n      - kafka-1.kafka.svc:9092\n      - kafka-2.kafka.svc:9092\n    securityProtocol: SASL_SSL\n    saslSecret:\n      name: kafka-credentials\n      mechanism: SCRAM-SHA-256\n    tlsSecret:\n      name: kafka-tls\n\n  topics:\n    - "*"\n  excludeTopics:\n    - "__*"\n\n  storage:\n    storageType: s3\n    s3:\n      bucket: kafka-backups-production\n      region: us-west-2\n      prefix: production/hourly\n\n  compression: zstd\n  compressionLevel: 3\n  includeOffsetHeaders: true\n  sourceClusterId: "production"\n\n  retention:\n    backups: 168  # 7 days\n\n  resources:\n    requests:\n      cpu: 500m\n      memory: 1Gi\n    limits:\n      cpu: 2\n      memory: 4Gi\n'})}),"\n",(0,i.jsx)(n.h2,{id:"pr-workflow",children:"PR Workflow"}),"\n",(0,i.jsx)(n.h3,{id:"pull-request-template",children:"Pull Request Template"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-markdown",metastring:'title=".github/pull_request_template.md"',children:"## Kafka Backup Change\n\n### Type of Change\n- [ ] New backup configuration\n- [ ] Schedule change\n- [ ] Topic change\n- [ ] Storage configuration change\n- [ ] Other\n\n### Description\n\n\n### Checklist\n- [ ] Tested in dev environment\n- [ ] Retention policy reviewed\n- [ ] Storage costs estimated\n- [ ] Security reviewed (no plain text secrets)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"github-actions-validation",children:"GitHub Actions Validation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'title=".github/workflows/validate.yaml"',children:'name: Validate Kafka Backup Config\n\non:\n  pull_request:\n    paths:\n      - \'overlays/**\'\n\njobs:\n  validate:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Setup Kustomize\n        uses: imranismail/setup-kustomize@v2\n\n      - name: Validate Kustomize\n        run: |\n          for dir in overlays/*/; do\n            echo "Validating $dir"\n            kustomize build "$dir" > /dev/null\n          done\n\n      - name: Validate CRDs\n        run: |\n          # Install kubeconform\n          wget https://github.com/yannh/kubeconform/releases/latest/download/kubeconform-linux-amd64.tar.gz\n          tar xf kubeconform-linux-amd64.tar.gz\n\n          for dir in overlays/*/; do\n            echo "Validating CRDs in $dir"\n            kustomize build "$dir" | ./kubeconform -strict\n          done\n'})}),"\n",(0,i.jsx)(n.h2,{id:"change-management",children:"Change Management"}),"\n",(0,i.jsx)(n.h3,{id:"promoting-changes",children:"Promoting Changes"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Dev -> Staging\ngit checkout staging\ngit merge dev\ngit push\n\n# Staging -> Production (after validation)\ngit checkout main\ngit merge staging\ngit tag release-$(date +%Y%m%d)\ngit push --tags\n"})}),"\n",(0,i.jsx)(n.h3,{id:"rollback",children:"Rollback"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# ArgoCD\nargocd app rollback kafka-backup-production\n\n# Flux\nflux suspend kustomization kafka-backup-production\ngit revert HEAD\ngit push\nflux resume kustomization kafka-backup-production\n\n# Or simply\ngit revert HEAD\ngit push\n"})}),"\n",(0,i.jsx)(n.h2,{id:"monitoring-gitops",children:"Monitoring GitOps"}),"\n",(0,i.jsx)(n.h3,{id:"argocd-metrics",children:"ArgoCD Metrics"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# Alert on sync failures\n- alert: ArgoCDSyncFailed\n  expr: argocd_app_info{sync_status!="Synced"} == 1\n  for: 5m\n  labels:\n    severity: warning\n'})}),"\n",(0,i.jsx)(n.h3,{id:"flux-notifications",children:"Flux Notifications"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"apiVersion: notification.toolkit.fluxcd.io/v1beta2\nkind: Alert\nmetadata:\n  name: kafka-backup-alerts\n  namespace: flux-system\nspec:\n  providerRef:\n    name: slack\n  eventSeverity: error\n  eventSources:\n    - kind: Kustomization\n      name: kafka-backup-production\n"})}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Never commit plain text secrets"})," - Use sealed secrets, external secrets, or SOPS"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Use environment overlays"})," - Different configs for dev/staging/production"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Review all changes"})," - Require PR reviews for production changes"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Automated validation"})," - CI pipeline validates configs"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Gradual rollout"})," - Test in dev before production"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Document changes"})," - Clear commit messages and PR descriptions"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Tag releases"})," - Version your production deployments"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./secrets",children:"Secrets Guide"})," - Secure credential management"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"./scheduled-backups",children:"Scheduled Backups"})," - Backup scheduling"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"../installation",children:"Installation"})," - Operator setup"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);