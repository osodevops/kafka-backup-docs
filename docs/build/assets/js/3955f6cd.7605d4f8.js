"use strict";(globalThis.webpackChunkkafka_backup_docs=globalThis.webpackChunkkafka_backup_docs||[]).push([[6884],{4874:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>o,contentTitle:()=>t,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"operator/installation","title":"Installation","description":"Install the OSO Kafka Backup Operator","source":"@site/docs/operator/installation.md","sourceDirName":"operator","slug":"/operator/installation","permalink":"/operator/installation","draft":false,"unlisted":false,"editUrl":"https://github.com/osodevops/kafka-backup-docs/tree/main/docs/docs/operator/installation.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"title":"Installation","description":"Install the OSO Kafka Backup Operator","sidebar_position":2},"sidebar":"docsSidebar","previous":{"title":"Operator Overview","permalink":"/operator/"},"next":{"title":"Configuration","permalink":"/operator/configuration"}}');var l=n(4848),r=n(8453);const i={title:"Installation",description:"Install the OSO Kafka Backup Operator",sidebar_position:2},t="Installation",o={},c=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Helm Installation",id:"helm-installation",level:2},{value:"Add Helm Repository",id:"add-helm-repository",level:3},{value:"Install Operator",id:"install-operator",level:3},{value:"Verify Installation",id:"verify-installation",level:3},{value:"Installation Options",id:"installation-options",level:2},{value:"Custom Values",id:"custom-values",level:3},{value:"Values File",id:"values-file",level:3},{value:"Install Specific Version",id:"install-specific-version",level:3},{value:"CRD Installation",id:"crd-installation",level:2},{value:"Default (with Helm)",id:"default-with-helm",level:3},{value:"CRDs Only",id:"crds-only",level:3},{value:"Keep CRDs on Uninstall",id:"keep-crds-on-uninstall",level:3},{value:"RBAC Configuration",id:"rbac-configuration",level:2},{value:"Default Service Account",id:"default-service-account",level:3},{value:"Required Permissions",id:"required-permissions",level:3},{value:"Custom Service Account",id:"custom-service-account",level:3},{value:"Cloud Provider Setup",id:"cloud-provider-setup",level:2},{value:"AWS (EKS)",id:"aws-eks",level:3},{value:"IAM Role for Service Account (IRSA)",id:"iam-role-for-service-account-irsa",level:4},{value:"Helm Values for IRSA",id:"helm-values-for-irsa",level:4},{value:"Azure (AKS)",id:"azure-aks",level:3},{value:"Workload Identity",id:"workload-identity",level:4},{value:"GCP (GKE)",id:"gcp-gke",level:3},{value:"Workload Identity",id:"workload-identity-1",level:4},{value:"High Availability",id:"high-availability",level:2},{value:"Multiple Replicas",id:"multiple-replicas",level:3},{value:"Pod Disruption Budget",id:"pod-disruption-budget",level:3},{value:"Affinity Rules",id:"affinity-rules",level:3},{value:"Upgrade",id:"upgrade",level:2},{value:"Helm Upgrade",id:"helm-upgrade",level:3},{value:"CRD Updates",id:"crd-updates",level:3},{value:"Uninstall",id:"uninstall",level:2},{value:"Helm Uninstall",id:"helm-uninstall",level:3},{value:"Clean Up CRDs",id:"clean-up-crds",level:3},{value:"Clean Up Namespace",id:"clean-up-namespace",level:3},{value:"Troubleshooting Installation",id:"troubleshooting-installation",level:2},{value:"Operator Not Starting",id:"operator-not-starting",level:3},{value:"CRDs Not Found",id:"crds-not-found",level:3},{value:"Permission Denied",id:"permission-denied",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const a={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(a.header,{children:(0,l.jsx)(a.h1,{id:"installation",children:"Installation"})}),"\n",(0,l.jsx)(a.p,{children:"Install the OSO Kafka Backup Operator in your Kubernetes cluster."}),"\n",(0,l.jsx)(a.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,l.jsxs)(a.ul,{children:["\n",(0,l.jsx)(a.li,{children:"Kubernetes 1.20+"}),"\n",(0,l.jsx)(a.li,{children:"Helm 3.0+"}),"\n",(0,l.jsx)(a.li,{children:"kubectl configured to access your cluster"}),"\n",(0,l.jsx)(a.li,{children:"Cluster admin permissions"}),"\n"]}),"\n",(0,l.jsx)(a.h2,{id:"helm-installation",children:"Helm Installation"}),"\n",(0,l.jsx)(a.h3,{id:"add-helm-repository",children:"Add Helm Repository"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"helm repo add oso https://charts.oso.sh\nhelm repo update\n"})}),"\n",(0,l.jsx)(a.h3,{id:"install-operator",children:"Install Operator"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Create namespace\nkubectl create namespace kafka-backup\n\n# Install with default values\nhelm install kafka-backup-operator oso/kafka-backup-operator \\\n  --namespace kafka-backup\n"})}),"\n",(0,l.jsx)(a.h3,{id:"verify-installation",children:"Verify Installation"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Check operator pod\nkubectl get pods -n kafka-backup\n\n# Check CRDs installed\nkubectl get crds | grep kafka.oso.sh\n\n# Expected output:\n# kafkabackups.kafka.oso.sh\n# kafkarestores.kafka.oso.sh\n# kafkaoffsetresets.kafka.oso.sh\n# kafkaoffsetrollbacks.kafka.oso.sh\n"})}),"\n",(0,l.jsx)(a.h2,{id:"installation-options",children:"Installation Options"}),"\n",(0,l.jsx)(a.h3,{id:"custom-values",children:"Custom Values"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"helm install kafka-backup-operator oso/kafka-backup-operator \\\n  --namespace kafka-backup \\\n  --set replicaCount=2 \\\n  --set resources.requests.memory=256Mi \\\n  --set metrics.enabled=true\n"})}),"\n",(0,l.jsx)(a.h3,{id:"values-file",children:"Values File"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-yaml",metastring:'title="values.yaml"',children:'replicaCount: 2\n\nimage:\n  repository: osodevops/kafka-backup-operator\n  tag: "1.0.0"\n  pullPolicy: IfNotPresent\n\nresources:\n  requests:\n    cpu: 100m\n    memory: 256Mi\n  limits:\n    cpu: 500m\n    memory: 512Mi\n\nmetrics:\n  enabled: true\n  serviceMonitor:\n    enabled: true\n\npodSecurityContext:\n  runAsNonRoot: true\n  runAsUser: 1000\n  fsGroup: 1000\n'})}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"helm install kafka-backup-operator oso/kafka-backup-operator \\\n  --namespace kafka-backup \\\n  --values values.yaml\n"})}),"\n",(0,l.jsx)(a.h3,{id:"install-specific-version",children:"Install Specific Version"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"helm install kafka-backup-operator oso/kafka-backup-operator \\\n  --namespace kafka-backup \\\n  --version 0.1.0\n"})}),"\n",(0,l.jsx)(a.h2,{id:"crd-installation",children:"CRD Installation"}),"\n",(0,l.jsx)(a.h3,{id:"default-with-helm",children:"Default (with Helm)"}),"\n",(0,l.jsx)(a.p,{children:"CRDs are installed automatically by Helm."}),"\n",(0,l.jsx)(a.h3,{id:"crds-only",children:"CRDs Only"}),"\n",(0,l.jsx)(a.p,{children:"If you need to install CRDs separately (e.g., for GitOps):"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Install CRDs only\nkubectl apply -f https://raw.githubusercontent.com/osodevops/kafka-backup-operator/main/deploy/crds/\n"})}),"\n",(0,l.jsx)(a.h3,{id:"keep-crds-on-uninstall",children:"Keep CRDs on Uninstall"}),"\n",(0,l.jsx)(a.p,{children:"By default, CRDs are deleted when uninstalling. To keep them:"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-yaml",children:"crds:\n  install: true\n  keep: true  # Don't delete on uninstall\n"})}),"\n",(0,l.jsx)(a.h2,{id:"rbac-configuration",children:"RBAC Configuration"}),"\n",(0,l.jsx)(a.h3,{id:"default-service-account",children:"Default Service Account"}),"\n",(0,l.jsx)(a.p,{children:"The operator creates a service account with required permissions:"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-yaml",children:"apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: kafka-backup-operator\n  namespace: kafka-backup\n"})}),"\n",(0,l.jsx)(a.h3,{id:"required-permissions",children:"Required Permissions"}),"\n",(0,l.jsx)(a.p,{children:"The operator needs these permissions:"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-yaml",children:'apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: kafka-backup-operator\nrules:\n  # Manage CRDs\n  - apiGroups: ["kafka.oso.sh"]\n    resources: ["kafkabackups", "kafkarestores", "kafkaoffsetresets", "kafkaoffsetrollbacks"]\n    verbs: ["*"]\n  - apiGroups: ["kafka.oso.sh"]\n    resources: ["kafkabackups/status", "kafkarestores/status", "kafkaoffsetresets/status", "kafkaoffsetrollbacks/status"]\n    verbs: ["get", "patch", "update"]\n\n  # Create jobs for backups\n  - apiGroups: ["batch"]\n    resources: ["jobs", "cronjobs"]\n    verbs: ["*"]\n\n  # Read secrets\n  - apiGroups: [""]\n    resources: ["secrets"]\n    verbs: ["get", "list", "watch"]\n\n  # Manage pods (for job pods)\n  - apiGroups: [""]\n    resources: ["pods"]\n    verbs: ["get", "list", "watch"]\n\n  # Events\n  - apiGroups: [""]\n    resources: ["events"]\n    verbs: ["create", "patch"]\n'})}),"\n",(0,l.jsx)(a.h3,{id:"custom-service-account",children:"Custom Service Account"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-yaml",children:'serviceAccount:\n  create: true\n  name: "my-kafka-backup-sa"\n  annotations:\n    eks.amazonaws.com/role-arn: arn:aws:iam::123456789:role/kafka-backup-role\n'})}),"\n",(0,l.jsx)(a.h2,{id:"cloud-provider-setup",children:"Cloud Provider Setup"}),"\n",(0,l.jsx)(a.h3,{id:"aws-eks",children:"AWS (EKS)"}),"\n",(0,l.jsx)(a.h4,{id:"iam-role-for-service-account-irsa",children:"IAM Role for Service Account (IRSA)"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Create IAM policy\naws iam create-policy \\\n  --policy-name KafkaBackupPolicy \\\n  --policy-document file://policy.json\n\n# Create IAM role with OIDC\neksctl create iamserviceaccount \\\n  --name kafka-backup-operator \\\n  --namespace kafka-backup \\\n  --cluster my-cluster \\\n  --attach-policy-arn arn:aws:iam::123456789:policy/KafkaBackupPolicy \\\n  --approve\n"})}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-json",metastring:'title="policy.json"',children:'{\n  "Version": "2012-10-17",\n  "Statement": [\n    {\n      "Effect": "Allow",\n      "Action": [\n        "s3:PutObject",\n        "s3:GetObject",\n        "s3:ListBucket",\n        "s3:DeleteObject"\n      ],\n      "Resource": [\n        "arn:aws:s3:::kafka-backups",\n        "arn:aws:s3:::kafka-backups/*"\n      ]\n    }\n  ]\n}\n'})}),"\n",(0,l.jsx)(a.h4,{id:"helm-values-for-irsa",children:"Helm Values for IRSA"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-yaml",children:"serviceAccount:\n  create: false\n  name: kafka-backup-operator\n  # Service account created by eksctl\n"})}),"\n",(0,l.jsx)(a.h3,{id:"azure-aks",children:"Azure (AKS)"}),"\n",(0,l.jsx)(a.h4,{id:"workload-identity",children:"Workload Identity"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:'# Enable workload identity on AKS\naz aks update \\\n  --resource-group myResourceGroup \\\n  --name myAKSCluster \\\n  --enable-oidc-issuer \\\n  --enable-workload-identity\n\n# Create managed identity\naz identity create \\\n  --name kafka-backup-identity \\\n  --resource-group myResourceGroup\n\n# Assign role\naz role assignment create \\\n  --assignee <identity-client-id> \\\n  --role "Storage Blob Data Contributor" \\\n  --scope /subscriptions/<sub>/resourceGroups/<rg>/providers/Microsoft.Storage/storageAccounts/<account>\n'})}),"\n",(0,l.jsx)(a.h3,{id:"gcp-gke",children:"GCP (GKE)"}),"\n",(0,l.jsx)(a.h4,{id:"workload-identity-1",children:"Workload Identity"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:'# Enable workload identity on GKE\ngcloud container clusters update my-cluster \\\n  --workload-pool=PROJECT_ID.svc.id.goog\n\n# Create GCP service account\ngcloud iam service-accounts create kafka-backup-sa\n\n# Bind to Kubernetes service account\ngcloud iam service-accounts add-iam-policy-binding \\\n  kafka-backup-sa@PROJECT_ID.iam.gserviceaccount.com \\\n  --role roles/iam.workloadIdentityUser \\\n  --member "serviceAccount:PROJECT_ID.svc.id.goog[kafka-backup/kafka-backup-operator]"\n'})}),"\n",(0,l.jsx)(a.h2,{id:"high-availability",children:"High Availability"}),"\n",(0,l.jsx)(a.h3,{id:"multiple-replicas",children:"Multiple Replicas"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-yaml",children:"replicaCount: 2\n\n# Leader election is enabled by default\nleaderElection:\n  enabled: true\n  leaseDuration: 15s\n  renewDeadline: 10s\n  retryPeriod: 2s\n"})}),"\n",(0,l.jsx)(a.h3,{id:"pod-disruption-budget",children:"Pod Disruption Budget"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-yaml",children:"podDisruptionBudget:\n  enabled: true\n  minAvailable: 1\n"})}),"\n",(0,l.jsx)(a.h3,{id:"affinity-rules",children:"Affinity Rules"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-yaml",children:"affinity:\n  podAntiAffinity:\n    preferredDuringSchedulingIgnoredDuringExecution:\n      - weight: 100\n        podAffinityTerm:\n          labelSelector:\n            matchLabels:\n              app.kubernetes.io/name: kafka-backup-operator\n          topologyKey: kubernetes.io/hostname\n"})}),"\n",(0,l.jsx)(a.h2,{id:"upgrade",children:"Upgrade"}),"\n",(0,l.jsx)(a.h3,{id:"helm-upgrade",children:"Helm Upgrade"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Update repo\nhelm repo update\n\n# Upgrade operator\nhelm upgrade kafka-backup-operator oso/kafka-backup-operator \\\n  --namespace kafka-backup \\\n  --values values.yaml\n"})}),"\n",(0,l.jsx)(a.h3,{id:"crd-updates",children:"CRD Updates"}),"\n",(0,l.jsx)(a.p,{children:"CRDs are updated automatically during Helm upgrade. To update CRDs manually:"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"kubectl apply -f https://raw.githubusercontent.com/osodevops/kafka-backup-operator/main/deploy/crds/\n"})}),"\n",(0,l.jsx)(a.h2,{id:"uninstall",children:"Uninstall"}),"\n",(0,l.jsx)(a.h3,{id:"helm-uninstall",children:"Helm Uninstall"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"helm uninstall kafka-backup-operator --namespace kafka-backup\n"})}),"\n",(0,l.jsx)(a.h3,{id:"clean-up-crds",children:"Clean Up CRDs"}),"\n",(0,l.jsx)(a.p,{children:"If CRDs were not kept:"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"kubectl delete crds kafkabackups.kafka.oso.sh\nkubectl delete crds kafkarestores.kafka.oso.sh\nkubectl delete crds kafkaoffsetresets.kafka.oso.sh\nkubectl delete crds kafkaoffsetrollbacks.kafka.oso.sh\n"})}),"\n",(0,l.jsx)(a.h3,{id:"clean-up-namespace",children:"Clean Up Namespace"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"kubectl delete namespace kafka-backup\n"})}),"\n",(0,l.jsx)(a.h2,{id:"troubleshooting-installation",children:"Troubleshooting Installation"}),"\n",(0,l.jsx)(a.h3,{id:"operator-not-starting",children:"Operator Not Starting"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Check pod logs\nkubectl logs -n kafka-backup deployment/kafka-backup-operator\n\n# Check events\nkubectl get events -n kafka-backup --sort-by='.lastTimestamp'\n"})}),"\n",(0,l.jsx)(a.h3,{id:"crds-not-found",children:"CRDs Not Found"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Verify CRDs exist\nkubectl get crds | grep kafka\n\n# Reinstall CRDs\nhelm upgrade kafka-backup-operator oso/kafka-backup-operator \\\n  --namespace kafka-backup \\\n  --set crds.install=true\n"})}),"\n",(0,l.jsx)(a.h3,{id:"permission-denied",children:"Permission Denied"}),"\n",(0,l.jsx)(a.pre,{children:(0,l.jsx)(a.code,{className:"language-bash",children:"# Check RBAC\nkubectl auth can-i create kafkabackups --as=system:serviceaccount:kafka-backup:kafka-backup-operator\n\n# Check cluster role binding\nkubectl get clusterrolebinding | grep kafka-backup\n"})}),"\n",(0,l.jsx)(a.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,l.jsxs)(a.ul,{children:["\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.a,{href:"./configuration",children:"Configuration"})," - Configure operator settings"]}),"\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.a,{href:"./guides/secrets",children:"Secrets Guide"})," - Set up credentials"]}),"\n",(0,l.jsxs)(a.li,{children:[(0,l.jsx)(a.a,{href:"./crds/kafkabackup",children:"KafkaBackup CRD"})," - Create your first backup"]}),"\n"]})]})}function u(e={}){const{wrapper:a}={...(0,r.R)(),...e.components};return a?(0,l.jsx)(a,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}},8453:(e,a,n)=>{n.d(a,{R:()=>i,x:()=>t});var s=n(6540);const l={},r=s.createContext(l);function i(e){const a=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function t(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:i(e.components),s.createElement(r.Provider,{value:a},e.children)}}}]);