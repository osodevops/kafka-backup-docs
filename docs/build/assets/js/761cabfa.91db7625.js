"use strict";(globalThis.webpackChunkkafka_backup_docs=globalThis.webpackChunkkafka_backup_docs||[]).push([[7582],{872:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>i,metadata:()=>t,toc:()=>d});const t=JSON.parse('{"id":"operator/crds/kafkaoffsetreset","title":"KafkaOffsetReset","description":"KafkaOffsetReset Custom Resource Definition reference","source":"@site/docs/operator/crds/kafkaoffsetreset.md","sourceDirName":"operator/crds","slug":"/operator/crds/kafkaoffsetreset","permalink":"/operator/crds/kafkaoffsetreset","draft":false,"unlisted":false,"editUrl":"https://github.com/osodevops/kafka-backup-docs/tree/main/docs/docs/operator/crds/kafkaoffsetreset.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"KafkaOffsetReset","description":"KafkaOffsetReset Custom Resource Definition reference","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"KafkaRestore","permalink":"/operator/crds/kafkarestore"},"next":{"title":"KafkaOffsetRollback","permalink":"/operator/crds/kafkaoffsetrollback"}}');var r=n(4848),a=n(8453);const i={title:"KafkaOffsetReset",description:"KafkaOffsetReset Custom Resource Definition reference",sidebar_position:3},o="KafkaOffsetReset CRD",l={},d=[{value:"Overview",id:"overview",level:2},{value:"Full Specification",id:"full-specification",level:2},{value:"Spec Fields",id:"spec-fields",level:2},{value:"kafkaCluster",id:"kafkacluster",level:3},{value:"strategy",id:"strategy",level:3},{value:"Strategy Options",id:"strategy-options",level:3},{value:"timestamp",id:"timestamp",level:4},{value:"offset",id:"offset",level:4},{value:"headerBased",id:"headerbased",level:4},{value:"fromMapping",id:"frommapping",level:4},{value:"Status",id:"status",level:2},{value:"Examples",id:"examples",level:2},{value:"Reset to Earliest",id:"reset-to-earliest",level:3},{value:"Reset to Timestamp",id:"reset-to-timestamp",level:3},{value:"Header-Based Reset (After Restore)",id:"header-based-reset-after-restore",level:3},{value:"Bulk Reset with Parallelism",id:"bulk-reset-with-parallelism",level:3},{value:"Dry Run",id:"dry-run",level:3},{value:"From Mapping File",id:"from-mapping-file",level:3},{value:"Operations",id:"operations",level:2},{value:"Check Reset Status",id:"check-reset-status",level:3},{value:"View Reset Results",id:"view-reset-results",level:3},{value:"Verify Consumer Group After Reset",id:"verify-consumer-group-after-reset",level:3},{value:"Important Notes",id:"important-notes",level:2},{value:"Next Steps",id:"next-steps",level:2}];function c(e){const s={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.header,{children:(0,r.jsx)(s.h1,{id:"kafkaoffsetreset-crd",children:"KafkaOffsetReset CRD"})}),"\n",(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"KafkaOffsetReset"})," custom resource defines a consumer group offset reset operation."]}),"\n",(0,r.jsx)(s.h2,{id:"overview",children:"Overview"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetReset\nmetadata:\n  name: my-offset-reset\n  namespace: kafka-backup\nspec:\n  strategy: timestamp\n  # Reset configuration\n"})}),"\n",(0,r.jsx)(s.h2,{id:"full-specification",children:"Full Specification"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetReset\nmetadata:\n  name: offset-reset\n  namespace: kafka-backup\nspec:\n  # Kafka cluster\n  kafkaCluster:\n    bootstrapServers:\n      - kafka-0.kafka.svc:9092\n      - kafka-1.kafka.svc:9092\n    securityProtocol: SASL_SSL\n    tlsSecret:\n      name: kafka-tls\n      caKey: ca.crt\n    saslSecret:\n      name: kafka-credentials\n      mechanism: SCRAM-SHA-256\n      usernameKey: username\n      passwordKey: password\n\n  # Consumer groups to reset\n  consumerGroups:\n    - order-processor\n    - payment-handler\n    - notification-service\n\n  # Topics (optional - defaults to all topics in group)\n  topics:\n    - orders\n    - payments\n\n  # Reset strategy (required)\n  strategy: timestamp  # earliest, latest, timestamp, offset, headerBased, fromMapping\n\n  # Strategy-specific options\n\n  # For timestamp strategy\n  timestamp: "2024-12-01T12:00:00Z"\n  # Or: timestampMillis: 1701432000000\n\n  # For offset strategy\n  offset: 1000\n\n  # For headerBased strategy\n  sourceCluster: "production-us-west-2"\n  scanAllPartitions: false  # Set true if partition count changed\n\n  # For fromMapping strategy\n  mappingConfigMap:\n    name: offset-mapping\n    key: mapping.json\n\n  # Create snapshot before reset\n  createSnapshot: true\n  snapshotId: "pre-reset-snapshot"\n\n  # Parallel execution for bulk resets\n  parallelism: 10\n\n  # Dry run mode\n  dryRun: false\n\n  # Resource requirements\n  resources:\n    requests:\n      cpu: 100m\n      memory: 256Mi\n    limits:\n      cpu: 500m\n      memory: 512Mi\n\n  # Job configuration\n  job:\n    backoffLimit: 3\n    activeDeadlineSeconds: 1800\n    ttlSecondsAfterFinished: 3600\n'})}),"\n",(0,r.jsx)(s.h2,{id:"spec-fields",children:"Spec Fields"}),"\n",(0,r.jsx)(s.h3,{id:"kafkacluster",children:"kafkaCluster"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Field"}),(0,r.jsx)(s.th,{children:"Type"}),(0,r.jsx)(s.th,{children:"Required"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"bootstrapServers"})}),(0,r.jsx)(s.td,{children:"[]string"}),(0,r.jsx)(s.td,{children:"Yes"}),(0,r.jsx)(s.td,{children:"Kafka broker addresses"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"securityProtocol"})}),(0,r.jsx)(s.td,{children:"string"}),(0,r.jsx)(s.td,{children:"No"}),(0,r.jsx)(s.td,{children:"Security protocol"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"tlsSecret"})}),(0,r.jsx)(s.td,{children:"object"}),(0,r.jsx)(s.td,{children:"No"}),(0,r.jsx)(s.td,{children:"TLS certificate secret"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"saslSecret"})}),(0,r.jsx)(s.td,{children:"object"}),(0,r.jsx)(s.td,{children:"No"}),(0,r.jsx)(s.td,{children:"SASL credentials secret"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"strategy",children:"strategy"}),"\n",(0,r.jsxs)(s.table,{children:[(0,r.jsx)(s.thead,{children:(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.th,{children:"Value"}),(0,r.jsx)(s.th,{children:"Description"})]})}),(0,r.jsxs)(s.tbody,{children:[(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"earliest"})}),(0,r.jsx)(s.td,{children:"Reset to earliest available offset"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"latest"})}),(0,r.jsx)(s.td,{children:"Reset to latest offset"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"timestamp"})}),(0,r.jsx)(s.td,{children:"Reset to first offset >= timestamp"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"offset"})}),(0,r.jsx)(s.td,{children:"Reset to specific offset"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"headerBased"})}),(0,r.jsx)(s.td,{children:"Find offset using backup headers"})]}),(0,r.jsxs)(s.tr,{children:[(0,r.jsx)(s.td,{children:(0,r.jsx)(s.code,{children:"fromMapping"})}),(0,r.jsx)(s.td,{children:"Use pre-generated offset mapping"})]})]})]}),"\n",(0,r.jsx)(s.h3,{id:"strategy-options",children:"Strategy Options"}),"\n",(0,r.jsx)(s.h4,{id:"timestamp",children:"timestamp"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'strategy: timestamp\ntimestamp: "2024-12-01T12:00:00Z"\n# Or\ntimestampMillis: 1701432000000\n'})}),"\n",(0,r.jsx)(s.h4,{id:"offset",children:"offset"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"strategy: offset\noffset: 1000\n# Applies to all partitions\n"})}),"\n",(0,r.jsx)(s.h4,{id:"headerbased",children:"headerBased"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'strategy: headerBased\nsourceCluster: "production-us-west-2"\nscanAllPartitions: false  # True if partitions changed\n'})}),"\n",(0,r.jsx)(s.h4,{id:"frommapping",children:"fromMapping"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"strategy: fromMapping\nmappingConfigMap:\n  name: offset-mapping\n  key: mapping.json\n"})}),"\n",(0,r.jsx)(s.p,{children:"Mapping format:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-json",children:'{\n  "groups": {\n    "order-processor": {\n      "orders": {\n        "0": 1000,\n        "1": 2000,\n        "2": 1500\n      }\n    }\n  }\n}\n'})}),"\n",(0,r.jsx)(s.h2,{id:"status",children:"Status"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'status:\n  phase: Completed  # Pending, Running, Completed, Failed\n  startTime: "2024-12-01T12:00:00Z"\n  completionTime: "2024-12-01T12:01:00Z"\n  groupsReset: 3\n  snapshotId: "pre-reset-snapshot"\n  results:\n    - group: order-processor\n      status: success\n      partitionsReset: 6\n    - group: payment-handler\n      status: success\n      partitionsReset: 3\n    - group: notification-service\n      status: success\n      partitionsReset: 3\n  conditions:\n    - type: Ready\n      status: "True"\n      reason: ResetCompleted\n      message: "All consumer groups reset successfully"\n      lastTransitionTime: "2024-12-01T12:01:00Z"\n'})}),"\n",(0,r.jsx)(s.h2,{id:"examples",children:"Examples"}),"\n",(0,r.jsx)(s.h3,{id:"reset-to-earliest",children:"Reset to Earliest"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetReset\nmetadata:\n  name: reset-to-earliest\nspec:\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n  consumerGroups:\n    - my-consumer-group\n  strategy: earliest\n"})}),"\n",(0,r.jsx)(s.h3,{id:"reset-to-timestamp",children:"Reset to Timestamp"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetReset\nmetadata:\n  name: reset-to-timestamp\nspec:\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n    securityProtocol: SASL_SSL\n    saslSecret:\n      name: kafka-credentials\n      mechanism: SCRAM-SHA-256\n\n  consumerGroups:\n    - order-processor\n    - payment-handler\n\n  strategy: timestamp\n  timestamp: "2024-12-01T10:00:00Z"\n\n  createSnapshot: true\n  snapshotId: "before-reset-20241201"\n'})}),"\n",(0,r.jsx)(s.h3,{id:"header-based-reset-after-restore",children:"Header-Based Reset (After Restore)"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetReset\nmetadata:\n  name: post-restore-reset\nspec:\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n\n  consumerGroups:\n    - order-processor\n    - payment-handler\n    - notification-service\n\n  strategy: headerBased\n  sourceCluster: "production-us-west-2"\n\n  createSnapshot: true\n  snapshotId: "pre-header-reset"\n'})}),"\n",(0,r.jsx)(s.h3,{id:"bulk-reset-with-parallelism",children:"Bulk Reset with Parallelism"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetReset\nmetadata:\n  name: bulk-reset\nspec:\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n\n  consumerGroups:\n    - group-1\n    - group-2\n    - group-3\n    - group-4\n    - group-5\n    # ... many groups\n\n  strategy: earliest\n  parallelism: 50  # Reset up to 50 groups in parallel\n"})}),"\n",(0,r.jsx)(s.h3,{id:"dry-run",children:"Dry Run"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetReset\nmetadata:\n  name: dry-run-reset\nspec:\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n\n  consumerGroups:\n    - order-processor\n\n  strategy: timestamp\n  timestamp: "2024-12-01T10:00:00Z"\n\n  dryRun: true  # Only show what would be reset\n'})}),"\n",(0,r.jsx)(s.h3,{id:"from-mapping-file",children:"From Mapping File"}),"\n",(0,r.jsx)(s.p,{children:"First create the mapping ConfigMap:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:'apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: offset-mapping\n  namespace: kafka-backup\ndata:\n  mapping.json: |\n    {\n      "groups": {\n        "order-processor": {\n          "orders": {"0": 1000, "1": 2000},\n          "payments": {"0": 500}\n        }\n      }\n    }\n'})}),"\n",(0,r.jsx)(s.p,{children:"Then reference it:"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-yaml",children:"apiVersion: kafka.oso.sh/v1alpha1\nkind: KafkaOffsetReset\nmetadata:\n  name: reset-from-mapping\nspec:\n  kafkaCluster:\n    bootstrapServers:\n      - kafka:9092\n\n  consumerGroups:\n    - order-processor\n\n  strategy: fromMapping\n  mappingConfigMap:\n    name: offset-mapping\n    key: mapping.json\n"})}),"\n",(0,r.jsx)(s.h2,{id:"operations",children:"Operations"}),"\n",(0,r.jsx)(s.h3,{id:"check-reset-status",children:"Check Reset Status"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"kubectl get kafkaoffsetreset my-reset -o jsonpath='{.status.phase}'\n"})}),"\n",(0,r.jsx)(s.h3,{id:"view-reset-results",children:"View Reset Results"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"kubectl get kafkaoffsetreset my-reset -o yaml | grep -A 30 status\n"})}),"\n",(0,r.jsx)(s.h3,{id:"verify-consumer-group-after-reset",children:"Verify Consumer Group After Reset"}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-bash",children:"kubectl exec -it kafka-0 -- kafka-consumer-groups \\\n  --bootstrap-server localhost:9092 \\\n  --group order-processor \\\n  --describe\n"})}),"\n",(0,r.jsx)(s.h2,{id:"important-notes",children:"Important Notes"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Stop consumers first"})," - Consumer groups must be inactive for reset"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Use snapshots"})," - Enable ",(0,r.jsx)(s.code,{children:"createSnapshot"})," for safety"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Test with dry run"})," - Verify before actual reset"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Check lag after"})," - Verify consumers resume correctly"]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"./kafkaoffsetrollback",children:"KafkaOffsetRollback"})," - Rollback if needed"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"../../guides/offset-management",children:"Offset Management Guide"})," - Best practices"]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.a,{href:"../../troubleshooting/offset-discontinuity",children:"Offset Discontinuity"})," - Troubleshooting"]}),"\n"]})]})}function p(e={}){const{wrapper:s}={...(0,a.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>i,x:()=>o});var t=n(6540);const r={},a=t.createContext(r);function i(e){const s=t.useContext(a);return t.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function o(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(a.Provider,{value:s},e.children)}}}]);