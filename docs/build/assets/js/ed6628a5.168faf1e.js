"use strict";(globalThis.webpackChunkkafka_backup_docs=globalThis.webpackChunkkafka_backup_docs||[]).push([[3132],{1214:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>t,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"operator/metrics","title":"Metrics","description":"Prometheus metrics for the OSO Kafka Backup Operator","source":"@site/docs/operator/metrics.md","sourceDirName":"operator","slug":"/operator/metrics","permalink":"/operator/metrics","draft":false,"unlisted":false,"editUrl":"https://github.com/osodevops/kafka-backup-docs/tree/main/docs/docs/operator/metrics.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"title":"Metrics","description":"Prometheus metrics for the OSO Kafka Backup Operator","sidebar_position":4},"sidebar":"docsSidebar","previous":{"title":"Secrets","permalink":"/operator/guides/secrets"},"next":{"title":"Troubleshooting","permalink":"/operator/troubleshooting"}}');var s=n(4848),c=n(8453);const t={title:"Metrics",description:"Prometheus metrics for the OSO Kafka Backup Operator",sidebar_position:4},i="Metrics",l={},o=[{value:"Endpoints",id:"endpoints",level:2},{value:"Enabling Metrics",id:"enabling-metrics",level:2},{value:"Helm Configuration",id:"helm-configuration",level:3},{value:"ServiceMonitor",id:"servicemonitor",level:3},{value:"Metrics Reference",id:"metrics-reference",level:2},{value:"Operator Metrics",id:"operator-metrics",level:3},{value:"Reconciliation Metrics",id:"reconciliation-metrics",level:4},{value:"Queue Metrics",id:"queue-metrics",level:4},{value:"Backup Metrics",id:"backup-metrics",level:3},{value:"Restore Metrics",id:"restore-metrics",level:3},{value:"Offset Reset Metrics",id:"offset-reset-metrics",level:3},{value:"Resource Status Metrics",id:"resource-status-metrics",level:3},{value:"Prometheus Queries",id:"prometheus-queries",level:2},{value:"Backup Success Rate",id:"backup-success-rate",level:3},{value:"Backup Duration (p99)",id:"backup-duration-p99",level:3},{value:"Failed Backups",id:"failed-backups",level:3},{value:"Time Since Last Backup",id:"time-since-last-backup",level:3},{value:"Reconciliation Error Rate",id:"reconciliation-error-rate",level:3},{value:"Queue Depth",id:"queue-depth",level:3},{value:"Grafana Dashboards",id:"grafana-dashboards",level:2},{value:"Import Dashboard",id:"import-dashboard",level:3},{value:"Alerting Rules",id:"alerting-rules",level:2},{value:"PrometheusRule",id:"prometheusrule",level:3},{value:"Manual Metrics Access",id:"manual-metrics-access",level:2},{value:"Port Forward",id:"port-forward",level:3},{value:"Sample Output",id:"sample-output",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"metrics",children:"Metrics"})}),"\n",(0,s.jsx)(r.p,{children:"The OSO Kafka Backup Operator exposes Prometheus metrics for monitoring backup operations."}),"\n",(0,s.jsx)(r.h2,{id:"endpoints",children:"Endpoints"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Endpoint"}),(0,s.jsx)(r.th,{children:"Port"}),(0,s.jsx)(r.th,{children:"Description"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/metrics"})}),(0,s.jsx)(r.td,{children:"8080"}),(0,s.jsx)(r.td,{children:"Prometheus metrics"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/healthz"})}),(0,s.jsx)(r.td,{children:"8081"}),(0,s.jsx)(r.td,{children:"Liveness probe"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"/readyz"})}),(0,s.jsx)(r.td,{children:"8081"}),(0,s.jsx)(r.td,{children:"Readiness probe"})]})]})]}),"\n",(0,s.jsx)(r.h2,{id:"enabling-metrics",children:"Enabling Metrics"}),"\n",(0,s.jsx)(r.h3,{id:"helm-configuration",children:"Helm Configuration"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-yaml",children:"metrics:\n  enabled: true\n  port: 8080\n  path: /metrics\n\n  serviceMonitor:\n    enabled: true\n    namespace: monitoring\n    interval: 30s\n    labels:\n      release: prometheus\n"})}),"\n",(0,s.jsx)(r.h3,{id:"servicemonitor",children:"ServiceMonitor"}),"\n",(0,s.jsxs)(r.p,{children:["When ",(0,s.jsx)(r.code,{children:"serviceMonitor.enabled: true"}),", a ServiceMonitor is created:"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-yaml",children:"apiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: kafka-backup-operator\n  namespace: monitoring\n  labels:\n    release: prometheus\nspec:\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: kafka-backup-operator\n  namespaceSelector:\n    matchNames:\n      - kafka-backup\n  endpoints:\n    - port: metrics\n      interval: 30s\n      path: /metrics\n"})}),"\n",(0,s.jsx)(r.h2,{id:"metrics-reference",children:"Metrics Reference"}),"\n",(0,s.jsx)(r.h3,{id:"operator-metrics",children:"Operator Metrics"}),"\n",(0,s.jsx)(r.h4,{id:"reconciliation-metrics",children:"Reconciliation Metrics"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Metric"}),(0,s.jsx)(r.th,{children:"Type"}),(0,s.jsx)(r.th,{children:"Description"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_operator_reconciliations_total"})}),(0,s.jsx)(r.td,{children:"Counter"}),(0,s.jsx)(r.td,{children:"Total reconciliation attempts"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_operator_reconciliation_errors_total"})}),(0,s.jsx)(r.td,{children:"Counter"}),(0,s.jsx)(r.td,{children:"Total reconciliation errors"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_operator_reconciliation_duration_seconds"})}),(0,s.jsx)(r.td,{children:"Histogram"}),(0,s.jsx)(r.td,{children:"Reconciliation duration"})]})]})]}),"\n",(0,s.jsx)(r.p,{children:"Labels:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"controller"}),": Controller name (backup, restore, offset_reset, offset_rollback)"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"namespace"}),": Resource namespace"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"name"}),": Resource name"]}),"\n"]}),"\n",(0,s.jsx)(r.h4,{id:"queue-metrics",children:"Queue Metrics"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Metric"}),(0,s.jsx)(r.th,{children:"Type"}),(0,s.jsx)(r.th,{children:"Description"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_operator_workqueue_depth"})}),(0,s.jsx)(r.td,{children:"Gauge"}),(0,s.jsx)(r.td,{children:"Current queue depth"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_operator_workqueue_adds_total"})}),(0,s.jsx)(r.td,{children:"Counter"}),(0,s.jsx)(r.td,{children:"Items added to queue"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_operator_workqueue_retries_total"})}),(0,s.jsx)(r.td,{children:"Counter"}),(0,s.jsx)(r.td,{children:"Item retries"})]})]})]}),"\n",(0,s.jsx)(r.h3,{id:"backup-metrics",children:"Backup Metrics"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Metric"}),(0,s.jsx)(r.th,{children:"Type"}),(0,s.jsx)(r.th,{children:"Description"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_backups_total"})}),(0,s.jsx)(r.td,{children:"Counter"}),(0,s.jsx)(r.td,{children:"Total backup operations"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_backup_duration_seconds"})}),(0,s.jsx)(r.td,{children:"Histogram"}),(0,s.jsx)(r.td,{children:"Backup duration"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_backup_size_bytes"})}),(0,s.jsx)(r.td,{children:"Gauge"}),(0,s.jsx)(r.td,{children:"Last backup size"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_backup_records_total"})}),(0,s.jsx)(r.td,{children:"Counter"}),(0,s.jsx)(r.td,{children:"Records backed up"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_last_successful_backup_timestamp"})}),(0,s.jsx)(r.td,{children:"Gauge"}),(0,s.jsx)(r.td,{children:"Timestamp of last success"})]})]})]}),"\n",(0,s.jsx)(r.p,{children:"Labels:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"backup_name"}),": KafkaBackup resource name"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"namespace"}),": Resource namespace"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"outcome"}),": success, failure"]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"restore-metrics",children:"Restore Metrics"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Metric"}),(0,s.jsx)(r.th,{children:"Type"}),(0,s.jsx)(r.th,{children:"Description"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_restores_total"})}),(0,s.jsx)(r.td,{children:"Counter"}),(0,s.jsx)(r.td,{children:"Total restore operations"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_restore_duration_seconds"})}),(0,s.jsx)(r.td,{children:"Histogram"}),(0,s.jsx)(r.td,{children:"Restore duration"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_restore_records_total"})}),(0,s.jsx)(r.td,{children:"Counter"}),(0,s.jsx)(r.td,{children:"Records restored"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_last_successful_restore_timestamp"})}),(0,s.jsx)(r.td,{children:"Gauge"}),(0,s.jsx)(r.td,{children:"Timestamp of last success"})]})]})]}),"\n",(0,s.jsx)(r.p,{children:"Labels:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"restore_name"}),": KafkaRestore resource name"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"namespace"}),": Resource namespace"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"outcome"}),": success, failure"]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"offset-reset-metrics",children:"Offset Reset Metrics"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Metric"}),(0,s.jsx)(r.th,{children:"Type"}),(0,s.jsx)(r.th,{children:"Description"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_offset_resets_total"})}),(0,s.jsx)(r.td,{children:"Counter"}),(0,s.jsx)(r.td,{children:"Total offset reset operations"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_offset_reset_duration_seconds"})}),(0,s.jsx)(r.td,{children:"Histogram"}),(0,s.jsx)(r.td,{children:"Reset duration"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_offset_reset_groups_total"})}),(0,s.jsx)(r.td,{children:"Counter"}),(0,s.jsx)(r.td,{children:"Consumer groups reset"})]})]})]}),"\n",(0,s.jsx)(r.p,{children:"Labels:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"reset_name"}),": KafkaOffsetReset resource name"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"namespace"}),": Resource namespace"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"strategy"}),": earliest, latest, timestamp, offset, header_based"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"outcome"}),": success, failure"]}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"resource-status-metrics",children:"Resource Status Metrics"}),"\n",(0,s.jsxs)(r.table,{children:[(0,s.jsx)(r.thead,{children:(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.th,{children:"Metric"}),(0,s.jsx)(r.th,{children:"Type"}),(0,s.jsx)(r.th,{children:"Description"})]})}),(0,s.jsxs)(r.tbody,{children:[(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_resource_status"})}),(0,s.jsx)(r.td,{children:"Gauge"}),(0,s.jsx)(r.td,{children:"Resource status (1=ready, 0=not ready)"})]}),(0,s.jsxs)(r.tr,{children:[(0,s.jsx)(r.td,{children:(0,s.jsx)(r.code,{children:"kafka_backup_resource_phase"})}),(0,s.jsx)(r.td,{children:"Gauge"}),(0,s.jsx)(r.td,{children:"Resource phase"})]})]})]}),"\n",(0,s.jsx)(r.p,{children:"Labels:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"kind"}),": KafkaBackup, KafkaRestore, etc."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"name"}),": Resource name"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"namespace"}),": Namespace"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.code,{children:"phase"}),": Pending, Running, Completed, Failed"]}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"prometheus-queries",children:"Prometheus Queries"}),"\n",(0,s.jsx)(r.h3,{id:"backup-success-rate",children:"Backup Success Rate"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-promql",children:'# Success rate over 24 hours\nsum(rate(kafka_backup_backups_total{outcome="success"}[24h])) /\nsum(rate(kafka_backup_backups_total[24h]))\n'})}),"\n",(0,s.jsx)(r.h3,{id:"backup-duration-p99",children:"Backup Duration (p99)"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-promql",children:"histogram_quantile(0.99,\n  sum(rate(kafka_backup_backup_duration_seconds_bucket[1h])) by (le, backup_name)\n)\n"})}),"\n",(0,s.jsx)(r.h3,{id:"failed-backups",children:"Failed Backups"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-promql",children:'# Failed backups in last hour\nsum(increase(kafka_backup_backups_total{outcome="failure"}[1h])) by (backup_name)\n'})}),"\n",(0,s.jsx)(r.h3,{id:"time-since-last-backup",children:"Time Since Last Backup"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-promql",children:"# Time since last successful backup\ntime() - kafka_backup_last_successful_backup_timestamp\n"})}),"\n",(0,s.jsx)(r.h3,{id:"reconciliation-error-rate",children:"Reconciliation Error Rate"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-promql",children:"sum(rate(kafka_backup_operator_reconciliation_errors_total[5m])) by (controller)\n"})}),"\n",(0,s.jsx)(r.h3,{id:"queue-depth",children:"Queue Depth"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-promql",children:"kafka_backup_operator_workqueue_depth\n"})}),"\n",(0,s.jsx)(r.h2,{id:"grafana-dashboards",children:"Grafana Dashboards"}),"\n",(0,s.jsx)(r.h3,{id:"import-dashboard",children:"Import Dashboard"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-json",metastring:'title="kafka-backup-dashboard.json"',children:'{\n  "dashboard": {\n    "title": "Kafka Backup Operator",\n    "panels": [\n      {\n        "title": "Backup Success Rate",\n        "type": "gauge",\n        "targets": [\n          {\n            "expr": "sum(rate(kafka_backup_backups_total{outcome=\\"success\\"}[24h])) / sum(rate(kafka_backup_backups_total[24h])) * 100"\n          }\n        ],\n        "fieldConfig": {\n          "defaults": {\n            "unit": "percent",\n            "thresholds": {\n              "steps": [\n                {"value": 0, "color": "red"},\n                {"value": 90, "color": "yellow"},\n                {"value": 99, "color": "green"}\n              ]\n            }\n          }\n        }\n      },\n      {\n        "title": "Backup Duration",\n        "type": "timeseries",\n        "targets": [\n          {\n            "expr": "histogram_quantile(0.99, sum(rate(kafka_backup_backup_duration_seconds_bucket[5m])) by (le, backup_name))",\n            "legendFormat": "{{backup_name}} p99"\n          },\n          {\n            "expr": "histogram_quantile(0.50, sum(rate(kafka_backup_backup_duration_seconds_bucket[5m])) by (le, backup_name))",\n            "legendFormat": "{{backup_name}} p50"\n          }\n        ]\n      },\n      {\n        "title": "Backup Size",\n        "type": "timeseries",\n        "targets": [\n          {\n            "expr": "kafka_backup_backup_size_bytes",\n            "legendFormat": "{{backup_name}}"\n          }\n        ],\n        "fieldConfig": {\n          "defaults": {\n            "unit": "bytes"\n          }\n        }\n      },\n      {\n        "title": "Time Since Last Backup",\n        "type": "stat",\n        "targets": [\n          {\n            "expr": "time() - kafka_backup_last_successful_backup_timestamp",\n            "legendFormat": "{{backup_name}}"\n          }\n        ],\n        "fieldConfig": {\n          "defaults": {\n            "unit": "s",\n            "thresholds": {\n              "steps": [\n                {"value": 0, "color": "green"},\n                {"value": 3600, "color": "yellow"},\n                {"value": 7200, "color": "red"}\n              ]\n            }\n          }\n        }\n      },\n      {\n        "title": "Reconciliation Errors",\n        "type": "timeseries",\n        "targets": [\n          {\n            "expr": "sum(rate(kafka_backup_operator_reconciliation_errors_total[5m])) by (controller)",\n            "legendFormat": "{{controller}}"\n          }\n        ]\n      },\n      {\n        "title": "Records Backed Up",\n        "type": "timeseries",\n        "targets": [\n          {\n            "expr": "sum(rate(kafka_backup_backup_records_total[5m])) by (backup_name)",\n            "legendFormat": "{{backup_name}}"\n          }\n        ],\n        "fieldConfig": {\n          "defaults": {\n            "unit": "records/s"\n          }\n        }\n      }\n    ]\n  }\n}\n'})}),"\n",(0,s.jsx)(r.h2,{id:"alerting-rules",children:"Alerting Rules"}),"\n",(0,s.jsx)(r.h3,{id:"prometheusrule",children:"PrometheusRule"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-yaml",children:'apiVersion: monitoring.coreos.com/v1\nkind: PrometheusRule\nmetadata:\n  name: kafka-backup-alerts\n  namespace: monitoring\nspec:\n  groups:\n    - name: kafka-backup\n      rules:\n        # Backup failed\n        - alert: KafkaBackupFailed\n          expr: increase(kafka_backup_backups_total{outcome="failure"}[1h]) > 0\n          for: 0m\n          labels:\n            severity: critical\n          annotations:\n            summary: "Kafka backup failed"\n            description: "Backup {{ $labels.backup_name }} in {{ $labels.namespace }} failed"\n\n        # No recent backup\n        - alert: KafkaBackupMissing\n          expr: time() - kafka_backup_last_successful_backup_timestamp > 7200\n          for: 5m\n          labels:\n            severity: warning\n          annotations:\n            summary: "No recent Kafka backup"\n            description: "No successful backup for {{ $labels.backup_name }} in 2 hours"\n\n        # Backup taking too long\n        - alert: KafkaBackupSlow\n          expr: kafka_backup_backup_duration_seconds > 3600\n          for: 0m\n          labels:\n            severity: warning\n          annotations:\n            summary: "Kafka backup is slow"\n            description: "Backup {{ $labels.backup_name }} took more than 1 hour"\n\n        # Operator reconciliation errors\n        - alert: KafkaBackupOperatorErrors\n          expr: rate(kafka_backup_operator_reconciliation_errors_total[5m]) > 0\n          for: 5m\n          labels:\n            severity: warning\n          annotations:\n            summary: "Kafka backup operator errors"\n            description: "Controller {{ $labels.controller }} has reconciliation errors"\n\n        # Restore failed\n        - alert: KafkaRestoreFailed\n          expr: increase(kafka_backup_restores_total{outcome="failure"}[1h]) > 0\n          for: 0m\n          labels:\n            severity: critical\n          annotations:\n            summary: "Kafka restore failed"\n            description: "Restore {{ $labels.restore_name }} in {{ $labels.namespace }} failed"\n'})}),"\n",(0,s.jsx)(r.h2,{id:"manual-metrics-access",children:"Manual Metrics Access"}),"\n",(0,s.jsx)(r.h3,{id:"port-forward",children:"Port Forward"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-bash",children:"# Port forward to operator\nkubectl port-forward -n kafka-backup deployment/kafka-backup-operator 8080:8080\n\n# Fetch metrics\ncurl http://localhost:8080/metrics\n"})}),"\n",(0,s.jsx)(r.h3,{id:"sample-output",children:"Sample Output"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:'# HELP kafka_backup_backups_total Total number of backup operations\n# TYPE kafka_backup_backups_total counter\nkafka_backup_backups_total{backup_name="hourly-backup",namespace="kafka-backup",outcome="success"} 24\nkafka_backup_backups_total{backup_name="hourly-backup",namespace="kafka-backup",outcome="failure"} 1\n\n# HELP kafka_backup_backup_duration_seconds Duration of backup operations\n# TYPE kafka_backup_backup_duration_seconds histogram\nkafka_backup_backup_duration_seconds_bucket{backup_name="hourly-backup",le="60"} 10\nkafka_backup_backup_duration_seconds_bucket{backup_name="hourly-backup",le="300"} 23\nkafka_backup_backup_duration_seconds_bucket{backup_name="hourly-backup",le="600"} 24\nkafka_backup_backup_duration_seconds_bucket{backup_name="hourly-backup",le="+Inf"} 25\nkafka_backup_backup_duration_seconds_sum{backup_name="hourly-backup"} 2850\nkafka_backup_backup_duration_seconds_count{backup_name="hourly-backup"} 25\n\n# HELP kafka_backup_last_successful_backup_timestamp Timestamp of last successful backup\n# TYPE kafka_backup_last_successful_backup_timestamp gauge\nkafka_backup_last_successful_backup_timestamp{backup_name="hourly-backup",namespace="kafka-backup"} 1701432000\n'})}),"\n",(0,s.jsx)(r.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"./troubleshooting",children:"Troubleshooting"})," - Debug operator issues"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"./configuration",children:"Configuration"})," - Operator settings"]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"https://grafana.com/grafana/dashboards/",children:"Grafana Dashboards"})," - Import dashboards"]}),"\n"]})]})}function u(e={}){const{wrapper:r}={...(0,c.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>t,x:()=>i});var a=n(6540);const s={},c=a.createContext(s);function t(e){const r=a.useContext(c);return a.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),a.createElement(c.Provider,{value:r},e.children)}}}]);