"use strict";(globalThis.webpackChunkkafka_backup_docs=globalThis.webpackChunkkafka_backup_docs||[]).push([[6774],{8453:(e,n,s)=>{s.d(n,{R:()=>c,x:()=>i});var a=s(6540);const r={},o=a.createContext(r);function c(e){const n=a.useContext(o);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:c(e.components),a.createElement(o.Provider,{value:n},e.children)}},9026:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>u,frontMatter:()=>c,metadata:()=>a,toc:()=>t});const a=JSON.parse('{"id":"deployment/docker","title":"Docker Deployment","description":"Deploy OSO Kafka Backup using Docker and Docker Compose","source":"@site/docs/deployment/docker.md","sourceDirName":"deployment","slug":"/deployment/docker","permalink":"/deployment/docker","draft":false,"unlisted":false,"editUrl":"https://github.com/osodevops/kafka-backup-docs/tree/main/docs/docs/deployment/docker.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"title":"Docker Deployment","description":"Deploy OSO Kafka Backup using Docker and Docker Compose","sidebar_position":3},"sidebar":"docsSidebar","previous":{"title":"Bare Metal Installation","permalink":"/deployment/bare-metal"},"next":{"title":"Kubernetes Deployment","permalink":"/deployment/kubernetes"}}');var r=s(4848),o=s(8453);const c={title:"Docker Deployment",description:"Deploy OSO Kafka Backup using Docker and Docker Compose",sidebar_position:3},i="Docker Deployment",l={},t=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Pull the Image",id:"pull-the-image",level:3},{value:"Verify Installation",id:"verify-installation",level:3},{value:"Running a Backup",id:"running-a-backup",level:2},{value:"With Local Storage",id:"with-local-storage",level:3},{value:"With S3 Storage",id:"with-s3-storage",level:3},{value:"Running a Restore",id:"running-a-restore",level:2},{value:"Docker Compose",id:"docker-compose",level:2},{value:"Development Environment",id:"development-environment",level:3},{value:"Production Setup",id:"production-setup",level:3},{value:"Scheduled Backups",id:"scheduled-backups",level:2},{value:"Using Docker Compose with Cron",id:"using-docker-compose-with-cron",level:3},{value:"Using Ofelia (Cron for Docker)",id:"using-ofelia-cron-for-docker",level:3},{value:"Environment Variables",id:"environment-variables",level:2},{value:"Volume Mounts",id:"volume-mounts",level:2},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Run as Non-Root",id:"run-as-non-root",level:3},{value:"Read-Only Root Filesystem",id:"read-only-root-filesystem",level:3},{value:"Secrets Management",id:"secrets-management",level:3},{value:"Multi-Architecture Support",id:"multi-architecture-support",level:2},{value:"Debugging",id:"debugging",level:2},{value:"Enable Verbose Logging",id:"enable-verbose-logging",level:3},{value:"Interactive Shell",id:"interactive-shell",level:3},{value:"Check Container Logs",id:"check-container-logs",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Network Issues",id:"network-issues",level:3},{value:"Permission Issues",id:"permission-issues",level:3},{value:"DNS Issues",id:"dns-issues",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,o.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"docker-deployment",children:"Docker Deployment"})}),"\n",(0,r.jsx)(n.p,{children:"Run OSO Kafka Backup in Docker containers for development, testing, or production use."}),"\n",(0,r.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Docker 20.10+"}),"\n",(0,r.jsx)(n.li,{children:"Docker Compose (optional)"}),"\n",(0,r.jsx)(n.li,{children:"Network access to Kafka brokers"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,r.jsx)(n.h3,{id:"pull-the-image",children:"Pull the Image"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker pull ghcr.io/osodevops/kafka-backup:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"verify-installation",children:"Verify Installation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run --rm ghcr.io/osodevops/kafka-backup:latest --version\ndocker run --rm ghcr.io/osodevops/kafka-backup:latest --help\n"})}),"\n",(0,r.jsx)(n.h2,{id:"running-a-backup",children:"Running a Backup"}),"\n",(0,r.jsx)(n.h3,{id:"with-local-storage",children:"With Local Storage"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Create backup directory\nmkdir -p ./backups\n\n# Create config file\ncat > backup.yaml << \'EOF\'\nmode: backup\nbackup_id: "my-backup"\n\nsource:\n  bootstrap_servers:\n    - kafka:9092\n  topics:\n    include:\n      - my-topic\n\nstorage:\n  backend: filesystem\n  path: "/data/backups"\n\nbackup:\n  compression: zstd\nEOF\n\n# Run backup\ndocker run --rm \\\n  --network host \\\n  -v $(pwd)/backup.yaml:/config/backup.yaml:ro \\\n  -v $(pwd)/backups:/data/backups \\\n  ghcr.io/osodevops/kafka-backup:latest \\\n  backup --config /config/backup.yaml\n'})}),"\n",(0,r.jsx)(n.h3,{id:"with-s3-storage",children:"With S3 Storage"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'docker run --rm \\\n  -e AWS_ACCESS_KEY_ID="${AWS_ACCESS_KEY_ID}" \\\n  -e AWS_SECRET_ACCESS_KEY="${AWS_SECRET_ACCESS_KEY}" \\\n  -e AWS_REGION="us-west-2" \\\n  -v $(pwd)/backup.yaml:/config/backup.yaml:ro \\\n  ghcr.io/osodevops/kafka-backup:latest \\\n  backup --config /config/backup.yaml\n'})}),"\n",(0,r.jsx)(n.h2,{id:"running-a-restore",children:"Running a Restore"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run --rm \\\n  --network host \\\n  -v $(pwd)/restore.yaml:/config/restore.yaml:ro \\\n  -v $(pwd)/backups:/data/backups:ro \\\n  ghcr.io/osodevops/kafka-backup:latest \\\n  restore --config /config/restore.yaml\n"})}),"\n",(0,r.jsx)(n.h2,{id:"docker-compose",children:"Docker Compose"}),"\n",(0,r.jsx)(n.h3,{id:"development-environment",children:"Development Environment"}),"\n",(0,r.jsx)(n.p,{children:"Complete environment with Kafka and backup service:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="docker-compose.yml"',children:'version: \'3.8\'\n\nservices:\n  kafka:\n    image: confluentinc/cp-kafka:7.5.0\n    hostname: kafka\n    ports:\n      - "9092:9092"\n    environment:\n      KAFKA_NODE_ID: 1\n      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT\n      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:9093\n      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092\n      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER\n      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka:9093\n      KAFKA_PROCESS_ROLES: broker,controller\n      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1\n      CLUSTER_ID: MkU3OEVBNTcwNTJENDM2Qk\n    healthcheck:\n      test: ["CMD", "kafka-topics", "--bootstrap-server", "localhost:9092", "--list"]\n      interval: 10s\n      timeout: 5s\n      retries: 5\n\n  kafka-backup:\n    image: ghcr.io/osodevops/kafka-backup:latest\n    depends_on:\n      kafka:\n        condition: service_healthy\n    volumes:\n      - ./config:/config:ro\n      - ./backups:/data/backups\n    command: ["backup", "--config", "/config/backup.yaml"]\n    # For one-shot runs, use:\n    # profiles: ["backup"]\n\nvolumes:\n  backups:\n'})}),"\n",(0,r.jsx)(n.h3,{id:"production-setup",children:"Production Setup"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="docker-compose.prod.yml"',children:'version: \'3.8\'\n\nservices:\n  kafka-backup:\n    image: ghcr.io/osodevops/kafka-backup:latest\n    restart: unless-stopped\n    environment:\n      - AWS_ACCESS_KEY_ID=${AWS_ACCESS_KEY_ID}\n      - AWS_SECRET_ACCESS_KEY=${AWS_SECRET_ACCESS_KEY}\n      - AWS_REGION=${AWS_REGION}\n    volumes:\n      - ./config:/config:ro\n      - kafka-backup-data:/data\n    networks:\n      - kafka-network\n    deploy:\n      resources:\n        limits:\n          cpus: \'2\'\n          memory: 1G\n        reservations:\n          cpus: \'0.5\'\n          memory: 256M\n    healthcheck:\n      test: ["CMD", "kafka-backup", "--help"]\n      interval: 30s\n      timeout: 10s\n      retries: 3\n    logging:\n      driver: "json-file"\n      options:\n        max-size: "100m"\n        max-file: "5"\n\nnetworks:\n  kafka-network:\n    external: true\n\nvolumes:\n  kafka-backup-data:\n'})}),"\n",(0,r.jsx)(n.h2,{id:"scheduled-backups",children:"Scheduled Backups"}),"\n",(0,r.jsx)(n.h3,{id:"using-docker-compose-with-cron",children:"Using Docker Compose with Cron"}),"\n",(0,r.jsx)(n.p,{children:"Create a wrapper script:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="run-backup.sh"',children:"#!/bin/bash\ndocker-compose -f docker-compose.yml run --rm kafka-backup \\\n  backup --config /config/backup.yaml\n"})}),"\n",(0,r.jsx)(n.p,{children:"Add to crontab:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Daily backup at 2 AM\n0 2 * * * /path/to/run-backup.sh >> /var/log/kafka-backup.log 2>&1\n"})}),"\n",(0,r.jsx)(n.h3,{id:"using-ofelia-cron-for-docker",children:"Using Ofelia (Cron for Docker)"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",metastring:'title="docker-compose.yml"',children:'version: \'3.8\'\n\nservices:\n  ofelia:\n    image: mcuadros/ofelia:latest\n    depends_on:\n      - kafka-backup\n    command: daemon --docker\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock:ro\n    labels:\n      ofelia.job-run.kafka-backup.schedule: "0 2 * * *"\n      ofelia.job-run.kafka-backup.container: "kafka-backup"\n\n  kafka-backup:\n    image: ghcr.io/osodevops/kafka-backup:latest\n    container_name: kafka-backup\n    volumes:\n      - ./config:/config:ro\n      - ./backups:/data/backups\n    command: ["backup", "--config", "/config/backup.yaml"]\n    labels:\n      ofelia.enabled: "true"\n'})}),"\n",(0,r.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Variable"}),(0,r.jsx)(n.th,{children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"AWS_ACCESS_KEY_ID"})}),(0,r.jsx)(n.td,{children:"AWS access key for S3"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"AWS_SECRET_ACCESS_KEY"})}),(0,r.jsx)(n.td,{children:"AWS secret key for S3"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"AWS_REGION"})}),(0,r.jsx)(n.td,{children:"AWS region"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"AZURE_STORAGE_ACCOUNT"})}),(0,r.jsx)(n.td,{children:"Azure storage account"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"AZURE_STORAGE_KEY"})}),(0,r.jsx)(n.td,{children:"Azure storage key"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"GOOGLE_APPLICATION_CREDENTIALS"})}),(0,r.jsx)(n.td,{children:"Path to GCP service account JSON"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"RUST_LOG"})}),(0,r.jsx)(n.td,{children:"Logging level (info, debug, trace)"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"volume-mounts",children:"Volume Mounts"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Container Path"}),(0,r.jsx)(n.th,{children:"Purpose"}),(0,r.jsx)(n.th,{children:"Mode"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/config"})}),(0,r.jsx)(n.td,{children:"Configuration files"}),(0,r.jsx)(n.td,{children:"Read-only"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/data/backups"})}),(0,r.jsx)(n.td,{children:"Backup storage"}),(0,r.jsx)(n.td,{children:"Read-write"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"/certs"})}),(0,r.jsx)(n.td,{children:"TLS certificates"}),(0,r.jsx)(n.td,{children:"Read-only"})]})]})]}),"\n",(0,r.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,r.jsx)(n.h3,{id:"run-as-non-root",children:"Run as Non-Root"}),"\n",(0,r.jsx)(n.p,{children:"The image runs as non-root by default (UID 1000):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:'services:\n  kafka-backup:\n    image: ghcr.io/osodevops/kafka-backup:latest\n    user: "1000:1000"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"read-only-root-filesystem",children:"Read-Only Root Filesystem"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"services:\n  kafka-backup:\n    image: ghcr.io/osodevops/kafka-backup:latest\n    read_only: true\n    tmpfs:\n      - /tmp\n    volumes:\n      - ./backups:/data/backups\n"})}),"\n",(0,r.jsx)(n.h3,{id:"secrets-management",children:"Secrets Management"}),"\n",(0,r.jsx)(n.p,{children:"Use Docker secrets for sensitive data:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"services:\n  kafka-backup:\n    image: ghcr.io/osodevops/kafka-backup:latest\n    secrets:\n      - kafka_password\n      - aws_credentials\n    environment:\n      - KAFKA_PASSWORD_FILE=/run/secrets/kafka_password\n\nsecrets:\n  kafka_password:\n    file: ./secrets/kafka_password.txt\n  aws_credentials:\n    file: ./secrets/aws_credentials\n"})}),"\n",(0,r.jsx)(n.h2,{id:"multi-architecture-support",children:"Multi-Architecture Support"}),"\n",(0,r.jsx)(n.p,{children:"The image supports multiple architectures:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# AMD64 (Intel/AMD)\ndocker pull ghcr.io/osodevops/kafka-backup:latest --platform linux/amd64\n\n# ARM64 (Apple Silicon, Graviton)\ndocker pull ghcr.io/osodevops/kafka-backup:latest --platform linux/arm64\n"})}),"\n",(0,r.jsx)(n.h2,{id:"debugging",children:"Debugging"}),"\n",(0,r.jsx)(n.h3,{id:"enable-verbose-logging",children:"Enable Verbose Logging"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run --rm \\\n  -e RUST_LOG=debug \\\n  -v $(pwd)/backup.yaml:/config/backup.yaml:ro \\\n  ghcr.io/osodevops/kafka-backup:latest \\\n  -v backup --config /config/backup.yaml\n"})}),"\n",(0,r.jsx)(n.h3,{id:"interactive-shell",children:"Interactive Shell"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker run -it --rm \\\n  --entrypoint /bin/sh \\\n  ghcr.io/osodevops/kafka-backup:latest\n"})}),"\n",(0,r.jsx)(n.h3,{id:"check-container-logs",children:"Check Container Logs"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"docker logs kafka-backup\ndocker logs -f kafka-backup  # Follow logs\n"})}),"\n",(0,r.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,r.jsx)(n.h3,{id:"network-issues",children:"Network Issues"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:'# Test connectivity from container\ndocker run --rm --network host \\\n  ghcr.io/osodevops/kafka-backup:latest \\\n  sh -c "nc -zv kafka 9092"\n'})}),"\n",(0,r.jsx)(n.h3,{id:"permission-issues",children:"Permission Issues"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Check volume permissions\nls -la ./backups\n\n# Fix permissions\nsudo chown -R 1000:1000 ./backups\n"})}),"\n",(0,r.jsx)(n.h3,{id:"dns-issues",children:"DNS Issues"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Use host networking for DNS\ndocker run --rm --network host \\\n  -v $(pwd)/backup.yaml:/config/backup.yaml:ro \\\n  ghcr.io/osodevops/kafka-backup:latest \\\n  backup --config /config/backup.yaml\n"})}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"./kubernetes",children:"Kubernetes Deployment"})," - Deploy on K8s"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"../reference/config-yaml",children:"Configuration Reference"})," - All options"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"../guides/backup-to-s3",children:"Backup to S3"})," - Cloud storage guide"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);